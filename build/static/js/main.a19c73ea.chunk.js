(this["webpackJsonplabel-studio"]=this["webpackJsonplabel-studio"]||[]).push([[0],{114:function(e,t,n){e.exports={link:"global_link__Ob-I9"}},119:function(e,t,n){e.exports={"ant-divider-horizontal":"App_ant-divider-horizontal__Fovgn","ant-divider-with-text-center":"App_ant-divider-with-text-center__k94K1","ant-divider-with-text-left":"App_ant-divider-with-text-left__3ZsEx","ant-divider-with-text-right":"App_ant-divider-with-text-right__1V7OB","ls-renderall":"App_ls-renderall__6uj2C","ls-fade":"App_ls-fade__2aRob",fadeInOpacity:"App_fadeInOpacity__2el0u","htx-highlight":"App_htx-highlight__cYbGr","htx-no-label":"App_htx-no-label__37xuh","htx-highlight-last":"App_htx-highlight-last__3tlHS","htx-yoyo":"App_htx-yoyo__22Lfq","ant-modal-confirm-error":"App_ant-modal-confirm-error__2n_EC","ant-list-item-action":"App_ant-list-item-action__2oF1i",segment:"App_segment__3H61n",editor:"App_editor__CIAJZ",editorfs:"App_editorfs__1aruF",menu:"App_menu__X-A5N",menubsp:"App_menubsp__2F6jW",content:"App_content__11LHs",common:"App_common__QaThK",commonbsp:"App_commonbsp__1qe04",pins:"App_pins__3EECJ",pinsright:"App_pinsright__3RQmG"}},126:function(e,t,n){e.exports={block:"Styles_block__1NSsm",divider:"Styles_divider__2clc_",button:"Styles_button__1aTsI"}},130:function(e,t,n){e.exports={"ant-divider-horizontal":"Controls_ant-divider-horizontal__3POBd","ant-divider-with-text-center":"Controls_ant-divider-with-text-center__1hYa2","ant-divider-with-text-left":"Controls_ant-divider-with-text-left__1r-Lg","ant-divider-with-text-right":"Controls_ant-divider-with-text-right__3RoCh","ls-renderall":"Controls_ls-renderall__2Kj-I","ls-fade":"Controls_ls-fade__3obEE",fadeInOpacity:"Controls_fadeInOpacity__KWKby","htx-highlight":"Controls_htx-highlight__FSi_2","htx-no-label":"Controls_htx-no-label__257YF","htx-highlight-last":"Controls_htx-highlight-last__3aDLg","htx-yoyo":"Controls_htx-yoyo__1YbO2","ant-modal-confirm-error":"Controls_ant-modal-confirm-error__16b1J",task:"Controls_task__2FuYQ",container:"Controls_container__LTeAA",block:"Controls_block__21XER",wrapper:"Controls_wrapper__1Zdbo",rewrite:"Controls_rewrite__bRxtr"}},131:function(e,t,n){e.exports={block:"Dialog_block__2f1HI",block_selected:"Dialog_block_selected__cGeTu",name:"Dialog_name__27hAU",tag:"Dialog_tag__1o6ny",date:"Dialog_date__33g0a"}},148:function(e,t,n){e.exports={mark:"TextAreaRegion_mark__3ph3F",selected:"TextAreaRegion_selected__3Q440",highlighted:"TextAreaRegion_highlighted__3xJod",relation:"TextAreaRegion_relation__30wW3",delete:"TextAreaRegion_delete__2mF_2",row:"TextAreaRegion_row__2xFM5"}},167:function(e,t,n){e.exports={"ant-divider-horizontal":"Panel_ant-divider-horizontal__15Mt3","ant-divider-with-text-center":"Panel_ant-divider-with-text-center__2U1CW","ant-divider-with-text-left":"Panel_ant-divider-with-text-left__1GH5P","ant-divider-with-text-right":"Panel_ant-divider-with-text-right__2Lpc0","ls-renderall":"Panel_ls-renderall__3CWt5","ls-fade":"Panel_ls-fade__3W0tw",fadeInOpacity:"Panel_fadeInOpacity__z086F","htx-highlight":"Panel_htx-highlight__1tuyA","htx-no-label":"Panel_htx-no-label__2SJ2M","htx-highlight-last":"Panel_htx-highlight-last__2Cuel","htx-yoyo":"Panel_htx-yoyo__2osrK","ant-modal-confirm-error":"Panel_ant-modal-confirm-error__3l0SX",container:"Panel_container__3AO29",block__controls:"Panel_block__controls__psq4W",block:"Panel_block__2d3Uq"}},168:function(e,t,n){e.exports={block:"ImageView_block__3BAO-",divider:"ImageView_divider__1Hcuk",button:"ImageView_button__3H1Aa",container:"ImageView_container__AOBmH",rotated:"ImageView_rotated__2CLwY",filler:"ImageView_filler__c-NII"}},169:function(e,t,n){e.exports={input:"HtxTextBox_input__1WT88",editing:"HtxTextBox_editing__2Wu58",enter:"HtxTextBox_enter__1Vbyn",delete:"HtxTextBox_delete__J_jjZ"}},208:function(e,t,n){e.exports={tooltitle:"Tools_tooltitle__2lRz7"}},214:function(e,t,n){e.exports={node:"Node_node__38uoJ",minimal:"Node_minimal__3sbyt",alias:"Node_alias__VPI6D"}},259:function(e,t,n){e.exports={main:"Hint_main__1Svrz"}},262:function(e,t,n){e.exports={block:"Text_block__1VM-S",line:"Text_line__2JZG0"}},263:function(e,t,n){e.exports={"ls-error":"TreeValidation_ls-error__3bzOW"}},324:function(e,t,n){e.exports={"ant-divider-horizontal":"Segment_ant-divider-horizontal__fFYLB","ant-divider-with-text-center":"Segment_ant-divider-with-text-center__mspm2","ant-divider-with-text-left":"Segment_ant-divider-with-text-left__Q56jn","ant-divider-with-text-right":"Segment_ant-divider-with-text-right__2WzMV","ls-renderall":"Segment_ls-renderall__1yjaW","ls-fade":"Segment_ls-fade__112CU",fadeInOpacity:"Segment_fadeInOpacity__2TAdJ","htx-highlight":"Segment_htx-highlight__sgrxU","htx-no-label":"Segment_htx-no-label__33-yV","htx-highlight-last":"Segment_htx-highlight-last__2T5Nz","htx-yoyo":"Segment_htx-yoyo__F5J3m","ant-modal-confirm-error":"Segment_ant-modal-confirm-error__fiuik",block:"Segment_block__1fyeG"}},331:function(e,t,n){e.exports={badge:"SimpleBadge_badge__QESA-"}},342:function(e,t,n){},347:function(e,t,n){e.exports={progress:"Waveform_progress__32S1p",wave:"Waveform_wave__1AcCy",menu:"Waveform_menu__2ssfW"}},403:function(e,t,n){e.exports=n(656)},408:function(e,t,n){},423:function(e,t){},425:function(e,t){},58:function(e,t,n){e.exports={buttons:"Completions_buttons__278SL",skipped:"Completions_skipped__1PMvh",completioncard:"Completions_completioncard__1t9j4",completion:"Completions_completion__o7RMd",completion_selected:"Completions_completion_selected__3qnRj",title:"Completions_title__1sVK7",titlespace:"Completions_titlespace__2vePz",itembtns:"Completions_itembtns__1iGrZ",draftbtn:"Completions_draftbtn__s2IBb"}},607:function(e,t,n){},629:function(e,t,n){e.exports={play:"AudioPlus_play__FZgJl"}},656:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"isString",(function(){return X})),n.d(a,"isStringEmpty",(function(){return G})),n.d(a,"isStringJSON",(function(){return K})),n.d(a,"getUrl",(function(){return J})),n.d(a,"toTimeString",(function(){return q})),n.d(a,"flatten",(function(){return Z})),n.d(a,"hashCode",(function(){return $})),n.d(a,"atobUnicode",(function(){return Q})),n.d(a,"escapeHtml",(function(){return ee})),n.d(a,"wrapArray",(function(){return te})),n.d(a,"delay",(function(){return ne}));var r={};n.r(r),n.d(r,"hexToRGBA",(function(){return oe})),n.d(r,"colorToRGBA",(function(){return ie})),n.d(r,"convertToRGBA",(function(){return le})),n.d(r,"stringToColor",(function(){return se})),n.d(r,"rgbaChangeAlpha",(function(){return ce})),n.d(r,"getScaleGradient",(function(){return ue}));var o={};n.r(o),n.d(o,"getImageData",(function(){return pe})),n.d(o,"calcBorder",(function(){return me}));var i={};n.r(i),n.d(i,"reverseCoordinates",(function(){return fe})),n.d(i,"canvasToBinaryMatrix",(function(){return ye})),n.d(i,"getBoundingBoxAfterTransform",(function(){return ve})),n.d(i,"getBoundingBoxAfterChanges",(function(){return be})),n.d(i,"fixRectToFit",(function(){return we}));var l={};n.r(l),n.d(l,"RLEencode",(function(){return xe})),n.d(l,"RLEdecode",(function(){return Ee}));var s={};n.r(s),n.d(s,"msToHMS",(function(){return Se})),n.d(s,"prettyDate",(function(){return _e})),n.d(s,"currentISODate",(function(){return ke}));var c={};n.r(c),n.d(c,"toggleLabelsAndScores",(function(){return Ne})),n.d(c,"labelWithCSS",(function(){return Te})),n.d(c,"removeSpans",(function(){return We})),n.d(c,"mainOffsets",(function(){return Ve})),n.d(c,"findIdxContainer",(function(){return Fe})),n.d(c,"toGlobalOffset",(function(){return Ue})),n.d(c,"highlightRange",(function(){return He})),n.d(c,"splitBoundaries",(function(){return Be})),n.d(c,"normalizeBoundaries",(function(){return Ie})),n.d(c,"createClass",(function(){return Me}));var u=n(9),d=n(0),p=n.n(d),m=n(28),g=n.n(m),h=(n(408),n(15)),f=n(16),y=n(29),v=n(30),b=n(668),w=n(195),x=n(1),E=n(7),S=n(54),_=n(315),k=n.n(_),O=new(function(){function e(){Object(h.a)(this,e),this.tags=[],this.models={},this.views={},this.regions=[],this.objects=[],this.areas=new Map,this.views_models={},this.tools={}}return Object(f.a)(e,[{key:"addTag",value:function(e,t,n){this.tags.push(e),this.models[e]=t,this.views[e]=n,this.views_models[t.name]=n}},{key:"addRegionType",value:function(e,t,n){this.regions.push(e),n&&(e.detectByValue=n);var a=this.areas.get(t);a?a.push(e):this.areas.set(t,[e])}},{key:"regionTypes",value:function(){return this.regions}},{key:"addObjectType",value:function(e){this.objects.push(e)}},{key:"objectTypes",value:function(){return this.objects}},{key:"modelsArr",value:function(){return Object.values(this.models)}},{key:"getViewByModel",value:function(e){var t=this.views_models[e];if(!t)throw new Error("No view for model: "+e);return t}},{key:"getViewByTag",value:function(e){return this.views[e]}},{key:"getAvailableAreas",value:function(e,t){var n=this.areas.get(e);if(!n)return[];if(t){var a,r=Object(S.a)(n);try{for(r.s();!(a=r.n()).done;){var o=a.value;if(o.detectByValue&&o.detectByValue(t))return[o]}}catch(i){r.e(i)}finally{r.f()}}return n.filter((function(e){return!e.detectByValue}))}},{key:"getTool",value:function(e){var t=this.tools[e];if(!t){var n=Object.keys(this.tools);throw new Error("No model registered for tool: "+e+"\nAvailable models:\n\t"+n.join("\n\t"))}return t}},{key:"addTool",value:function(e,t){this.tools[e]=t}},{key:"getModelByTag",value:function(e){var t=this.models[e];if(!t){var n=Object.keys(this.models);throw new Error("No model registered for tag: "+e+"\nAvailable models:\n\t"+n.join("\n\t"))}return t}}]),e}());O.getTool=O.getTool.bind(O),O.getModelByTag=O.getModelByTag.bind(O);var C=O,j=n(254),R=n.n(j);function N(e){var t=R()(10);return e&&(t=R()(e)),t}function T(e){var t=Object(x.getSnapshot)(e);return Object(x.getType)(e).create(Object(u.a)(Object(u.a)({},t),{},{id:N()}))}function M(e){var t=Object(x.getSnapshot)(e);return Object(x.getType)(e).create(Object(u.a)(Object(u.a)({},t),{},{id:N()}))}function A(e){var t=Object(x.getType)(e).name,n=C.getViewByModel(t);if(!n)throw new Error("No view for model: ".concat(t));return p.a.createElement(n,{key:N(),item:e})}function z(e,t){var n;(n=function(e){var a=t(e);if("skip"!==a){if("stop"===a)return"stop";if(e.children){var r,o=Object(S.a)(e.children);try{for(o.s();!(r=o.n()).done;){var i=r.value;if("stop"===n(i))return"stop"}}catch(l){o.e(l)}finally{o.f()}}}})(e)}var P={cloneReactTree:function(e,t){var n=null;return(n=function(e){var a=[];return p.a.Children.forEach(e,(function(e){var r;if(e.props){var o={};"function"===typeof t?o=t(e):"object"===typeof t&&(o=t),r=p.a.cloneElement(e,o,n(e.props.children))}else r=e;a.push(r)})),a})(e)},renderItem:A,renderChildren:function(e){return e&&e.children&&e.children.length?e.children.map((function(e){return A(e)})):null},treeToModel:function(e){var t=-1,n=function(){var t,n=[],a=/<HyperText.*?>(.*?)<\/HyperText>/gi;do{(t=a.exec(e))&&n.push(t[1])}while(t);return n}();function a(e){var t=function(e){var t={};if(!e)return t;for(var n=0,a=Object.keys(e);n<a.length;n++){var r=a[n];"value"===r||"true"!==e[r]&&"false"!==e[r]?t[r.toLowerCase()]=e[r]:t[r.toLowerCase()]=JSON.parse(e[r])}return t}(e.$),n=e["#name"].toLowerCase();return t.id=N(),t.type=n,t.tagName=e["#name"],t}var r,o=function(e){for(var t=e.split("/>"),n="",a=0;a<t.length-1;a++){var r=t[a].split("<");n+=t[a]+"></"+r[r.length-1].split(" ")[0]+">"}return n+t[t.length-1]}(e.replace(/(\r\n|\n|\r)/gm,""));k.a.parseString(o,{explicitChildren:!0,preserveChildrenOrder:!0,charsAsChildren:!0},(function(e,t){r=t}));var i=a(Object.values(r)[0]);return i.children=function e(r){if(!r.$$)return null;if("hypertext"===r["#name"].toLowerCase())return r.$&&"value"in r.$?r.$.value:n[t+=1];var o,i=null,l=[],s=Object(S.a)(r.$$);try{for(s.s();!(o=s.n()).done;){var c=o.value;if("__text__"!==c["#name"]){var u=a(c),d=e(c);d&&("string"===typeof d?u.value=d:u.children=d),l.push(u)}else i=c._}}catch(p){s.e(p)}finally{s.f()}return 0===l.length?i:l}(Object.values(r)[0]),i},findInterface:function(e,t){var n;return(n=function(t){if(Object(x.getType)(t).name===e)return t;if(t.children){var a,r=Object(S.a)(t.children);try{for(r.s();!(a=r.n()).done;){var o=a.value,i=n(o);if(i)return i}}catch(l){r.e(l)}finally{r.f()}}})(t)},findParentOfType:function(e,t){var n,a=Object(S.a)(t);try{for(a.s();!(n=a.n()).done;){var r=n.value;try{var o=Object(x.getParentOfType)(e,r);if(o)return o}catch(i){}}}catch(i){a.e(i)}finally{a.f()}return null},filterChildrenOfType:function(e,t){var n=[];return Array.isArray(t)||(t=[t]),z(e,(function(e){var a,r=Object(S.a)(t);try{for(r.s();!(a=r.n()).done;){var o=a.value;Object(x.getType)(e).name===o&&n.push(e)}}catch(i){r.e(i)}finally{r.f()}})),n},cssConverter:function(e){if(!e)return null;var t,n,a,r,o={},i=e.split(";");for(n=0;n<i.length;n++){if(t=i[n].indexOf(":"),a=i[n].substring(0,t),r=i[n].substring(t+1),!((a=a.replace(/ /g,"")).length<1))" "===r[0]&&(r=r.substring(1))," "===r[r.length-1]&&(r=r.substring(0,r.length-1)),o[a.replace(/(-.)/g,(function(e){return e[1].toUpperCase()}))]=r}return o},traverseTree:z},L=n(79),D=n(69),I=n(666),H=n(670),B=n(671),U=n(669),V=n(673),F=n(674),W=n(675),Y=n(676),X=function(e){return"string"===typeof e||e instanceof String},G=function(e){return!!X(e)&&0===e.length},K=function(e){if(X(e)){try{JSON.parse(e)}catch(t){return!1}return!0}return!1};function J(e,t){var n=t.slice(e),a=/^(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/g.exec(n);return a&&a.length?a[1]:""}function q(e){if("number"===typeof e)return new Date(e).toUTCString().match(/(\d\d:\d\d:\d\d)/)[0]}function Z(e){return e.reduce((function(e,t){return e.concat(Array.isArray(t)?Z(t):t)}),[])}function $(e){var t=0;if(0===e.length)return t+"";for(var n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t&=t}return t+""}function Q(e){return decodeURIComponent(atob(e).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))}function ee(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function te(e){var t;return(t=[]).concat.apply(t,[e])}function ne(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout(t,e)}))}var ae=["#c22525","#c13025","#bf3b24","#be4624","#bc5124","#bb5b23","#ba6623","#b87023","#b77a22","#b58422","#b48d22","#b39722","#b1a021","#b0aa21","#aaae21","#9ead20","#93ab20","#87aa20","#7ca91f","#71a71f","#66a61f","#5ba41e","#51a31e","#46a21e","#3ca01e","#329f1d","#289d1d","#1e9c1d","#1c9a24","#1c992d","#1c992d"],re={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function oe(e,t){var n=0,a=0,r=0,o=.3;return"number"===typeof parseInt(t)&&(o=t),e&&4===e.length?(n="0x"+e[1]+e[1],a="0x"+e[2]+e[2],r="0x"+e[3]+e[3]):e&&7===e.length&&(n="0x"+e[1]+e[2],a="0x"+e[3]+e[4],r="0x"+e[5]+e[6]),"rgba(".concat(+n,", ").concat(+a,", ").concat(+r,", ").concat(o,")")}function ie(e,t){return"string"===typeof e&&void 0!==typeof re[e.toLowerCase()]?oe(re[e.toLowerCase()],t):e}function le(e,t){return"#"===e.charAt(0)?oe(e,t):ie(e,t)}function se(e){for(var t=0,n=0;n<e.length;n++)t=e.charCodeAt(n)+((t<<5)-t);for(var a="#",r=0;r<3;r++){a+=("00"+(t>>8*r&255).toString(16)).substr(-2)}return a}function ce(e,t){return e.replace(/[\d\.]+\)$/g,"".concat(t,")"))}function ue(e){return ae[Math.ceil(30*e)]}var de=function(){var e={};return e.floodFill=function(e,t,n,a,r){var o,i,l,s,c,u,d,p,m,g,h=e.data,f=e.width,y=e.height,v=e.bytes,b=-1,w=f+1,x=-1,E=y+1,S=n*f+t,_=new Uint8Array(f*y),k=new Uint8Array(r||f*y);if(1===k[S])return null;var O=[h[S*=v],h[S+1],h[S+2],h[S+3]],C=[{y:n,left:t-1,right:t+1,dir:1}];do{for(g=!1,i=(s=C.shift()).left+1;i<s.right;i++)if(S=((d=s.y*f)+i)*v,1!==k[d+i]&&!((o=h[S]-O[0])>a||o<-a)&&!((o=h[S+1]-O[1])>a||o<-a)&&!((o=h[S+2]-O[2])>a||o<-a)){for(g=!0,_[d+i]=1,k[d+i]=1,u=i-1;u>-1&&(S=(p=d+u)*v,1!==k[p])&&!((o=h[S]-O[0])>a||o<-a)&&!((o=h[S+1]-O[1])>a||o<-a)&&!((o=h[S+2]-O[2])>a||o<-a);)_[p]=1,k[p]=1,u--;for(c=i+1;c<f&&(S=(m=d+c)*v,1!==k[m])&&!((o=h[S]-O[0])>a||o<-a)&&!((o=h[S+1]-O[1])>a||o<-a)&&!((o=h[S+2]-O[2])>a||o<-a);)_[m]=1,k[m]=1,c++;u<w&&(w=u+1),c>b&&(b=c-1),(l=s.y-s.dir)>=0&&l<y&&(u<s.left&&C.push({y:l,left:u,right:s.left,dir:-s.dir}),s.right<c&&C.push({y:l,left:s.right,right:c,dir:-s.dir})),(l=s.y+s.dir)>=0&&l<y&&u<c&&C.push({y:l,left:u,right:c,dir:s.dir})}g&&(s.y<E&&(E=s.y),s.y>x&&(x=s.y))}while(C.length>0);return{data:_,width:e.width,height:e.height,bounds:{minX:w,minY:E,maxX:b,maxY:x}}},e.gaussBlur=function(e,t){var n,a,r,o,i,l,s,c=2*t+1,u=t*t,d=new Float32Array(c),p=0,m=e.width,g=e.height,h=e.data,f=e.bounds.minX,y=e.bounds.maxX,v=e.bounds.minY,b=e.bounds.maxY;for(n=0;n<t;n++){var w=(t-n)*(t-n),x=Math.exp(-w/(2*u))/(2*Math.PI*u);d[t+n]=d[t-n]=x,p+=2*x}for(n=0;n<c;n++)d[n]/=p;var E=new Uint8Array(m*g),S=t+m,_=t+g;for(i=v;i<b+1;i++)for(o=f;o<y+1;o++){for(l=0,s=S-o<c?S-o:c,r=(a=i*m+o)-t,n=t-o>0?t-o:0;n<s;n++)l+=h[r+n]*d[n];for(s=_-i<c?_-i:c,r=a-t*m,n=t-i>0?t-i:0;n<s;n++)l+=h[r+n*m]*d[n];E[a]=l>.5?1:0}return{data:E,width:m,height:g,bounds:{minX:f,minY:v,maxX:y,maxY:b}}},e.gaussBlurOnlyBorder=function(e,t,n){var a,r,o,i,l,s,c,u,d,p,m=function(e,t,n){var a,r,o,i,l,s,c,u=e.width,d=e.height,p=e.data,m=new Uint8Array(p),g=e.bounds.minX,h=e.bounds.maxX,f=e.bounds.minY,y=e.bounds.maxY,v=u*d,b=new Uint8Array(v),w=[],x=Math.max(g,1),E=Math.min(h,u-2),S=Math.max(f,1),_=Math.min(y,d-2);if(n&&n.length>0)for(l=0;l<v;l++)1===n[l]&&(m[l]=1);for(i=S;i<_+1;i++)for(a=x;a<E+1;a++)0!==p[l=i*u+a]&&(s=l+u,c=l-u,0!==m[l+1]&&0!==m[l-1]&&0!==m[s]&&0!==m[s+1]&&0!==m[s-1]&&0!==m[c]&&0!==m[c+1]&&0!==m[c-1]||w.push(l));if(0===g)for(i=f;i<y+1;i++)1===p[i*u]&&w.push(i*u);if(h===u-1)for(i=f;i<y+1;i++)1===p[i*u+h]&&w.push(i*u+h);if(0===f)for(a=g;a<h+1;a++)1===p[a]&&w.push(a);if(y===d-1)for(a=g;a<h+1;a++)1===p[y*u+a]&&w.push(y*u+a);var k,O=[],C=t+u,j=t+d,R=2*t+1;for(v=w.length,o=0;o<v;o++){for(b[l=w[o]]=1,O.push(l),i=(l-(a=l%u))/u,k=C-a<R?C-a:R,s=l-t,r=t-a>0?t-a:0;r<k;r++)0===b[c=s+r]&&(b[c]=1,O.push(c));for(k=j-i<R?j-i:R,s=l-t*u,r=t-i>0?t-i:0;r<k;r++)0===b[c=s+r*u]&&(b[c]=1,O.push(c))}return O}(e,t,n),g=2*t+1,h=2*t*t,f=new Float32Array(g),y=0,v=e.width,b=e.height,w=e.data,x=e.bounds.minX,E=e.bounds.maxX,S=e.bounds.minY,_=e.bounds.maxY,k=m.length;for(o=0;o<t;o++)r=(t-o)*(t-o),a=Math.exp(-r/h)/Math.PI,f[t+o]=f[t-o]=a,y+=2*a;for(o=0;o<g;o++)f[o]/=y;var O=new Uint8Array(w),C=t+v,j=t+b;for(o=0;o<k;o++){for(d=0,u=((l=m[o])-(c=l%v))/v,p=C-c<g?C-c:g,s=l-t,i=t-c>0?t-c:0;i<p;i++)d+=w[s+i]*f[i];if(d>.5)O[l]=1,c<x&&(x=c),c>E&&(E=c),u<S&&(S=u),u>_&&(_=u);else{for(p=j-u<g?j-u:g,s=l-t*v,i=t-u>0?t-u:0;i<p;i++)d+=w[s+i*v]*f[i];d>.5?(O[l]=1,c<x&&(x=c),c>E&&(E=c),u<S&&(S=u),u>_&&(_=u)):O[l]=0}}return{data:O,width:v,height:b,bounds:{minX:x,minY:S,maxX:E,maxY:_}}},e.createBorderMask=function(e){var t,n,a,r,o,i=e.width,l=e.height,s=e.data,c=e.bounds.minX,u=e.bounds.maxX,d=e.bounds.minY,p=e.bounds.maxY,m=u-c+1,g=p-d+1,h=new Uint8Array(m*g),f=Math.max(c,1),y=Math.min(u,i-2),v=Math.max(d,1),b=Math.min(p,l-2);for(n=v;n<b+1;n++)for(t=f;t<y+1;t++)0!==s[a=n*i+t]&&(r=a+i,o=a-i,0!==s[a+1]&&0!==s[a-1]&&0!==s[r]&&0!==s[r+1]&&0!==s[r-1]&&0!==s[o]&&0!==s[o+1]&&0!==s[o-1]||(h[(n-d)*m+(t-c)]=1));if(0===c)for(n=d;n<p+1;n++)1===s[n*i]&&(h[(n-d)*m]=1);if(u===i-1)for(n=d;n<p+1;n++)1===s[n*i+u]&&(h[(n-d)*m+(u-c)]=1);if(0===d)for(t=c;t<u+1;t++)1===s[t]&&(h[t-c]=1);if(p===l-1)for(t=c;t<u+1;t++)1===s[p*i+t]&&(h[(p-d)*m+(t-c)]=1);return{data:h,width:m,height:g,offset:{x:c,y:d}}},e.getBorderIndices=function(e){var t,n,a,r,o,i=e.width,l=e.height,s=e.data,c=[],u=i-1,d=l-1;for(n=1;n<d;n++)for(t=1;t<u;t++)0!==s[a=n*i+t]&&(r=a+i,o=a-i,0!==s[a+1]&&0!==s[a-1]&&0!==s[r]&&0!==s[r+1]&&0!==s[r-1]&&0!==s[o]&&0!==s[o+1]&&0!==s[o-1]||c.push(a));for(n=0;n<l;n++)1===s[n*i]&&c.push(n*i);for(t=0;t<i;t++)1===s[t]&&c.push(t);for(a=i-1,n=0;n<l;n++)1===s[n*i+a]&&c.push(n*i+a);for(a=(l-1)*i,t=0;t<i;t++)1===s[a+t]&&c.push(a+t);return c},e.traceContours=function(e){var t,n,a,r,o,i,l,s,c,u,d,p,m,g,h,f=function(e){var t,n,a=e.width,r=e.data,o=e.bounds.minX,i=e.bounds.maxX,l=e.bounds.minY,s=e.bounds.maxY,c=i-o+3,u=s-l+3,d=new Uint8Array(c*u);for(n=l;n<s+1;n++)for(t=o;t<i+1;t++)1===r[n*a+t]&&(d[(n-l+1)*c+(t-o+1)]=1);return{data:d,width:c,height:u,offset:{x:o-1,y:l-1}}}(e),y=[],v=0,b=f.width,w=2*b,x=f.height,E=f.data,S=f.offset.x,_=f.offset.y,k=new Uint8Array(E),O=[[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1],[1,-1]];for(r=1;r<x-1;r++)for(a=1;a<b-1;a++)if(1===E[o=r*b+a])for(t=-b;t<w;t+=w)if(0===E[o+t]&&0===k[o+t]){for(v++,l=[],c=(s=t===b)?2:6,p=m=u={x:a,y:r},d=null;;){for(k[p.y*b+p.x]=v,n=0;n<8;n++){if(h=O[c=(c+1)%8],1===E[i=(g={x:p.x+h[0],y:p.y+h[1]}).y*b+g.x]){k[i]=v;break}k[i]=-1,g=null}if(null===g)break;if(p=g,d){if(m.x===u.x&&m.y===u.y&&p.x===d.x&&p.y===d.y)break}else d=g;l.push({x:m.x+S,y:m.y+_}),m=p,c=(c+4)%8}null!=g&&(l.push({x:u.x+S,y:u.y+_}),y.push({inner:s,label:v,points:l}))}return y},e.simplifyContours=function(e,t,n){var a,r,o,i,l,s,c,u,d,p,m,g,h,f,y,v,b,w,x,E,S,_=e.length,k=[];for(r=0;r<_;r++)if(l=(i=e[r]).points,(s=i.points.length)<n){for(c=[],o=0;o<s;o++)c.push({x:l[o].x,y:l[o].y});k.push({inner:i.inner,label:i.label,points:c,initialCount:s})}else{u=[0,s-1],d=[{first:0,last:s-1}];do{if(!((p=d.shift()).last<=p.first+1)){for(m=-1,g=p.first,a=p.first+1;a<p.last;a++)x=l[a],E=l[p.first],S=l[p.last],b=x.x-E.x,w=x.y-E.y,f=Math.sqrt(b*b+w*w),b=x.x-S.x,w=x.y-S.y,y=Math.sqrt(b*b+w*w),b=E.x-S.x,w=E.y-S.y,v=Math.sqrt(b*b+w*w),(h=f>=Math.sqrt(y*y+v*v)?y:y>=Math.sqrt(f*f+v*v)?f:Math.abs((w*x.x-b*x.y+E.x*S.y-S.x*E.y)/v))>m&&(g=a,m=h);m>t&&(u.push(g),d.push({first:p.first,last:g}),d.push({first:g,last:p.last}))}}while(d.length>0);for(c=[],s=u.length,u.sort((function(e,t){return e-t})),o=0;o<s;o++)c.push({x:l[u[o]].x,y:l[u[o]].y});k.push({inner:i.inner,label:i.label,points:c,initialCount:i.points.length})}return k},e}();function pe(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");return n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height)}function me(e,t,n,a,r,o,i){var l=[],s={data:e,width:t,height:n,bytes:4},c=de.floodFill(s,a,r,o,null,!0);c=de.gaussBlurOnlyBorder(c,5);var u=de.traceContours(c);if((u=de.simplifyContours(u,5,50)).length>0){if(i)return u[0].points;for(var d=0,p=u[0].points.length;d<p;d++)l.push([u[0].points[d].x,u[0].points[d].y]);return l}return!1}var ge=n(100),he=n.n(ge);function fe(e,t){var n,a=e.x,r=e.y,o=t.x,i=t.y;return a>o&&(n=Math.abs(a-o),o=(a=o)+n),r>i&&(n=Math.abs(r-i),i=(r=i)+n),{x1:a,y1:r,x2:o,y2:i}}function ye(e,t){for(var n=e.stageRef.getLayers().filter((function(e){return e.attrs.id===t.id}))[0].canvas.context,a=n.getImageData(0,0,n.canvas.width,n.canvas.height),r=[],o=0;o<e.stageRef.bufferCanvas.context.canvas.width*e.stageRef.bufferCanvas.context.canvas.height*4;o+=4){var i=a.data[o+0],l=a.data[o+1],s=a.data[o+2],c=a.data[o+3];i>0||l>0||s>0||c>0?r.push(1):r.push(0)}return r}function ve(e,t){var n,a,r,o;return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}].forEach((function(e){var i=t.point(e);void 0===n&&(n=r=i.x,a=o=i.y),n=Math.min(n,i.x),a=Math.min(a,i.y),r=Math.max(r,i.x),o=Math.max(o,i.y)})),{x:n,y:a,width:r-n,height:o-a}}function be(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=new he.a.Transform;return a.translate(t.x,t.y),a.rotate(n*Math.PI/180),ve(e,a)}function we(e,t,n){var a=e.x,r=e.y,o=e.width,i=e.height;return a<0?(o+=a,a=0):a+o>t&&(o=t-a),r<0?(i+=r,r=0):r+i>n&&(i=n-r),{x:a,y:r,width:o,height:i}}function xe(e){var t,n,a,r=[];for(n=1,t=e[0],a=1;a<e.length;a++)e[a]!==t?(r.push(n,t),n=1,t=e[a]):n++;return r.push(n,t),r}function Ee(e){var t=new Uint8ClampedArray,n=[];return e.forEach((function(n,a){a%2===0&&t.push(Array.from(new Array(1+n).join(e[a+1])))})),t.flat(2).forEach((function(e){return n.push(parseInt(e))})),n}function Se(e){var t=e/1e3,n=parseInt(t/3600);return t%=3600,n+":"+parseInt(t/60)+":"+(t=Math.floor(t))}function _e(e){if(!("string"!==typeof e&&!e instanceof Date)||/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)/.test(e)){var t=new Date(e),n=((new Date).getTime()-t.getTime())/1e3,a=Math.floor(n/86400);if(!(isNaN(a)||a<0))return 0===a&&((n<60?"just now":n<120&&"1 minute ago")||n<3600&&Math.floor(n/60)+" minutes ago"||n<7200&&"1 hour ago"||n<86400&&Math.floor(n/3600)+" hours ago")||1===a&&"Yesterday"||a<7&&a+" days ago"||a<31&&Math.ceil(a/7)+" weeks ago"||a+" days ago"}}function ke(){var e=6e4*(new Date).getTimezoneOffset();return new Date(Date.now()-e).toISOString().slice(0,-1)}var Oe=n(316),Ce=n.n(Oe),je=n(265);var Re={imageData2Image:function(e){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=e.width,t.height=e.height,n.putImageData(e,0,0);var a=new Image;return a.src=t.toDataURL(),a},Region2RLE:function(e,t,n){var a=t.naturalWidth,r=t.naturalHeight,o=he.a.stages[0].findOne("#".concat(e.cleanId));if(!o)return console.error("Layer #".concat(e.id," was not found on Stage")),[];o.find(".region-label").hide(),he.a.stages[0].drawScene();var i=o.toCanvas({pixelRatio:a/t.stageWidth}).getContext("2d").getImageData(0,0,a,r);return o.find(".region-label").show(),he.a.stages[0].drawScene(),Object(je.b)(i.data,i.data.length)},RLE2Region:function(e,t){var n=t.naturalWidth,a=t.naturalHeight,r=document.createElement("canvas"),o=r.getContext("2d");r.width=n,r.height=a;var i=o.createImageData(n,a);i.data.set(Object(je.a)(e)),o.putImageData(i,0,0);var l=new Image;return l.src=r.toDataURL(),l},brushSizeCircle:function(e){var t=document.createElement("canvas"),n=t.getContext("2d");return t.width=4*e+8,t.height=4*e+8,n.beginPath(),n.arc(e/2+4,e/2+4,e/2,0,2*Math.PI,!1),n.lineWidth=2,n.strokeStyle="white",n.stroke(),t.toDataURL()},labelToSVG:function(){var e={};return function(t){var n=t.label,a=t.score,r=n;if(null!==a&&(r+=a),r in e)return e[r];var o=0,i=[];if(null!==a&&void 0!==a){var l=ue(a);i.push('<rect x="0" y="0" rx="2" ry="2" width="24" height="14" style="fill:'.concat(l,';opacity:0.5" />')),i.push('<text x="3" y="10" style="font-size: 8px; font-family: Monaco">'.concat(a.toFixed(2),"</text>")),o+=26}n&&(i.push('<text x="'.concat(o,'" y="11" style="font-size: 9.5px; font-weight: bold; font-family: Monaco">').concat(n,"</text>")),o=o+function(e){var t=document.createElement("svg"),n=document.createElement("text");n.style="font-size: 9.5px; font-weight: bold; color: red; fill: red; font-family: Monaco",n.innerHTML=e,t.appendChild(n),document.body.appendChild(t);var a=t.getBoundingClientRect().width;return t.remove(),a}(n)+2);var s=function(e){var t={level1:"'",level2:'"'},n=(e=(e=(e=(e=function(e){return e.indexOf("http://www.w3.org/2000/svg")<0&&(e=e.replace(/<svg/g,"<svg xmlns=".concat(t.level2,"http://www.w3.org/2000/svg").concat(t.level2))),e}(e)).replace(/'/g,'"')).replace(/>\s{1,}</g,"><")).replace(/\s{2,}/g," ")).replace(/[\r\n%#()<>?[\\\]^`{|}]/g,encodeURIComponent);return"".concat(t.level1,"data:image/svg+xml,").concat(n).concat(t.level1)}('<svg height="16" width="'.concat(o,'">').concat(i.join(""),"</svg>"));return e[r]=s,s}}()};function Ne(e){var t=document.getElementsByClassName("htx-highlight");Array.from(t).forEach((function(t){var n=null;Array.from(t.classList).forEach((function(e){-1!==e.indexOf("htx-label-")&&(n=e)})),null!==n&&(e?t.classList.remove("htx-no-label"):t.classList.add("htx-no-label"))}))}var Te=function(){var e={};return function(t,n){var a=n.labels,r=n.score,o=a?a.join(","):"",i=$(o+r),l="htx-label-"+i;if((l=l.toLowerCase())in e)return e[l];t.setAttribute("data-labels",o);var s=Re.labelToSVG({label:o,score:r}),c="url(".concat(s,")");return Me(".".concat(l,":after"),"content:".concat(c)),e[i]=!0,l}}();function Me(e,t){var n=document.createElement("style");n.type="text/css",document.getElementsByTagName("head")[0].appendChild(n),(n.sheet||{}).insertRule?n.sheet.insertRule(e+"{"+t+"}",0):(n.styleSheet||n.sheet).addRule(e,t)}function Ae(e){return 3===e.nodeType}function ze(e){for(;e.hasChildNodes();)e=e.firstChild;return e}function Pe(e){for(;e.hasChildNodes();)e=e.lastChild;return e}function Le(e){if(e.firstChild)return e.firstChild;for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}}function De(e,t){var n=e.cloneNode(!1);return n.deleteData(0,t),e.deleteData(t,e.length-t),Ce()(n,e)}function Ie(e){var t,n,a,r,o,i=e.startContainer,l=e.startOffset,s=e.endContainer,c=e.endOffset;function u(e){return!!Ae(e)&&(!(e===i&&l>0)&&(e!==s||0!==c))}for(i.childNodes.length&&l>0&&(i=Pe(i.childNodes[l-1]),l=i.length||i.childNodes.length),c<s.childNodes.length&&(s=ze(s.childNodes[c]),c=0),t=i,n=function(e){return e===a?null:function(e){if(e.firstChild)return e.firstChild;for(;!e.nextSibling;)if(!(e=e.parentNode))return null;return e.nextSibling}(e)},a=Pe(s);t&&!u(t);)t=n(t);for(r=t,t=s,n=function(e){return e===a?null:function(e){if(e.lastChild)return e.lastChild;for(;!e.previousSibling;)if(!(e=e.parentNode))return null;return e.previousSibling}(e)},a=ze(i);t&&!u(t);)t=n(t);o=t,e.setStart(r,0),e.setEnd(o,o.length)}function He(e,t,n){"undefined"!==typeof t&&null!==t||(t="htx-annotation");var a=/^\s*$/,r=function(e){var t,n=e.startContainer,a=e.endContainer,r=e.commonAncestorContainer,o=[];for(t=n.parentNode;t&&(o.push(t),t!==r);t=t.parentNode);for(o.reverse(),t=n;t&&(o.push(t),t!==a);t=Le(t));return o}(e._range).filter((function(e){return Ae(e)})),o=0;e._range.startOffset===r[o].length&&o++;var i=r.length;i>1&&r[r.length-1].length!==e._range.endOffset&&(i-=1);for(var l=[],s=o,c=i;s<c;s++){var u=r[s];if(!a.test(u.nodeValue)){var d=window.document.createElement("span");d.style.backgroundColor=n.backgroundColor,d.className=t,u.parentNode.replaceChild(d,u),d.appendChild(u),l.push(d)}}return l}function Be(e){var t=e.startContainer,n=e.startOffset,a=e.endContainer,r=e.endOffset;Ae(a)&&r>0&&r<a.length&&(a=De(a,r),e.setEnd(a,0)),Ae(t)&&n>0&&n<t.length&&(t===a?(t=De(t,n),e.setEnd(t,r-n)):t=De(t,n),e.setStart(t,0))}var Ue=function(e,t,n){var a=0;return n+function e(n){if(n===t)return a;"#text"===n.nodeName&&(a+=n.length),"BR"===n.nodeName&&(a+=1);for(var r=0;r<=n.childNodes.length;r++){var o=n.childNodes[r];if(o){var i=e(o);if(void 0!==i)return i}}}(e)},Ve=function(e){var t=window.getSelection().getRangeAt(0).cloneRange(),n=t.startOffset,a=t.endOffset,r=!1,o=!1;return function e(i){if("#text"===i.nodeName&&(i===t.startContainer||r||(n+=i.length),i===t.startContainer&&(r=!0),i===t.endContainer||o||(a+=i.length),i===t.endContainer&&(o=!0)),"BR"===i.nodeName&&(r||(n+=1),o||(a+=1)),i.childNodes.length>0)for(var l=0;l<=i.childNodes.length;l++){var s=i.childNodes[l];if(s){var c=e(s);if(c)return c}}}(e),{start:n,end:a}},Fe=function(e,t){var n=t;return{node:function e(t){if(t)if("#text"===t.nodeName){if(n-t.length<=0)return t;n-=t.length}else if("BR"===t.nodeName)n-=1;else if(t.childNodes.length>0)for(var a=0;a<=t.childNodes.length;a++){var r=t.childNodes[a];if(r){var o=e(r);if(o)return o}}}(e),len:n}};function We(e){var t=[];e&&e.forEach((function(e){for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);t.push(e.parentNode),e.parentNode.removeChild(e)})),t.forEach((function(e){return e.normalize()}))}function Ye(e,t,n){var a;return function(){var r=this,o=arguments,i=function(){a=null,n||e.apply(r,o)},l=n&&!a;clearTimeout(a),a=setTimeout(i,t),l&&e.apply(r,o)}}var Xe={Image:i,HTML:c,Checkers:a,Colors:r,UDate:s,guidGenerator:N,debounce:Ye,styleToProp:function(e){return e?e.split(";").filter((function(e){return e.split(":")[0]&&e.split(":")[1]})).map((function(e){return[e.split(":")[0].trim().replace(/-./g,(function(e){return e.substr(1).toUpperCase()})),e.split(":").slice(1).join(":").trim()]})).reduce((function(e,t){return Object(u.a)(Object(u.a)({},e),{},{[t[0]]:t[1]})}),{}):null},RLe:l,Floodfill:o},Ge=n(58),Ke=n.n(Ge),Je=Object(E.c)((function(e){var t=e.item;if(!t.draftSaved&&!t.versions.draft)return null;var n=t.draft&&t.draftSaved?" saved ".concat(Xe.UDate.prettyDate(t.draftSaved)):"";return t.selected?t.versions.result&&t.versions.result.length?p.a.createElement("div",null,p.a.createElement(L.a,{placement:"topLeft",title:t.draft?"switch to submitted result":"switch to current draft"},p.a.createElement(D.a,{type:"link",onClick:t.toggleDraft,className:Ke.a.draftbtn},t.draft?"draft":"submitted")),n):p.a.createElement("div",null,n?"draft".concat(n):"not submitted draft"):t.draft?p.a.createElement("div",null,"draft",n):null})),qe=Object(E.c)((function(e){var t,n=e.item,a=e.store,r=p.a.createElement(I.a,{status:"default"});n.userGenerate&&!n.sentUserGenerate?t=p.a.createElement("span",{className:Ke.a.title},"New completion"):n.pk?t=p.a.createElement("span",{className:Ke.a.title},"ID ",n.pk):n.id&&(t=p.a.createElement("span",{className:Ke.a.title},"ID ",n.id)),n.userGenerate&&(r=p.a.createElement(I.a,{status:"processing"})),n.userGenerate&&n.sentUserGenerate&&(r=p.a.createElement(I.a,{status:"success"}));return p.a.createElement(B.b.Item,{key:n.id,className:n.selected?"".concat(Ke.a.completion," ").concat(Ke.a.completion_selected):Ke.a.completion,onClick:function(e){!n.selected&&a.completionStore.selectCompletion(n.id)}},p.a.createElement("div",{className:Ke.a.completioncard},p.a.createElement("div",null,p.a.createElement("div",{className:Ke.a.title},r,t),"Created",p.a.createElement("i",null,n.createdAgo?" ".concat(n.createdAgo," ago"):" ".concat(Xe.UDate.prettyDate(n.createdDate))),n.createdBy?" by ".concat(n.createdBy):null,p.a.createElement(Je,{item:n})),a.hasInterface("skip")&&(n.skipped||n.was_cancelled)&&p.a.createElement(L.a,{placement:"topLeft",title:"Skipped completion"},p.a.createElement(W.a,{className:Ke.a.skipped})),n.selected&&p.a.createElement("div",{className:Ke.a.buttons},n.honeypot?p.a.createElement(L.a,{placement:"topLeft",title:"Unset this result as a ground truth"},p.a.createElement(D.a,{size:"small",type:"primary",onClick:function(e){e.preventDefault(),n.setGroundTruth(!1)}},p.a.createElement(V.a,null))):p.a.createElement(L.a,{placement:"topLeft",title:"Set this result as a ground truth"},p.a.createElement(D.a,{size:"small",type:"primary",ghost:!0,onClick:function(e){e.preventDefault(),n.setGroundTruth(!0)}},p.a.createElement(V.a,null))),"\xa0",a.hasInterface("completions:delete")&&p.a.createElement(L.a,{placement:"topLeft",title:"Delete selected completion"},p.a.createElement(H.a,{placement:"bottomLeft",title:"Please confirm you want to delete this completion",onConfirm:function(){n.list.deleteCompletion(n)},okText:"Delete",okType:"danger",cancelText:"Cancel"},p.a.createElement(D.a,{size:"small",danger:!0,style:{background:"transparent"}},p.a.createElement(F.a,null)))))))})),Ze=function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){var e=this.props.store,t=p.a.createElement("div",{className:Ke.a.title+" "+Ke.a.titlespace},p.a.createElement("div",{style:{display:"flex",alignItems:"center"}},p.a.createElement("h3",null,"Completions")),p.a.createElement("div",{style:{marginRight:"1px"}},e.hasInterface("completions:add-new")&&p.a.createElement(L.a,{placement:"topLeft",title:"Create a new completion"},p.a.createElement(D.a,{size:"small",onClick:function(t){t.preventDefault();var n=e.completionStore.addCompletion({userGenerate:!0});e.completionStore.selectCompletion(n.id)}},p.a.createElement(Y.a,null))))),n=e.completionStore.completions.map((function(t){return p.a.createElement(qe,{key:t.id,item:t,store:e})}));return p.a.createElement(U.a,{title:t,size:"small",bodyStyle:{padding:"0",paddingTop:"1px"}},p.a.createElement(B.b,null,e.completionStore.completions?n:p.a.createElement("p",null,"No completions submitted yet")))}}]),n}(d.Component),$e=Object(E.c)(Ze),Qe=n(677),et=n(678),tt=n(259),nt=n.n(tt),at=function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){var e,t="".concat(nt.a.main);return this.props.style&&(e=this.props.style),this.props.className&&(t="".concat(nt.a.main," ").concat(this.props.className)),p.a.createElement("sup",{"data-copy":this.props.copy,className:t,style:e},this.props.children)}}]),n}(d.Component),rt=n(130),ot=n.n(rt),it=Object(E.b)("store")(Object(E.c)((function(e){var t,n,a,r,o,i=e.item,l=e.store,s={skip:"",update:"",submit:""},c=i.userGenerate,u=i.sentUserGenerate,d=i.versions,m=l.settings,g=m.enableHotkeys,h=m.enableTooltips;if(l.task&&(t=p.a.createElement("h4",{className:ot.a.task+" ls-task-info"},"Task ID: ",l.task.id)),g&&h&&(s.submit=p.a.createElement(at,null," [ Ctrl+Enter ]"),s.skip=p.a.createElement(at,null," [ Ctrl+Space ]"),s.update=p.a.createElement(at,null," [ Alt+Enter] ")),!l.completionStore.predictSelect||l.explore){var f=l.isSubmitting;l.hasInterface("skip")&&(n=p.a.createElement(L.a,{title:"Skip task: [ Ctrl+Space ]",mouseEnterDelay:.8},p.a.createElement(D.a,{disabled:f,type:"ghost",onClick:l.skipTask,className:ot.a.skip+" ls-skip-btn"},"Skip ",s.skip))),(c&&!u||l.explore&&!c&&l.hasInterface("submit"))&&(r=p.a.createElement(L.a,{title:"Save results: [ Ctrl+Enter ]",mouseEnterDelay:.8},p.a.createElement(D.a,{disabled:f,type:"primary",icon:p.a.createElement(Qe.a,null),onClick:l.submitCompletion,className:ot.a.submit+" ls-submit-btn"},"Submit ",s.submit))),(c&&u||!c&&l.hasInterface("update"))&&(a=p.a.createElement(L.a,{title:"Update this task: [ Alt+Enter ]",mouseEnterDelay:.8},p.a.createElement(D.a,{disabled:f,type:"primary",icon:p.a.createElement(et.a,null),onClick:l.updateCompletion,className:"ls-update-btn"},u||d.result?"Update":"Submit"," ",s.update))),l.hasInterface("completions:menu")||(o=p.a.createElement(Je,{item:i}))}var y=p.a.createElement("div",{className:ot.a.block},p.a.createElement("div",{className:ot.a.wrapper},p.a.createElement("div",{className:ot.a.container},n,a,r,o),t));return("completion"===i.type||l.explore)&&y}))),lt=n(660),st=n(667),ct=function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(){var e;Object(h.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={res:null,config:e.props.store.config,data:e.props.store.task.data,completions:""},e}return Object(f.a)(n,[{key:"render",value:function(){var e=this,t=this,n=this.props.store,a=n.completionStore.selected;return p.a.createElement("div",null,p.a.createElement("br",null),p.a.createElement("h2",null,"Debug"),p.a.createElement("div",null,p.a.createElement(D.a,{onClick:function(t){e.setState({res:JSON.stringify(n.completionStore.selected.toJSON())})}},"Serialize whole tree"),p.a.createElement(D.a,{onClick:function(t){e.setState({res:JSON.stringify(n.completionStore.selected.serializeCompletion())})}},"Seriealize results tree"),p.a.createElement(D.a,{onClick:function(e){t.state.res&&a.deserializeCompletion(JSON.parse(t.state.res))}},"Load Serialized Results"),p.a.createElement(D.a,{onClick:function(e){var a=n.completionStore.addInitialCompletion();n.completionStore.selectCompletion(a.id),t.state.res&&a.deserializeCompletion(JSON.parse(t.state.res))}},"Load As New Completion"),p.a.createElement(D.a,{onClick:function(t){e.setState({res:n.task.data})}},"Task data"),p.a.createElement(D.a,{onClick:function(e){var a=JSON.parse(t.state.res),r={id:a.id,project:2,data:JSON.stringify(a)};n.resetState(),n.addTask(r),n.addGeneratedCompletion(r),n.markLoading(!1),n.completionStore.selected&&n.completionStore.selected.traverseTree((function(e){return e.updateValue&&e.updateValue(t)}))}},"Simulate Loading Task")),p.a.createElement(lt.a,null,p.a.createElement("div",{style:{display:"flex"}},p.a.createElement("div",{style:{flexBasis:"50%"}},p.a.createElement("p",null,"Config"),p.a.createElement(st.a.TextArea,{rows:22,value:this.state.config,className:"is-search",onChange:function(t){e.setState({config:t.target.value})}})),p.a.createElement("div",{style:{flexBasis:"50%"}},p.a.createElement("p",null,"Data"),p.a.createElement(st.a.TextArea,{rows:10,value:this.state.data,className:"is-search",onChange:function(t){e.setState({data:t.target.value})}}),p.a.createElement("p",null,"Completions"),p.a.createElement(st.a.TextArea,{rows:10,value:this.state.completions,className:"is-search",onChange:function(t){e.setState({completions:t.target.value})}}))),p.a.createElement(D.a,{style:{width:"100%"},onClick:function(t){var a=e.state.config,r=JSON.parse(e.state.completions||'[{ "result": [] }]'),o=JSON.parse(e.state.data);n.resetState(),n.assignConfig(a),n.assignTask({data:o}),n.initializeStore({completions:r,predictions:[]});var i=n.completionStore;i.completions.length&&i.selectCompletion(i.completions[0].id)}},"Apply")))}}]),n}(d.Component),ut=Object(E.c)(ct),dt=n(679),pt=n(680),mt=n(681),gt=n(682),ht=n(683),ft=n(684),yt=n(167),vt=n.n(yt),bt=Object(E.c)((function(e){var t=e.store,n=t.completionStore.selected.history;return p.a.createElement("div",{className:vt.a.container+" ls-panel"},p.a.createElement("div",{className:"".concat(vt.a.block," ").concat(vt.a.block__controls)},p.a.createElement(D.a,{type:"ghost",icon:p.a.createElement(dt.a,null),onClick:function(e){n&&n.canUndo&&n.undo(),e.preventDefault()}},"Undo",t.settings.enableHotkeys&&t.settings.enableTooltips&&p.a.createElement(at,null,"[ Ctrl+z ]")),p.a.createElement(D.a,{type:"ghost",icon:p.a.createElement(pt.a,null),onClick:function(e){n&&n.canRedo&&n.redo(),e.preventDefault()}},"Redo"),p.a.createElement(D.a,{type:"ghost",icon:p.a.createElement(mt.a,null),onClick:function(e){n&&n.reset()}},"Reset"),t.setPrelabeling&&p.a.createElement(D.a,{style:{display:"none"},onClick:function(e){t.resetPrelabeling()}}," ","Reset Prelabeling"),t.hasInterface("debug")&&p.a.createElement("span",null,n.undoIdx," / ",n.history.length,n.isFrozen&&" (frozen)")),p.a.createElement("div",{className:vt.a.block},t.description&&t.showingDescription&&p.a.createElement(D.a,{type:"primary",onClick:function(e){t.toggleDescription()}},"Hide Instructions"),t.description&&!t.showingDescription&&p.a.createElement(D.a,{type:"primary",onClick:function(e){t.toggleDescription()}},"Show Instructions"),p.a.createElement(D.a,{type:"dashed",icon:p.a.createElement(gt.a,null),onClick:function(e){return t.toggleSettings(),e.preventDefault(),!1}}),p.a.createElement(D.a,{type:"dashed",className:"ls-fs",icon:t.settings.fullscreen?p.a.createElement(ht.a,null):p.a.createElement(ft.a,null),onClick:function(e){return t.settings.toggleFullscreen(),e.preventDefault(),!1}})))})),wt=n(685),xt=(n(686),Object(E.c)((function(e){var t=e.item,n=e.store;return p.a.createElement(B.b.Item,{key:t.id,className:t.selected?"".concat(Ke.a.completion," ").concat(Ke.a.completion_selected):Ke.a.completion,onClick:function(e){!t.selected&&n.completionStore.selectPrediction(t.id)}},p.a.createElement("div",{className:Ke.a.itembtns},p.a.createElement("div",null,p.a.createElement("div",{className:Ke.a.title},t.createdBy?"Model (".concat(t.createdBy,")"):null),"Created",p.a.createElement("i",null,t.createdAgo?" ".concat(t.createdAgo," ago"):" ".concat(Xe.UDate.prettyDate(t.createdDate)))),p.a.createElement("div",{className:Ke.a.buttons},t.selected&&p.a.createElement(L.a,{placement:"topLeft",title:"Add a new completion based on this prediction"},p.a.createElement(D.a,{size:"small",onClick:function(e){e.preventDefault();var t=n.completionStore,a=t.selected,r=t.addCompletionFromPrediction(a);window.setTimeout((function(){n.completionStore.selectCompletion(r.id)}),50)}},p.a.createElement(wt.a,null))))))}))),Et=function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){var e=this.props.store,t=e.completionStore.predictions,n=p.a.createElement("div",{className:Ke.a.title+" "+Ke.a.titlespace},p.a.createElement("h3",null,"Predictions"),e.completionStore.predictions.length>0&&!1);return p.a.createElement(U.a,{title:n,size:"small",bodyStyle:{padding:"0"}},p.a.createElement(B.b,null,t&&t.length?t.map((function(t){return p.a.createElement(xt,{key:t.id,item:t,store:e})})):p.a.createElement(B.b.Item,null,p.a.createElement("div",{style:{padding:"0 12px"}},"No predictions"))))}}]),n}(d.Component),St=Object(E.c)(Et),_t=n(324),kt=n.n(_t),Ot=function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"componentDidMount",value:function(){var e=this.props.completion;e&&e.updateObjects()}},{key:"render",value:function(){var e=kt.a.block;return this.props.className&&(e=e+" "+this.props.className),p.a.createElement("div",{className:e},this.props.children)}}]),n}(p.a.Component),Ct=n(659),jt=n(663),Rt=n(264),Nt=n(166),Tt=n(117),Mt=n.n(Tt),At={},zt={};Mt.a.filter=function(e){if("__none__"!==Mt.a.getScope()){var t=(e.target||e.srcElement).tagName,n=(e.target||e.srcElement).name;return Mt.a.setScope(/^(INPUT|TEXTAREA|SELECT)$/.test(t)?n:"__main__"),!0}};var Pt={removeKey:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"__main__";Mt.a.unbind(e,t),delete At[e],delete zt[e]},addKey:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"__main__";At[e]||(At[e]=t,zt[e]=n,Mt()(e,a,t))},unbindAll:function(){for(var e=0,t=Object.keys(At);e<t.length;e++){var n=t[e];Mt.a.unbind(n)}At={}},makeComb:function(){for(var e="1234567890qwetasdfgzxcvbyiopjklnm".split(""),t=0;t<=e.length;t++){var n=void 0;if(n=e[t],!At.hasOwnProperty(n))return n}return null},setScope:function(e){Mt.a.setScope(e)},getKeys:function(){return Object.keys(At)},keysDescipritions:function(){return zt}},Lt=function(){var e=Pt.keysDescipritions(),t=Object.keys(e).filter((function(t){return e[t]})).map((function(t){return new Object({key:t,descr:e[t]})}));return p.a.createElement(Ct.a,{columns:[{title:"Key",dataIndex:"key",key:"key"},{title:"Description",dataIndex:"descr",key:"descr"}],dataSource:t,size:"small"})},Dt=Object(E.c)((function(e){var t=e.store;return p.a.createElement(jt.a,{visible:t.showingSettings,title:"Settings",bodyStyle:{paddingTop:"0"},footer:"",onCancel:t.toggleSettings},p.a.createElement(Rt.a,{defaultActiveKey:"1"},p.a.createElement(Rt.a.TabPane,{tab:"General",key:"1"},p.a.createElement(Nt.a,{checked:t.settings.enableHotkeys,onChange:function(){t.settings.toggleHotkeys()}},"Enable labeling hotkeys"),p.a.createElement("br",null),p.a.createElement(Nt.a,{checked:t.settings.enableTooltips,onChange:function(){t.settings.toggleTooltips()}},"Show hotkey tooltips"),p.a.createElement("br",null),p.a.createElement(Nt.a,{checked:t.settings.enableLabelTooltips,onChange:function(){t.settings.toggleLabelTooltips()}},"Show labels hotkey tooltips"),p.a.createElement("br",null),p.a.createElement(Nt.a,{checked:t.settings.showLabels,onChange:function(){t.settings.toggleShowLabels()}},"Show labels inside the regions"),p.a.createElement("br",null),p.a.createElement(Nt.a,{checked:t.settings.continuousLabeling,onChange:function(){t.settings.toggleContinuousLabeling()}},"Keep label selected after creating a region"),p.a.createElement("br",null),p.a.createElement(Nt.a,{checked:t.settings.selectAfterCreate,onChange:t.settings.toggleSelectAfterCreate},"Select regions after creating"),p.a.createElement("br",null),p.a.createElement(Nt.a,{checked:t.settings.showLineNumbers,onChange:t.settings.toggleShowLineNumbers},"Show line numbers for Text")),p.a.createElement(Rt.a.TabPane,{tab:"Hotkeys",key:"2"},p.a.createElement(Lt,null)),p.a.createElement(Rt.a.TabPane,{tab:"Layout",key:"3"},p.a.createElement(Nt.a,{checked:t.settings.bottomSidePanel,onChange:function(){t.settings.toggleBottomSP()}},"Move sidepanel to the bottom"),p.a.createElement("br",null),p.a.createElement(Nt.a,{checked:t.settings.displayLabelsByDefault,onChange:t.settings.toggleSidepanelModel},"Display Labels by default in Results panel"),p.a.createElement("br",null),p.a.createElement(Nt.a,{value:"Show Completions panel",defaultChecked:t.settings.showCompletionsPanel,onChange:function(){t.settings.toggleCompletionsPanel()}},"Show Completions panel"),p.a.createElement("br",null),p.a.createElement(Nt.a,{value:"Show Predictions panel",defaultChecked:t.settings.showPredictionsPanel,onChange:function(){t.settings.togglePredictionsPanel()}},"Show Predictions panel"))))})),It=n(672),Ht=n(129),Bt=n(664),Ut=n(658),Vt=n(212),Ft=n(697),Wt=n(694),Yt=n(698),Xt=n(699),Gt=n(700),Kt=n(701),Jt=(n(607),n(91)),qt=n.n(Jt),Zt=n(114),$t=n.n(Zt),Qt=n(14),en=n(687),tn=n(688),nn=n(689),an=n(690),rn=n(691),on=n(692),ln=n(693),sn=n(695),cn=n(696),un=n(214),dn=n.n(un),pn={TextRegionModel:["Text",en.a,function(e){return p.a.createElement("span",{className:null},e.text.substring(0,100))}],HyperTextRegionModel:["HTML",en.a,function(e){return p.a.createElement("span",{style:{color:"#5a5a5a"}},e.text)}],AudioRegionModel:["Audio",tn.a,function(e){return"Audio ".concat(e.start.toFixed(2)," - ").concat(e.end.toFixed(2))}],TimeSeriesRegionModel:["TimeSeries",nn.a,function(e){return"TS ".concat(e.object.formatTime(e.start)," - ").concat(e.object.formatTime(e.end))}],TextAreaRegionModel:["Input",an.a,function(e){return p.a.createElement(d.Fragment,null,"Input ",p.a.createElement("span",{style:{color:"#5a5a5a"}},e._value))}],RectRegionModel:["Rect",rn.a,function(e){var t=e.width*e.scaleX,n=e.height*e.scaleY;return"Rectangle ".concat(t.toFixed(2)," x ").concat(n.toFixed(2))}],PolygonRegionModel:["Polygon",on.a,function(){return"Polygon"}],EllipseRegionModel:["Ellipse",ln.a,function(e){var t=e.radiusX*e.scaleX,n=e.radiusY*e.scaleY,a=e.rotation;return"Ellipse ".concat(t.toFixed(2)," x ").concat(n.toFixed(2),", \u03b8 = ").concat(a.toFixed(2),"\xb0,\n        center = (").concat(e.x.toFixed(2),", ").concat(e.y.toFixed(2),")")}],KeyPointRegionModel:["KeyPoint",Wt.a,function(e){return"KeyPoint ".concat(e.relativeX.toFixed(2),", ").concat(e.relativeY.toFixed(2))}],BrushRegionModel:["Brush",sn.a,function(){return"Brush"}],ChoicesModel:["Classification",cn.a,function(){return"Classification"}],TextAreaModel:["Input",an.a,function(){return"Input"}]},mn=Object(E.c)((function(e){var t=e.className,n=e.node,a=Object(x.getType)(n).name;a in pn||console.error("No ".concat(a," in NodeView"));var r=Object(Qt.a)(pn[a],3),o=r[1],i=r[2];if(n.labelsState){var l=n.labelsState.selectedAliases;l.length&&(o=function(){return p.a.createElement("span",{className:dn.a.alias},l.join(","))})}return p.a.createElement("span",{className:[dn.a.node,t].filter(Boolean).join(" ")},p.a.createElement(o,null),i(n))})),gn=Object(E.c)((function(e){var t=e.node,n=Object(x.getRoot)(t).completionStore.selected.regionStore.sortedRegions.indexOf(t),a=Object(x.getType)(t).name;if(!(a in pn))return null;var r=t.getOneColor(),o={};o=r?{backgroundColor:r}:{backgroundColor:"#fff",color:"#999",boxShadow:"0 0 0 1px #d9d9d9 inset"};var i=Object(Qt.a)(pn[a],2),l=i[0],s=i[1];return p.a.createElement("span",{className:dn.a.minimal},n>=0&&p.a.createElement(I.a,{count:n+1,style:o}),p.a.createElement(s,null),l)})),hn=n(103),fn=n(331),yn=n.n(fn),vn=function(e){var t=e.number,n=e.className,a=Object(hn.a)(e,["number","className"]);return p.a.createElement("div",Object.assign({className:[yn.a.badge,n].filter(Boolean).join(" ")},a),t)},bn=Object(E.c)((function(e){var t=e.item,n=e.idx,a=e.flat;if(!Object(x.isAlive)(t))return null;var r=Object(x.getRoot)(t).completionStore.selected,o=[qt.a.lstitem,a&&qt.a.flat,!0===t.hidden&&qt.a.hidden,t.selected&&qt.a.selected].filter(Boolean),i=t.getOneColor(),l={};return l=i?{backgroundColor:i}:{backgroundColor:"#fff",color:"#999",boxShadow:"0 0 0 1px #d9d9d9 inset"},p.a.createElement(B.b.Item,{key:t.id,className:o.join(" "),onClick:function(){r.selectArea(t)},onMouseOver:function(){t.setHighlight(!0)},onMouseOut:function(){t.setHighlight(!1)}},p.a.createElement(vn,{number:n+1,style:l}),p.a.createElement(mn,{node:t,className:qt.a.node}),!t.editable&&p.a.createElement(I.a,{count:"ro",style:{backgroundColor:"#ccc"}}),t.hideable&&p.a.createElement(D.a,{size:"small",type:"text",icon:t.hidden?p.a.createElement(Ft.a,null):p.a.createElement(Wt.a,null),onClick:t.toggleHidden,className:t.hidden?qt.a.hidden:qt.a.visible}),t.score&&p.a.createElement("span",{className:qt.a.confbadge,style:{color:Xe.Colors.getScaleGradient(t.score)}},t.score.toFixed(2)))})),wn=Object(E.c)((function(e){var t=e.item,n=(e.idx,{backgroundColor:t.background,color:t.selectedcolor,cursor:"pointer",margin:"5px"});return p.a.createElement(It.a,{style:n,size:t.size},t._value)})),xn=function(e){e.store;var t=e.regionStore;return p.a.createElement(Ht.a,{selectedKeys:[t.view]},p.a.createElement(Ht.a.Item,{key:"regions"},p.a.createElement("div",{onClick:function(e){return t.setView("regions"),e.preventDefault(),!1},style:{width:"135px",display:"flex",justifyContent:"space-between"}},p.a.createElement("div",null,"Regions"))),p.a.createElement(Ht.a.Item,{key:"labels"},p.a.createElement("div",{onClick:function(e){return t.setView("labels"),e.preventDefault(),!1},style:{width:"135px",display:"flex",justifyContent:"space-between"}},p.a.createElement("div",null,"Labels"))))},En=Object(E.c)((function(e){var t=e.regionStore;return p.a.createElement(Ht.a,{selectedKeys:[t.sort]},p.a.createElement(Ht.a.Item,{key:"date"},p.a.createElement("div",{onClick:function(e){return t.setSort("date"),e.preventDefault(),!1},style:{width:"135px",display:"flex",justifyContent:"space-between"}},p.a.createElement("span",null,p.a.createElement(Yt.a,null)," Date"),p.a.createElement("span",null,"date"===t.sort&&("asc"===t.sortOrder?"\u2193":"\u2191")))),p.a.createElement(Ht.a.Item,{key:"score"},p.a.createElement("div",{onClick:function(e){return t.setSort("score"),e.preventDefault(),!1},style:{width:"135px",display:"flex",justifyContent:"space-between"}},p.a.createElement("span",null,p.a.createElement(Xt.a,null)," Score"),p.a.createElement("span",null,"score"===t.sort&&("asc"===t.sortOrder?"\u2193":"\u2191")))))})),Sn=Object(E.c)((function(e){var t=e.regionStore.asLabelsTree((function(e,t,n){return{key:e.id,title:n?p.a.createElement(wn,{item:e,idx:t}):p.a.createElement(bn,{item:e,idx:t})}}));return p.a.createElement(Bt.a,{className:qt.a.treelabels,style:{border:"1px solid #d9d9d9",borderRadius:"2px"},treeData:t,showIcon:!1,blockNode:!0,defaultExpandAll:!0,autoExpandParent:!0,switcherIcon:p.a.createElement(Gt.a,null)})})),_n=Object(E.c)((function(e){var t=e.regionStore,n=!t.sortedRegions.some((function(e){return""!==e.parentID})),a=t.asTree((function(e,t){return{key:e.id,title:p.a.createElement(bn,{item:e,idx:t,flat:n})}}));return p.a.createElement(Bt.a,{className:qt.a.treelabels,treeData:a,draggable:!0,showIcon:!1,blockNode:!0,defaultExpandAll:!0,autoExpandParent:!0,switcherIcon:p.a.createElement(Gt.a,null),onDrop:function(e){var n=e.node,a=e.dragNode,r=e.dropPosition,o=e.dropToGap,i=n.props.eventKey,l=a.props.eventKey,s=n.props.pos.split("-");r-=parseInt(s[s.length-1]);var c=s.length,u=t.findRegionID(i),d=t.findRegionID(l);if(t.unhighlightAll(),2===c&&o&&-1===r)d.setParentID("");else if(-1!==r){var p,m,g,h=((null===(p=u.labeling)||void 0===p?void 0:p.selectedLabels)||[]).filter((function(e){return e.groupcancontain}));if(h.length){var f=d.labeling.selectedLabels,y=Xe.Checkers.flatten(h.map((function(e){return e.groupcancontain.split(",")}))),v=Xe.Checkers.flatten(f.map((function(e){return e.alias?[e.alias,e.value]:[e.value]})));if(0===y.filter((function(e){return-1!==v.indexOf(e)})).length)return}if(null===(m=u.labeling)||void 0===m||null===(g=m.from_name)||void 0===g?void 0:g.groupdepth){var b,w=Number(u.labeling.from_name.groupdepth);if(b=function(e){if(!e)return 0;var n=t.filterByParentID(e.pid).map((function(e){return b(e)}));return 0==n.length?0:1+Math.max.apply(Math,n)},w>=0){w-=b(d);for(var x=u;x;)x=t.findRegion(x.parentID),w-=1;if(w<0)return}}d.setParentID(u.id)}}})})),kn=Object(E.c)((function(e){e.store;var t=e.regionStore,n=t.regions;return p.a.createElement("div",null,p.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",paddingLeft:"4px",paddingRight:"4px",alignItems:"center"}},p.a.createElement("div",{style:{flex:1}},p.a.createElement(Ut.a,{dashed:!0,orientation:"left",style:{height:"auto"}},p.a.createElement(Vt.a,{overlay:p.a.createElement(xn,{regionStore:t}),placement:"bottomLeft"},p.a.createElement("span",{className:$t.a.link,onClick:function(e){return e.preventDefault()}},"regions"===t.view?p.a.createElement("span",null,"Regions (",n.length,")"):null,"labels"===t.view?"Labels":null)))),n.length>0&&"regions"===t.view&&p.a.createElement(Vt.a,{overlay:p.a.createElement(En,{regionStore:t}),placement:"bottomLeft"},p.a.createElement("span",{className:$t.a.link,onClick:function(e){return e.preventDefault()}},p.a.createElement(Kt.a,null)," Sort"))),!n.length&&p.a.createElement("p",null,"No Regions created yet"),n.length>0&&"regions"===t.view&&p.a.createElement(_n,{regionStore:t}),n.length>0&&"labels"===t.view&&p.a.createElement(Sn,{regionStore:t}))})),On=n(702),Cn=n(703),jn=n(662),Rn=n(84),Nn=n.n(Rn),Tn=jn.a.Paragraph,Mn=jn.a.Text,An=function(e){return e.type.endsWith("labels")?(t=e,p.a.createElement(Mn,{key:t.pid,className:Nn.a.labels},"Labels:\xa0",t.selectedLabels.map((function(e){var t=e.background||"#000000";return p.a.createElement(It.a,{key:e.id,color:t,className:Nn.a.tag},e.value)})))):"rating"===e.type?p.a.createElement(Tn,null,"Rating: ",e.mainValue):"textarea"===e.type?p.a.createElement(Tn,{className:Nn.a.row},p.a.createElement(Mn,null,"Text: "),p.a.createElement(Mn,{mark:!0,className:Nn.a.long},e.mainValue.join("\n"))):"choices"===e.type?p.a.createElement(Tn,null,"Choices: ",e.mainValue.join(", ")):null;var t},zn=Object(E.c)((function(e){var t=e.store,n=e.completion,a=n.highlightedNode;return p.a.createElement(d.Fragment,null,p.a.createElement("p",{className:Nn.a.row},p.a.createElement(gn,{node:a})," (id: ",a.id,")"," ",!a.editable&&p.a.createElement(I.a,{count:"readonly",style:{backgroundColor:"#ccc"}})),p.a.createElement("div",{className:Nn.a.statesblk+" ls-entity-states"},a.score&&p.a.createElement(d.Fragment,null,p.a.createElement(Mn,null,"Score: ",p.a.createElement(Mn,{underline:!0},a.score))),a.normalization&&p.a.createElement(Mn,null,"Normalization: ",p.a.createElement(Mn,{code:!0},a.normalization),"\xa0",p.a.createElement(F.a,{type:"delete",style:{cursor:"pointer"},onClick:function(){a.deleteNormalization()}})),p.a.createElement(d.Fragment,null,a.results.map(An))),p.a.createElement("div",{className:Nn.a.block+" ls-entity-buttons"},a.editable&&p.a.createElement(d.Fragment,null,p.a.createElement(L.a,{placement:"topLeft",title:"Create Relation: [r]"},p.a.createElement(D.a,{"aria-label":"Create Relation",className:Nn.a.button,onClick:function(){n.startRelationMode(a)}},p.a.createElement(On.a,null),t.settings.enableHotkeys&&t.settings.enableTooltips&&p.a.createElement(at,null,"[ r ]"))),p.a.createElement(L.a,{placement:"topLeft",title:"Create Normalization"},p.a.createElement(D.a,{className:Nn.a.button,onClick:function(){n.setNormalizationMode(!0)}},p.a.createElement(Y.a,null)))),p.a.createElement(L.a,{placement:"topLeft",title:"Unselect: [u]"},p.a.createElement(D.a,{className:Nn.a.button,type:"dashed",onClick:function(){n.unselectAll()}},p.a.createElement(Cn.a,null),t.settings.enableHotkeys&&t.settings.enableTooltips&&p.a.createElement(at,null,"[ u ]"))),a.editable&&p.a.createElement(L.a,{placement:"topLeft",title:"Delete Entity: [Backspace]"},p.a.createElement(D.a,{type:"danger",className:Nn.a.button,onClick:function(){n.highlightedNode.deleteRegion()}},p.a.createElement(F.a,null),t.settings.enableHotkeys&&t.settings.enableTooltips&&p.a.createElement(at,null,"[ Bksp ]")))),n.normalizationMode&&p.a.createElement(lt.a,{style:{marginTop:"0.5em",marginBottom:"0.5em"},onFinish:function(e){a.setNormalization(a.normInput),n.setNormalizationMode(!1)}},p.a.createElement(st.a,{onChange:function(e){var t=e.target.value;a.setNormInput(t)},style:{marginBottom:"0.5em"},placeholder:"Add Normalization"}),p.a.createElement(D.a,{type:"primary",htmlType:"submit",style:{marginRight:"0.5em"}},"Add"),p.a.createElement(D.a,{type:"danger",htmlType:"reset",onClick:function(e){return n.setNormalizationMode(!1),e.preventDefault(),!1}},"Cancel")))})),Pn=n(165),Ln=n(704),Dn=n(705),In=n(706),Hn=n(707),Bn=n(92),Un=n.n(Bn),Vn=Pn.a.Option,Fn=Object(E.c)((function(e){e.store;var t=e.rl.relations,n=t.getSelected().map((function(e){return e.value}));return p.a.createElement("div",{style:{marginTop:"10px"}},p.a.createElement("h4",{className:Un.a.header},"LABELS"),p.a.createElement(Pn.a,{mode:"multiple"===t.choice?"multiple":"",style:{width:"100%"},placeholder:"Please select",defaultValue:n,onChange:function(e,n){var a=te(e);t.unselectAll(),a.forEach((function(e){return t.findRelation(e).setSelected(!0)}))}},t.children.map((function(e){return p.a.createElement(Vn,{key:e.value,style:{background:e.background}},e.value)}))))})),Wn=Object(E.c)((function(e){e.store;var t=e.rl;if(!Object(x.isValidReference)((function(){return t.node1}))||!Object(x.isValidReference)((function(){return t.node2})))return null;var n={left:p.a.createElement(Ln.a,null),right:p.a.createElement(Dn.a,null),bi:p.a.createElement(In.a,null)};return p.a.createElement("div",null,p.a.createElement("div",{className:Un.a.section__blocks},p.a.createElement("div",null,p.a.createElement(gn,{node:t.node1})),p.a.createElement(D.a,{onClick:function(){return t.rotateDirection()},size:"small",className:Un.a.relationbtn},n[t.direction]),p.a.createElement("div",null,p.a.createElement(gn,{node:t.node2}))))})),Yn=Object(E.c)((function(e){var t=e.item,n=Object(x.getRoot)(t).completionStore.selected.highlightedNode,a=n===t.node1||n===t.node2;return p.a.createElement(B.b.Item,{className:a&&Un.a.selected,key:t.id,actions:[],onMouseEnter:function(){t.toggleHighlight(),t.setSelfHighlight(!0)},onMouseLeave:function(){t.toggleHighlight(),t.setSelfHighlight(!1)}},p.a.createElement("div",{className:Un.a.item},p.a.createElement("div",null,p.a.createElement(Wn,{rl:t})),p.a.createElement("div",null,t.hasRelations&&p.a.createElement(D.a,{size:"small",onClick:function(){t.toggleMeta()},className:Un.a.button},p.a.createElement(Hn.a,null)),"\xa0",p.a.createElement(D.a,{size:"small",className:Un.a.button,onClick:function(){return t.node1.setHighlight(!1),t.node2.setHighlight(!1),t.parent.deleteRelation(t),!1},danger:!0},p.a.createElement(F.a,null)))),t.showMeta&&p.a.createElement(Fn,{rl:t}))})),Xn=Object(E.c)((function(e){var t=e.store.completionStore.selected,n=t.relationStore.relations,a=n.length>0,r=t.relationStore.showConnections;return p.a.createElement(d.Fragment,null,p.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",paddingLeft:"4px",paddingRight:"4px",alignItems:"center"}},p.a.createElement("div",{style:{flex:1,paddingRight:10}},p.a.createElement(Ut.a,{dashed:!0,orientation:"left",style:{height:"auto"}},"Relations (",n.length,")")),a&&p.a.createElement("div",null,p.a.createElement(D.a,{size:"small",type:"link",icon:r?p.a.createElement(Ft.a,null):p.a.createElement(Wt.a,null),onClick:function(){return t.relationStore.toggleConnections()},className:[r?Un.a.uihidden:Un.a.uivisible,$t.a.link]}))),!a&&p.a.createElement("p",null,"No Relations added yet"),a&&p.a.createElement(B.b,{size:"small",bordered:!0,itemLayout:"vertical",className:Un.a.list,dataSource:t.relationStore.relations,renderItem:function(e){return p.a.createElement(Yn,{item:e})}}))})),Gn=n(342),Kn=n.n(Gn),Jn=Object(E.c)((function(e){var t=e.store,n=t.completionStore.selected,a=t.completionStore.selected,r=n.highlightedNode,o=a.regionStore.regions,i=p.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},p.a.createElement("h3",{style:{margin:0}},"Results"),o.length>0&&a.editable&&p.a.createElement(H.a,{placement:"bottomLeft",title:"Please confirm you want to delete all labeled regions",onConfirm:function(){a.deleteAllRegions()},okText:"Delete",okType:"danger",cancelText:"Cancel"},p.a.createElement(D.a,{size:"small",type:"danger"},p.a.createElement(F.a,null),t.settings.enableHotkeys&&t.settings.enableTooltips&&p.a.createElement(at,null,"[ ctrl+bksp ]"))));return p.a.createElement(U.a,{title:i,size:"small",className:Kn.a.card},r&&p.a.createElement(zn,{store:t,completion:n}),!n.highlightedNode&&p.a.createElement("p",{style:{marginBottom:0}},"Nothing selected"),p.a.createElement(kn,{store:t,regionStore:n.regionStore}),p.a.createElement(Xn,{store:t,item:n}))})),qn=n(50),Zn=function(){function e(){Object(h.a)(this,e)}return Object(f.a)(e,null,[{key:"normalizeAngle",value:function(e){return(e+360)%360*(Math.PI/180)}},{key:"getPointsBBox",value:function(e){var t=[null,null,null,null];return e.forEach((function(e,n){var a=2*Math.round(n/2)-n;0===a?((null===t[0]||t[0]>=e)&&(t[0]=e),(null===t[2]||t[2]<=e)&&(t[2]=e)):1===a&&((null===t[1]||t[1]>=e)&&(t[1]=e),(null===t[3]||t[3]<=e)&&(t[3]=e))})),t}},{key:"distance",value:function(e,t){var n=Object(Qt.a)(e,2),a=n[0],r=n[1],o=Object(Qt.a)(t,2),i=o[0],l=o[1];return Math.sqrt(Math.pow(i-a,2)+Math.pow(l-r,2))}},{key:"toRectCoordinates",value:function(e){var t=e.x,n=e.y,a=e.width,r=e.height;return{x1:t,x2:t+a,x3:t+a,x4:t,y1:n,y2:n,y3:n+r,y4:n+r}}},{key:"convertToRectBBox",value:function(e){return{x:e.x1,y:e.y1,width:e.x2-e.x1,height:e.y3-e.y1}}},{key:"closestRects",value:function(e,t){var n=this;return e.reduce((function(e,a){var r=n.toRectCoordinates(a);return t.forEach((function(t){var a=n.toRectCoordinates(t),o=[n.distance([r.x1,r.y1],[a.x1,r.y1]),n.distance([r.x2,r.y2],[a.x2,r.y2]),n.distance([r.x3,r.y3],[a.x3,r.y3]),n.distance([r.x4,r.y4],[a.x4,a.y4])].reduce((function(e,t){return e+t}))/4;e.push({distance:o,bbox:[n.convertToRectBBox(r),n.convertToRectBBox(a)]})})),e}),[]).sort((function(e,t){return e.distance-t.distance}))[0].bbox}},{key:"scaleBBox",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Object(u.a)(Object(u.a)({},e),{},{x:e.x*t,y:e.y*t,width:e.width*t,height:e.height*t})}},{key:"padding",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(u.a)(Object(u.a)({},e),{},{x:e.x-t,y:e.y-t,width:e.width+2*t,height:e.height+2*t})}},{key:"getEllipseBBox",value:function(e,t,n,a,r){var o=this.normalizeAngle(r),i=2*Math.max(n,a),l=2*Math.min(n,a),s=function(){var t=Math.atan(-l/2*Math.tan(o)/(i/2));return[t,t+Math.PI].map((function(t){return e+i/2*Math.cos(t)*Math.cos(o)-l/2*Math.sin(t)*Math.sin(o)})).sort((function(e,t){return t-e}))}(),c=Object(Qt.a)(s,2),u=c[0],d=c[1],p=function(){var e=Math.atan(l/2*1/Math.tan(o)/(i/2));return[e,e+Math.PI].map((function(e){return t+l/2*Math.sin(e)*Math.cos(o)+i/2*Math.cos(e)*Math.sin(o)})).sort((function(e,t){return t-e}))}(),m=Object(Qt.a)(p,2),g=m[0],h=m[1];return{x:d,y:h,width:u-d,height:g-h}}},{key:"getRectBBox",value:function(e,t,n,a,r){var o=this.normalizeAngle(r),i=function(n,a){return[(n-e)*Math.cos(o)-(a-t)*Math.sin(o)+e,(n-e)*Math.sin(o)+(a-t)*Math.cos(o)+t]},l=this.getPointsBBox([e,t].concat(Object(qn.a)(i(e+n,t)),Object(qn.a)(i(e+n,t+a)),Object(qn.a)(i(e,t+a)))),s=Object(Qt.a)(l,4),c=s[0],u=s[1];return{x:c,y:u,width:s[2]-c,height:s[3]-u}}},{key:"getPolygonBBox",value:function(e){var t=e.reduce((function(e,t){return[].concat(Object(qn.a)(e),[t.x,t.y])}),[]),n=this.getPointsBBox(t),a=Object(Qt.a)(n,4),r=a[0],o=a[1];return{x:r,y:o,width:a[2]-r,height:a[3]-o}}},{key:"getBrushBBox",value:function(e){var t=this.getPointsBBox(e),n=Object(Qt.a)(t,4),a=n[0],r=n[1];return{x:a,y:r,width:n[2]-a,height:n[3]-r}}},{key:"getDOMBBox",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return null;var n=e.getClientRects();if(0===n.length)return null;var a=function(e){return{x:e.x,y:e.y,width:e.width,height:e.height}};return t?a(n[0]):Array.from(e.getClientRects()).map(a)}}]),e}(),$n={x:0,y:0,width:0,height:0},Qn=function(){function e(t){Object(h.a)(this,e),this.options={},Object.assign(this.options,t)}return Object(f.a)(e,null,[{key:"bbox",value:function(e){var t=ta(e);return te(t).map((function(e){return Object.assign(Object(u.a)({},$n),e)}))}}]),Object(f.a)(e,[{key:"_source",get:function(){return this.options.source}},{key:"x",get:function(){return this.options.getX(this._source)}},{key:"y",get:function(){return this.options.getY(this._source)}},{key:"width",get:function(){return this.options.getWidth(this._source)}},{key:"height",get:function(){return this.options.getHeight(this._source)}}]),e}(),ea=function(e,t){var n=Zn.getDOMBBox(e.parent.imageRef,!0),a=Zn.scaleBBox(t,e.parent.zoomScale);return Object(u.a)(Object(u.a)({},a),{},{x:n.x+a.x,y:n.y+a.y})},ta=function(e){switch(e.type){case"textrange":case"hypertextregion":case"textarearegion":case"audioregion":case"timeseriesregion":return Zn.getDOMBBox(e.regionElement);case"rectangleregion":return ea(e,Zn.getRectBBox(e.x,e.y,e.width,e.height,e.rotation));case"ellipseregion":return ea(e,Zn.getEllipseBBox(e.x,e.y,e.radiusX,e.radiusY,e.rotation));case"polygonregion":return ea(e,Zn.getPolygonBBox(e.points));case"keypointregion":var t=Zn.getDOMBBox(e.parent.imageRef,!0),n=e.parent.zoomScale;return{x:e.x*n+t.x-2,y:e.y*n+t.y-2,width:4,height:4};case"brushregion":var a=Z(te(e.touches.filter((function(e){return"add"===e.type})).map((function(e){return Array.from(e.points)}))));return ea(e,Zn.getBrushBBox(a));default:return console.warn("Unknown region type: ".concat(e.type)),Object(u.a)({},$n)}},na=function(){function e(t){var n=this;Object(h.a)(this,e),this.params={},this._onUpdated=null,this.onChanged=function(){var e;null===(e=n.onUpdated)||void 0===e||e.call(n)},Object.assign(this.params,t),this.params.watcher&&(this._watcher=new this.params.watcher(this.params.root,this.params.element,this.onChanged))}return Object(f.a)(e,[{key:"boundingBox",value:function(){return Qn.bbox(this.params.element)}},{key:"onUpdate",value:function(e){this.onUpdated=e}},{key:"destroy",value:function(){this.onUpdated=null}}]),e}(),aa=function(){function e(t,n,a){var r=this;Object(h.a)(this,e),this.onUpdate=function(){r.callback()},this.root=t,this.element=n.regionElement,this.callback=a,this.handleUpdate()}return Object(f.a)(e,[{key:"handleResize",value:function(){window.addEventListener("resize",this.onUpdate)}},{key:"handleUpdate",value:function(){this.observer=new MutationObserver(this.onUpdate),this.observer.observe(this.element,{attributes:!0})}},{key:"destroy",value:function(){window.removeEventListener("resize",this.onUpdate),this.observer.disconnect()}}]),e}(),ra=n(10),oa=function(e){return function(){function t(e,n,a){var r=this;Object(h.a)(this,t),this.onUpdate=Ye((function(){r.callback()}),10),this.root=e,this.element=n,this.callback=a,this.handleUpdate()}return Object(f.a)(t,[{key:"handleUpdate",value:function(){this.disposers=this._watchProperties(this.element,e,[])}},{key:"destroy",value:function(){this.disposers.forEach((function(e){return e()}))}},{key:"_watchProperties",value:function(e,t,n){var a=this;return t.reduce((function(r,o){return"string"!==typeof o?Object.keys(o).forEach((function(t){a._watchProperties(e[t],o[t],n)})):Array.isArray(e)?e.forEach((function(e){return a._watchProperties(e,t,n)})):r.push(Object(ra.x)(e,o,a.onUpdate,!0)),r}),n)}}]),t}()},ia={parent:["zoomScale","zoomingPositionX","zoomingPositionY"]},la=function(e){switch(e.type){case"textregion":case"hypertextregion":case"audioregion":return aa;case"rectangleregion":return oa(["x","y","width","height","hidden",ia]);case"ellipseregion":return oa(["x","y","radiusX","radiusY","rotation","hidden",ia]);case"polygonregion":return oa(["hidden",{points:["x","y"]},ia]);case"keypointregion":return oa(["x","y","hidden",ia]);case"brushregion":return oa(["needsUpdate","hidden",ia]);case"timeseriesregion":return oa(["start","end",{parent:["zoomedRange"]}]);default:return null}},sa=function(e,t){return new na({root:t,element:e,watcher:la(e)})},ca=function(e,t){var n,a=null!==(n=Zn.getDOMBBox(t,!0))&&void 0!==n?n:{x:0,y:0},r=a.x,o=a.y;return e.boundingBox().map((function(e){var t=Zn.padding(e,3);return Object(u.a)(Object(u.a)({},t),{},{x:t.x-r,y:t.y-o})}))},ua=function(e){var t=e.x1,n=e.y1,a=e.w1,r=e.x2,o=e.y2,i=e.w2,l=e.limit,s=t+.5*a,c=r+.5*i,u=Math.min(n,o)-l;return{x1:s,x2:c,y1:n,y2:o,l1:Math.min(u,n-l),l2:Math.min(u,o-l),toEnd:s<c}},da=function(e){var t,n,a,r,o,i,l=e.x1,s=e.y1,c=e.w1,u=e.h1,d=e.x2,p=e.y2,m=e.w2,g=e.h2,h=e.limit,f="left";if(Math.min(l,d)-h<0&&(f="right"),"left"===f){t=l,a=s+.5*u,n=d,r=p+.5*g;var y=Math.min(t,n)-h;o=Math.min(y,t-h),i=Math.min(y,n-h)}else{t=l+c,a=s+.5*u,n=d+m,r=p+.5*g;var v=Math.max(t,n)+h;o=Math.max(v,t+h),i=Math.max(v,n+h)}return{x1:t,x2:n,y1:a,y2:r,l1:o,l2:i,toEnd:a<r,renderingSide:f}},pa=function(e,t){var n;return{id:e.id,label:te(null!==(n=e.labels)&&void 0!==n?n:[]).join(", "),color:"#fa541c",direction:e.direction,start:sa(e.startNode,t),end:sa(e.endNode,t),onChange(e){var t=Ye(e,50);this.start.onUpdate(t),this.end.onUpdate(t)},destroy(){this.start.destroy(),this.end.destroy()}}},ma=function(e){var t=e.start,n=e.end,a=e.root,r=Zn.closestRects(ca(t,a),ca(n,a)),o=Object(Qt.a)(r,2);return{start:o[0],end:o[1]}},ga=function(e,t){var n=e.x,a=e.y,r=e.width,o=e.height,i=t.x,l=t.y,s=t.width,c=t.height,u=function(e){var t=e.x1,n=e.y1,a=e.w1,r=e.x2,o=e.y2,i=e.w2;return n!==o&&(t<=r&&r<=t+a||t<=r+i&&r+i<=t+a)}({x1:n,y1:a,w1:r,x2:i,y2:l,w2:s});return function(e,t){var n,a,r,o,i,l,s,c,u,d,p,m,g,h=e.x1,f=e.y1,y=e.x2,v=e.y2,b=e.l1,w=e.l2,x=e.toEnd,E=e.renderingSide,S="vertical"===t;return S?(n=h,a=f,r=h,o=b+5,i=y+5*(x?-1:1),l=w,s=y,c=v,u=x?1:0,d=x?"".concat(5," -").concat(5):"-".concat(5," -").concat(5),p=x?"".concat(5," ").concat(5):"-".concat(5," ").concat(5),m=Math.min(h,y)+Math.abs(y-h)/2,g=b):S||"right"!==E?S||"left"!==E||(n=h,a=f,r=b+5,o=f,i=w,l=v+5*(x?-1:1),s=y,c=v,u=x?0:1,d=x?"-".concat(5," ").concat(5):"-".concat(5," -").concat(5),p=x?"".concat(5," ").concat(5):"".concat(5," -").concat(5),m=b,g=Math.min(f,v)+Math.abs(v-f)/2):(n=h,a=f,r=b-5,o=f,i=w,l=v+5*(x?-1:1),s=y,c=v,u=x?1:0,d=x?"".concat(5," ").concat(5):"".concat(5," -").concat(5),p=x?"-".concat(5," ").concat(5):"-".concat(5," -").concat(5),m=b,g=Math.min(f,v)+Math.abs(v-f)/2),[["M ".concat(n," ").concat(a),"".concat(r," ").concat(o),"a 5 5 0 0 ".concat(u," ").concat(d),"L ".concat(i," ").concat(l),"a 5 5 0 0 ".concat(u," ").concat(p),"L ".concat(s," ").concat(c)].join(" "),[m,g]]}((u?da:ua)({x1:n,y1:a,w1:r,h1:o,x2:i,y2:l,w2:s,h2:c,limit:15}),u?"horizontal":"vertical")},ha=function(e){var t=e.id,n=e.color;return p.a.createElement("marker",{id:"arrow-".concat(t),viewBox:"0 0 10 10",refX:8,refY:5,markerWidth:4,markerHeight:4,orient:"auto-start-reverse"},p.a.createElement("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:n}))},fa=function(e){var t=e.x,n=e.y,a=e.width,r=e.height;return p.a.createElement("rect",{x:t,y:n,width:a,height:r,fill:"none"})},ya=function(e){var t=e.id,n=e.command,a=e.color,r=e.direction,o=e.highlight,i=o?"#fa541c":a,l={d:n,stroke:i,fill:"none",strokeLinecap:"round"},s={};return"bi"!==r&&"right"!==r||(s.markerEnd="url(#arrow-".concat(t,")")),"bi"!==r&&"left"!==r||(s.markerStart="url(#arrow-".concat(t,")")),p.a.createElement(p.a.Fragment,null,p.a.createElement("defs",null,p.a.createElement(ha,{id:t,color:i})),o&&p.a.createElement("path",Object.assign({},l,{stroke:a,opacity:.1,strokeWidth:6})),p.a.createElement("path",Object.assign({},l,{opacity:o?1:.6,strokeWidth:2},s)))},va=function(e){var t=e.label,n=e.position,a=Object(Qt.a)(n,2),r=a[0],o=a[1],i=p.a.createRef(),l=Object(d.useState)({width:0,height:0,x:0,y:0}),s=Object(Qt.a)(l,2),c=s[0],u=s[1],m={transform:"translate(".concat(r,", ").concat(o,")"),textAnchor:"middle",dominantBaseline:"middle"};return Object(d.useEffect)((function(){var e=i.current.getBBox();u({x:e.x-5,y:e.y-3,width:e.width+10,height:e.height+6})}),[t]),p.a.createElement("g",m,p.a.createElement("rect",Object.assign({},c,{stroke:"#fff",strokeWidth:2,fill:"#a0a",rx:"3"})),p.a.createElement("text",Object.assign({ref:i},{fill:"white",style:{fontSize:12,fontFamily:"arial"}}),t))},ba=function(e){var t=e.id,n=e.startNode,a=e.endNode,r=e.direction,o=e.rootRef,i=e.highlight,l=e.dimm,s=e.labels,c=e.visible,m=o.current,g=!0===n.hidden||!0===a.hidden||!c,h=Object(d.useState)(),f=Object(Qt.a)(h,2)[1],y=pa({id:t,startNode:n,endNode:a,direction:r,labels:s},m),v=ma(Object(u.a)({root:m},y)),b=v.start,w=v.end,x=ga(b,w),E=Object(Qt.a)(x,2),S=E[0],_=E[1];return Object(d.useEffect)((function(){return y.onChange((function(){return f({})})),function(){return y.destroy()}}),[]),p.a.createElement("g",{opacity:l&&!i?.5:1,visibility:g?"hidden":"visible"},p.a.createElement(fa,b),p.a.createElement(fa,w),p.a.createElement(ya,{id:y.id,command:S,color:y.color,direction:y.direction,highlight:i}),y.label&&p.a.createElement(va,{label:y.label,position:_}))},wa=Object(E.c)((function(e){var t=e.relation,n=Object(hn.a)(e,["relation"]),a=t.node1,r=t.node2;return p.a.createElement(ba,Object.assign({id:t.id,startNode:a,endNode:r,direction:t.direction},n))})),xa=function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(){var e;Object(h.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).rootNode=p.a.createRef(),e.state={shouldRender:!1,souldRenderConnections:Math.random()},e.onResize=function(){e.setState({souldRenderConnections:Math.random()})},e}return Object(f.a)(n,[{key:"componentDidMount",value:function(){this.rootNode.current&&this.setState({shouldRender:!0}),window.addEventListener("resize",this.onResize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onResize)}},{key:"render",value:function(){var e=this.props,t=e.relations,n=e.visible,a=e.highlighted,r=!!a;return p.a.createElement("svg",{ref:this.rootNode,xmlns:"http://www.w3.org/2000/svg",style:{top:0,left:0,width:"100%",height:"100%",position:"absolute",pointerEvents:"none",zIndex:100}},this.state.shouldRender&&this.renderRelations(t,n,r,a))}},{key:"renderRelations",value:function(e,t,n,a){var r=this;return e.map((function(e){var o,i=a===e;return p.a.createElement(wa,{key:e.id,relation:e,rootRef:r.rootNode,labels:null===(o=e.relations)||void 0===o?void 0:o.selectedValues(),dimm:n&&!i,highlight:i,visible:i||t,shouldUpdate:r.state.souldRenderConnections})}))}}]),n}(d.PureComponent),Ea=Object(E.c)((function(e){var t=e.store,n=t.relations,a=t.showConnections,r=t.highlighted;return p.a.createElement(xa,{relations:Array.from(n),visible:a,highlighted:r})})),Sa=n(708),_a=n(709),ka=Object(E.c)((function(e){var t=e.item,n=e.store;return p.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"1em"}},p.a.createElement(D.a,{type:"primary",onClick:function(e){t._ws.playPause()}},t.playing&&p.a.createElement(d.Fragment,null,p.a.createElement(Sa.a,null)," Pause",n.settings.enableTooltips&&n.settings.enableHotkeys&&t.hotkey&&p.a.createElement(at,null,"[",t.hotkey,"]")),!t.playing&&p.a.createElement(d.Fragment,null,p.a.createElement(_a.a,null)," Play",n.settings.enableTooltips&&n.settings.enableHotkeys&&t.hotkey&&p.a.createElement(at,null,"[",t.hotkey,"]"))))})),Oa=n(260),Ca=n.n(Oa),ja=function(e,t,n){var a={type:"",title:""};switch(e){case"error":a.type=jt.a.error,a.title="Error";break;case"warning":a.type=jt.a.warning,a.title="Warning";break;case"success":a.type=jt.a.success,a.title="Success";break;default:a.type=jt.a.info,a.title="Info"}a.type({title:n||a.title,content:t})},Ra={error:function(e,t){ja("error",e,t)},warning:function(e,t){ja("warning",e,t)},success:function(e,t){ja("success",e,t)},info:function(e,t){ja("info",e,t)}},Na=x.types.model({_needsUpdate:x.types.optional(x.types.number,0)}).views((function(e){return{findRegion(t){var n=null;return e._regionsCache&&e._regionsCache.length&&(n=e._regionsCache.find((function(e){var n=e.region;return Ca()(n,t)}))),n||e.regions.find((function(e){return Ca()(e,t)}))}}})).actions((function(e){return{toStateJSON(){if(e.regions)return e.regions.map((function(e){return e.toStateJSON()}))}}})).actions((function(e){var t={};return{addProp:function(n,a){t[n]=a,e._needsUpdate=e._needsUpdate+1},getProps:function(){return t},getAvailableStates:function(){var t=(e.states()||[]).reduce((function(e,t){return t.checkMaxUsages?e.concat(t.checkMaxUsages()):e}),[]),n=e.activeStates()||[];if(0===n.length){if(t.length){var a=t[0];Ra.warning("You can't use ".concat(a.value," more than ").concat(a.maxUsages," time(s)"))}e.completion.unselectAll()}return n}}}));function Ta(e,t){return"$"===e.charAt(0)?function e(t,n,a){return"string"===typeof n?e(t,n.split("."),a):1===n.length&&void 0!==a?t[n[0]]=a:0===n.length?t:e(t[n[0]],n.slice(1),a)}(t,e.substring(1)):e}function Ma(e,t){t||(t={});for(var n,a,r=/[$](.+)/g,o=/(^( )?(var|if|for|else|switch|case|break|{|}|;))(.*)?/g,i="with(obj) { var r=[];\n",l=0,s=function e(t,n){return i+=n?t.match(o)?t+"\n":"r.push("+t+");\n":""!==t?'r.push("'+t.replace(/"/g,'\\"')+'");\n':"",e};a=r.exec(e);)s(e.slice(l,a.index))(a[1],!0),l=a.index+a[0].length;if(!e)return"";s(e.substr(l,e.length-l)),i=(i+'return r.join(""); }').replace(/[\r\t\n]/g," ");try{n=new Function("obj",i).apply(t,[t])}catch(c){console.error("'"+c.message+"'"," in \n\nCode:\n",i,"\n")}return n}var Aa=x.types.model().actions((function(e){return{updateLocalValue(t){e._value=t},updateValue(t){e._value=Ma(e.value,t.task.dataObj)||""}}})),za=function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){var e=this.props,t=e.item,n=t.getProps&&t.getProps();return p.a.createElement("div",Object.assign({className:e.className,dataneedsupdate:t._needsUpdate,style:e.style},n),e.children)}}]),n}(p.a.Component),Pa=Object(E.c)(za),La=n(343),Da=n.n(La),Ia=n(96),Ha=n.n(Ia),Ba=n(710),Ua=n(711),Va=n(344),Fa=n.n(Va),Wa=n(345),Ya=n.n(Wa),Xa=n(346),Ga=n.n(Xa),Ka=n(347),Ja=n.n(Ka),qa=n(147),Za=n(90),$a=n(661),Qa=n(712),er="https://app.heartex.ai/docs/guide/FAQ.html#Image-audio-resource-loading-error-while-labeling",tr={DONE:"Done!",NO_COMP_LEFT:"No more completions",NO_NEXT_TASK:"No more data available for labeling",NO_ACCESS:"You don't have access to this task",ERR_REQUIRED:function(e){var t=e.modelName,n=e.field;return"Attribute <b>".concat(n,"</b> is required for <b>").concat(t,"</b>")},ERR_UNKNOWN_TAG:function(e){var t=e.modelName,n=e.field,a=e.value;return"Tag with name <b>".concat(a,"</b> is not registered. Referenced by <b>").concat(t,"#").concat(n,"</b>.")},ERR_TAG_NOT_FOUND:function(e){var t=e.modelName,n=e.field,a=e.value;return"Tag with name <b>".concat(a,"</b> does not exist in the config. Referenced by <b>").concat(t,"#").concat(n,"</b>.")},ERR_TAG_UNSUPPORTED:function(e){var t=e.modelName,n=e.field,a=e.value,r=e.validType;return"Invalid attribute <b>".concat(n,"</b> for <b>").concat(t,"</b>: referenced tag is <b>").concat(a,"</b>, but <b>").concat(t,"</b> can only control <b>").concat([].concat(r).join(", "),"</b>")},ERR_BAD_TYPE:function(e){var t=e.modelName,n=e.field,a=e.validType;return"Attribute <b>".concat(n,"</b> of tag <b>").concat(t,"</b> has invalid type. Valid types are: <b>").concat(a,"</b>.")},ERR_INTERNAL:function(e){var t=e.value;return"Internal error. See browser console for more info. Try again or contact developers.<br/>".concat(t)},ERR_GENERAL:function(e){return e.value},URL_CORS_DOCS:er,ERR_LOADING_AUDIO:function(e){var t=e.attr,n=e.url,a=e.error;return p.a.createElement("p",null,"Error while loading audio. Check ",p.a.createElement("code",null,t)," field in task.",p.a.createElement("br",null),"Technical description: ",a,p.a.createElement("br",null),"URL: ",n)},ERR_LOADING_S3:function(e){var t=e.attr,n=e.url;e.error;return"\n    <div>\n      <p>\n        There was an issue loading URL from <code>".concat(t,"</code> value.\n        The request parameters are invalid.\n        If you are using S3, make sure you\u2019ve specified the right bucket region name.\n      </p>\n      <p>URL: <code><a href=").concat(n,' target="_blank">').concat(n,"</a></code></p>\n    </div>\n  ")},ERR_LOADING_CORS:function(e){var t=e.attr,n=e.url;e.error;return"\n    <div>\n      <p>\n        There was an issue loading URL from <code>".concat(t,"</code> value.\n        Most likely that's because static server has wide-open CORS.\n        <a href=").concat(er,' target="_blank">Read more on that here.</a>\n      </p>\n      <p>\n        Also check that:\n        <ul>\n          <li>URL is valid</li>\n          <li>Network is reachable</li>\n        </ul>\n      </p>\n      <p>URL: <code><a href=').concat(n,' target="_blank">').concat(n,"</a></code></p>\n    </div>\n  ")},ERR_LOADING_HTTP:function(e){var t=e.attr,n=e.url,a=e.error;return"\n    <div>\n      <p>\n        There was an issue loading URL from <code>".concat(t,"</code> value\n      </p>\n      <p>\n        Things to look out for:\n        <ul>\n          <li>URL is valid</li>\n          <li>URL scheme matches the service scheme, i.e. https and https</li>\n          <li>\n            The static server has wide-open CORS,\n            <a href=").concat(er,' target="_blank">more on that here</a>\n          </li>\n        </ul>\n      </p>\n      <p>\n        Technical description: <code>').concat(a,"</code>\n        <br />\n        URL: <code><a href=").concat(n,' target="_blank">').concat(n,"</a></code>\n      </p>\n    </div>\n  ")}};function nr(e,t){e=Number(e);var n=Math.floor(e/60);e%=60;var a=Math.round(e).toString();return t>=250?a=e.toFixed(2):t>=25&&(a=e.toFixed(1)),n>0?(e<10&&(a="0"+a),"".concat(n,":").concat(a)):a}function ar(e){return e>=2500?.01:e>=1e3?.025:e>=250?.1:e>=100?.25:e>=25?1:5*e>=25?5:15*e>=25?15:60*Math.ceil(.5/e)}function rr(e){return e>=2500?10:e>=1e3?4:e>=250?10:e>=100?4:e>=25?1:5*e>=25?5:15*e>=25?15:60*Math.ceil(.5/e)}function or(e){return Math.floor(10/ar(e))}var ir=function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(h.a)(this,n),(a=t.call(this,e)).onChangeZoom=function(e){a.setState(Object(u.a)(Object(u.a)({},a.state),{},{zoom:e})),a.wavesurfer.zoom(e)},a.onChangeVolume=function(e){a.setState(Object(u.a)(Object(u.a)({},a.state),{},{volume:e})),a.wavesurfer.setVolume(e)},a.onChangeSpeed=function(e){a.setState(Object(u.a)(Object(u.a)({},a.state),{},{speed:e})),a.wavesurfer.setPlaybackRate(e)},a.onZoomPlus=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=a.state.zoom;return(n+=t)>700&&(n=700),a.onChangeZoom(n),e&&e.preventDefault(),!1},a.onZoomMinus=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=a.state.zoom;return(n-=t)<0&&(n=0),a.onChangeZoom(n),e.preventDefault(),!1},a.onWheel=function(e){if(!e||e.shiftKey){e&&e.shiftKey&&e.preventDefault();var t=e.deltaY>0?5:-5;a.onZoomPlus(e,t)}},a.state={src:a.props.src,pos:0,colors:{waveColor:"#97A0AF",progressColor:"#52c41a"},zoom:0,speed:1,volume:1},a}return Object(f.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.$el=g.a.findDOMNode(this),this.$waveform=this.$el.querySelector("#wave");var t={container:this.$waveform,waveColor:this.state.colors.waveColor,height:this.props.height,backend:"MediaElement",progressColor:this.state.colors.progressColor,splitChannels:!0};this.props.regions&&(t=Object(u.a)(Object(u.a)({},t),{},{plugins:[Fa.a.create({dragSelection:{slop:5}}),Ya.a.create({container:"#timeline",formatTimeCallback:nr,timeInterval:ar,primaryLabelInterval:rr,secondaryLabelInterval:or,primaryColor:"blue",secondaryColor:"blue",primaryFontColor:"#000",secondaryFontColor:"#000"}),Da.a.create({wrapper:this.$waveform,showTime:!0,opacity:1})]})),this.wavesurfer=Ga.a.create(t),this.wavesurfer.on("error",(function(t){var n=String(t.message||t||""),a=e.props.src,r=tr.ERR_LOADING_AUDIO({attr:e.props.dataField,error:n,url:a});if((null===n||void 0===n?void 0:n.includes("HTTP"))||(null===n||void 0===n?void 0:n.includes("fetch")))e.wavesurfer.hadNetworkError=!0,r=tr.ERR_LOADING_HTTP({attr:e.props.dataField,error:n,url:a});else if("string"===typeof t&&t.includes("media element")){if(e.wavesurfer.hadNetworkError)return;r="Error while processing audio. Check media format and availability."}Ra.error(r,"Wow!")})),this.wavesurfer.load(this.props.src),this.wavesurfer.setPlaybackRate(this.state.speed);var n=this;this.props.regions&&(this.wavesurfer.on("region-mouseenter",(function(e){e._region.onMouseOver()})),this.wavesurfer.on("region-mouseleave",(function(e){e._region.onMouseLeave()})),this.wavesurfer.on("region-created",(function(e){var t=n.props.addRegion(e);t&&(e._region=t,e.color=t.selectedregionbg,e.on("click",(function(){return t.onClick(n.wavesurfer)})),e.on("update-end",(function(){return t.onUpdateEnd(n.wavesurfer)})),e.on("dblclick",(function(t){window.setTimeout((function(){e.play()}),0)})),e.on("out",(function(){})))})));var a=document.querySelector("#slider");a&&(a.oninput=function(){n.wavesurfer.zoom(Number(this.value))}),this.wavesurfer.on("ready",(function(){n.props.onCreate(e.wavesurfer),e.wavesurfer.container.onwheel=Ha()(e.onWheel,100)})),this.wavesurfer.on("pause",n.props.handlePlay),this.wavesurfer.on("play",n.props.handlePlay),this.props.regions&&this.props.onLoad(this.wavesurfer)}},{key:"render",value:function(){var e=this;return p.a.createElement("div",null,p.a.createElement("div",{id:"wave",className:Ja.a.wave}),p.a.createElement("div",{id:"timeline"}),this.props.zoom&&p.a.createElement(qa.a,{gutter:16,style:{marginTop:"1em"}},p.a.createElement(Za.a,{flex:12,style:{textAlign:"right",marginTop:"6px"}},p.a.createElement("div",{style:{display:"flex"}},p.a.createElement("div",{style:{marginTop:"6px",marginRight:"5px"}},p.a.createElement(Ba.a,{onClick:this.onZoomMinus,className:$t.a.link})),p.a.createElement("div",{style:{width:"100%"}},p.a.createElement($a.a,{min:0,step:10,max:500,value:"number"===typeof this.state.zoom?this.state.zoom:0,onChange:function(t){e.onChangeZoom(t)}})),p.a.createElement("div",{style:{marginTop:"6px",marginLeft:"5px"}},p.a.createElement(Ua.a,{onClick:this.onZoomPlus,className:$t.a.link})))),p.a.createElement(Za.a,{flex:3},this.props.volume&&p.a.createElement("div",{style:{display:"flex",marginTop:"6.5px"}},p.a.createElement("div",{style:{width:"100%"}},p.a.createElement($a.a,{min:0,max:1,step:.1,value:"number"===typeof this.state.volume?this.state.volume:1,onChange:function(t){e.onChangeVolume(t)}})),p.a.createElement("div",{style:{marginLeft:"10px",marginTop:"5px"}},p.a.createElement(Qa.a,null)))),p.a.createElement(Za.a,{flex:1,style:{marginTop:"6px"}},this.props.speed&&p.a.createElement(Pn.a,{placeholder:"Speed",style:{width:"100%"},defaultValue:this.state.speed,onChange:this.onChangeSpeed},["0.5","0.75","1.0","1.25","1.5","2.0"].map((function(e){return p.a.createElement(Pn.a.Option,{value:+e,key:e},"Speed ",e)}))))))}}]),n}(p.a.Component),lr=x.types.model({name:x.types.identifier,value:x.types.maybeNull(x.types.string),zoom:x.types.optional(x.types.boolean,!1),volume:x.types.optional(x.types.boolean,!1),speed:x.types.optional(x.types.boolean,!1),hotkey:x.types.maybeNull(x.types.string)}),sr=x.types.model({type:"audio",_value:x.types.optional(x.types.string,""),playing:x.types.optional(x.types.boolean,!1),height:x.types.optional(x.types.number,20)}).views((function(e){return{get completion(){return Object(x.getRoot)(e).completionStore.selected}}})).actions((function(e){return{fromStateJSON(t,n){t.value.choices&&e.completion.names.get(t.from_name).fromStateJSON(t),t.value.text&&e.completion.names.get(t.from_name).fromStateJSON(t)},handlePlay(){e.playing=!e.playing},onHotKey:()=>e._ws.playPause(),onLoad(t){e._ws=t},wsCreated(t){e._ws=t}}})),cr=x.types.compose("AudioModel",sr,lr,Aa,Na),ur=Object(E.b)("store")(Object(E.c)((function(e){var t=e.store,n=e.item;return n._value?p.a.createElement(Pa,{item:n},p.a.createElement(ir,{dataField:n.value,src:n._value,onCreate:n.wsCreated,onLoad:n.onLoad,handlePlay:n.handlePlay,speed:n.speed,zoom:n.zoom,volume:n.volume,regions:!1,height:n.height}),p.a.createElement(ka,{item:n,store:t})):null})));C.addTag("audio",cr,ur),C.addObjectType(cr);n(629);var dr=x.types.model("WithStates").views((function(e){return{getOneColor(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"first";if(e.states){if("first"===t){var n=e.states.find((function(e){return"getSelectedColor"in e}));return n?n.getSelectedColor():null}t="combine"}},getClonedStates:()=>e.states.map((function(e){return T(e)}))}})).actions((function(e){return{}})),pr={fillcolor:"orange",fillopacity:.6,strokecolor:"orange",strokewidth:5,opacity:.6},mr="",gr="",hr=1,fr="#36B37E",yr="#fff",vr="white",br="black",wr="red",xr=2,Er="1px dashed #00aeff",Sr="default",_r="pointer",kr="pointer",Or="move",Cr="crosshair",jr=100,Rr=400,Nr=100,Tr=400,Mr=x.types.model({normInput:x.types.maybeNull(x.types.string),normalization:x.types.maybeNull(x.types.string)}).actions((function(e){return{setNormalization(t){e.normalization=t},deleteNormalization(){e.setNormalization("")},setNormInput(t){e.normInput=t}}})),Ar=x.types.model({pid:x.types.optional(x.types.string,N),score:x.types.maybeNull(x.types.number),readonly:x.types.optional(x.types.boolean,!1),hidden:x.types.optional(x.types.boolean,!1),parentID:x.types.optional(x.types.string,"")}).volatile((function(e){return{highlighted:!1}})).views((function(e){return{get perRegionStates(){var t=e.states;return t&&t.filter((function(e){return!0===e.perregion}))},get store(){return Object(x.getRoot)(e)},get parent(){return Object(x.getParent)(e)},get completion(){return Object(x.getRoot)(e).completionStore.selected},get editable(){return!1===e.readonly&&!0===e.completion.editable}}})).actions((function(e){return{setParentID(t){e.parentID=t},moveTop(e){},moveBottom(e){},moveLeft(e){},moveRight(e){},sizeRight(e){},sizeLeft(e){},sizeTop(e){},sizeBottom(e){},rotatePoint(t,n){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.x,o=t.y;if(!n)return{x:r,y:o};n=(360+n)%360;var i=e.parent.stageWidth,l=e.parent.stageHeight;return 270===n?{x:o,y:(a?l:i)-r}:90===n?{x:(a?i:l)-o,y:r}:180===Math.abs(n)?{x:i-r,y:l-o}:{x:r,y:o}},rotateDimensions(e,t){var n=e.width,a=e.height;return(t+360)%180===0?{width:n,height:a}:{width:a,height:n}},updateAppearenceFromState(){},serialize(){console.error("Region class needs to implement serialize")},toStateJSON(){var t=e.parent,n=function(n){var a={id:e.pid,from_name:n.name,to_name:t.name,source:t.value,type:n.type,parent_id:""===e.parentID?null:e.parentID};return e.normalization&&(a.normalization=e.normalization),a};if(e.states&&e.states.length)return e.states.map((function(a){var r=e.serialize(a,t);return r?Object(u.a)(Object(u.a)({},n(a)),r):null})).filter(Boolean);var a=e.completion.toNames.get(t.name),r=a.length?a[0]:a;return Object(u.a)(Object(u.a)({},n(r)),e.serialize(r,t))},selectRegion(){},unselectRegion(){console.log("UNSELECT REGION","you should not be here")},afterUnselectRegion(){},onClickRegion(){var t=e.completion;if(t.editable)if(t.relationMode)t.addRelation(e),t.stopRelationMode(),t.regionStore.unselectAll();else{var n=!e.selected;t.unselectAll(),n&&t.selectArea(e)}},deleteRegion(){e.completion.editable&&(e.selected&&e.completion.unselectAll(),e.destroyRegion&&e.destroyRegion(),e.completion.deleteRegion(e))},setHighlight(t){e.highlighted=t},toggleHighlight(){e.setHighlight(!e.highlighted)},toggleHidden(t){e.hidden=!e.hidden,t&&t.stopPropagation()}}})),zr=x.types.model("Result",{id:x.types.optional(x.types.identifier,N),score:x.types.maybeNull(x.types.number),from_name:x.types.late((function(){return x.types.reference(x.types.union.apply(x.types,Object(qn.a)(C.modelsArr())))})),to_name:x.types.late((function(){return x.types.reference(x.types.union.apply(x.types,Object(qn.a)(C.objectTypes())))})),type:x.types.enumeration(["labels","hypertextlabels","rectangle","keypoint","polygon","brush","ellipse","rectanglelabels","keypointlabels","polygonlabels","brushlabels","ellipselabels","timeserieslabels","choices","taxonomy","textarea","rating","pairwise"]),value:x.types.model({rating:x.types.maybe(x.types.number),text:x.types.maybe(x.types.union(x.types.string,x.types.array(x.types.string))),choices:x.types.maybe(x.types.array(x.types.string)),selected:x.types.maybe(x.types.enumeration(["left","right"])),labels:x.types.maybe(x.types.array(x.types.string)),htmllabels:x.types.maybe(x.types.array(x.types.string)),rectanglelabels:x.types.maybe(x.types.array(x.types.string)),keypointlabels:x.types.maybe(x.types.array(x.types.string)),polygonlabels:x.types.maybe(x.types.array(x.types.string)),ellipselabels:x.types.maybe(x.types.array(x.types.string)),brushlabels:x.types.maybe(x.types.array(x.types.string)),timeserieslabels:x.types.maybe(x.types.array(x.types.string)),taxonomy:x.types.frozen()})}).views((function(e){return{get perRegionStates(){var t=e.states;return t&&t.filter((function(e){return!0===e.perregion}))},get store(){return Object(x.getRoot)(e)},get area(){return Object(x.getParent)(e,2)},get completion(){return Object(x.getRoot)(e).completionStore.selected},get mainValue(){return e.value[e.from_name.valueType]},get hasValue(){var t=e.mainValue;return!!t&&(!Array.isArray(t)||t.length>0)},get editable(){return!1===e.readonly&&!0===e.completion.editable},getSelectedString(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:" ";return(null===(t=e.mainValue)||void 0===t?void 0:t.join(n))||""},get selectedLabels(){var t;return null===(t=e.mainValue)||void 0===t?void 0:t.map((function(t){return e.from_name.findLabel(t)})).filter(Boolean)},get isSubmitable(){var t=e.from_name;if(t.perregion){var n=t.whenlabelvalue;if(n&&!e.area.hasLabel(n))return!1}if("choice-selected"===t.visiblewhen){var a=t.whentagname,r=t.whenchoicevalue?t.whenchoicevalue.split(","):null,o=e.completion.results.filter((function(t){return"choices"===t.type&&t!==e}));if(a){var i=o.find((function(e){return e.from_name.name===a}));if(!i)return!1;if(r&&!r.some((function(e){return i.mainValue.includes(e)})))return!1}else{if(!o.length)return!1;if(r&&!r.some((function(e){return o.some((function(t){return t.mainValue.includes(e)}))})))return!1}}return!0},get tag(){var t=e.mainValue;return t&&e.from_name.findLabel?e.from_name.findLabel(t[0]):null},get style(){if(!e.tag)return null;var t=e.tag.background||e.tag.parent.fillcolor;if(!t)return null;var n=e.tag.background||e.tag.parent.strokecolor,a=e.tag.parent;return{strokecolor:n,strokewidth:a.strokewidth,fillcolor:t,fillopacity:a.fillopacity,opacity:a.opacity}}}})).volatile((function(e){return{pid:"",selected:!1}})).actions((function(e){return{setValue(t){e.value[e.from_name.valueType]=t},afterCreate(){e.pid=e.id},afterAttach(){},setParentID(t){e.parentID=t},updateAppearenceFromState(){},serialize(){var t=Object(x.getSnapshot)(e),n=t.from_name,a=t.to_name,r=t.type,o=t.score,i=t.value,l=e.from_name.valueType,s=e.area?e.area.serialize():{};if(!s)return null;if(!e.isSubmitable)return null;var c=e.area.cleanId;s.value||(s.value={});var d=e.from_name.metaValue;return d&&(s.meta=Object(u.a)(Object(u.a)({},s.meta),d)),e.area.parentID&&(s.parentID=e.area.parentID.replace(/#.*/,"")),Object.assign(s,{id:c,from_name:n,to_name:a,type:r}),i[l]&&Object.assign(s.value,{[l]:i[l]}),"number"===typeof o&&(s.score=o),s},toStateJSON(){var t=e.parent,n=function(n){var a={id:e.pid,from_name:n.name,to_name:t.name,source:t.value,type:n.type,parent_id:""===e.parentID?null:e.parentID};return e.normalization&&(a.normalization=e.normalization),a};if(e.states&&e.states.length)return e.states.map((function(a){var r=e.serialize(a,t);return r?Object(u.a)(Object(u.a)({},n(a)),r):null})).filter(Boolean);var a=e.completion.toNames.get(t.name),r=a.length?a[0]:a;return Object(u.a)(Object(u.a)({},n(r)),e.serialize(r,t))},deleteRegion(){e.completion.editable&&(e.unselectRegion(),e.completion.relationStore.deleteNodeRelation(e),"polygonregion"===e.type&&e.destroyRegion(),e.completion.regionStore.deleteRegion(e),e.completion.deleteRegion(e))},setHighlight(t){e.highlighted=t},toggleHighlight(){e.setHighlight(!e.highlighted)},toggleHidden(){e.hidden=!e.hidden}}})),Pr=x.types.model({id:x.types.optional(x.types.identifier,N),results:x.types.array(zr),parentID:x.types.maybeNull(x.types.string)}).views((function(e){return{get cleanId(){return e.id.replace(/#.*/,"")},get completion(){return Object(x.getParent)(e,2)},get labeling(){return e.results.find((function(e){return e.type.endsWith("labels")}))},get tag(){var t;return null===(t=e.labeling)||void 0===t?void 0:t.from_name},hasLabel(t){var n,a;return null===(n=e.labeling)||void 0===n||null===(a=n.mainValue)||void 0===a?void 0:a.includes(t)},get perRegionTags(){var t;return(null===(t=e.completion.toNames.get(e.object.name))||void 0===t?void 0:t.filter((function(e){return e.perregion})))||[]},get parent(){return e.object},get style(){var t=e.results.find((function(e){return e.style}));return t&&t.style},get selected(){return e.completion.highlightedNode===e},getOneColor(){var t;return(null===(t=e.style)||void 0===t?void 0:t.fillcolor)||"#ccc"}}})).volatile((function(e){return{}})).actions((function(e){return{beforeDestroy(){e.results.forEach((function(e){return Object(x.destroy)(e)}))},setSelected(t){e.selected=t},addResult(t){e.results.push(t)},removeResult(t){var n=e.results.indexOf(t);n<0||(e.results.splice(n,1),Object(x.destroy)(t),e.results.length||e.completion.deleteArea(e))},setValue(t){var n=e.results.find((function(e){return e.from_name===t})),a=t.selectedValues();n?t.holdsState?n.setValue(a):e.removeResult(n):e.results.push({area:e,from_name:t,to_name:e.object,type:t.resultType,value:{[t.valueType]:a}}),e.updateAppearenceFromState&&e.updateAppearenceFromState()}}})),Lr=x.types.model("AudioRegionModel",{type:"audioregion",object:x.types.late((function(){return x.types.reference(Br)})),start:x.types.number,end:x.types.number,selectedregionbg:x.types.optional(x.types.string,"rgba(0, 0, 0, 0.5)")}).views((function(e){return{get regionElement(){return e.wsRegionElement(e._ws_region)},wsRegionElement(e){var t=e.id;return document.querySelector('[data-id="'.concat(t,'"]'))}}})).actions((function(e){return{serialize:()=>({original_length:e.object._ws.getDuration(),value:{start:e.start,end:e.end}}),updateColor(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=Xe.Colors.convertToRGBA(e.getOneColor(),n);null===(t=e._ws_region)||void 0===t||t.update({color:a})},updateAppearenceFromState(){var t;(null===(t=e._ws_region)||void 0===t?void 0:t.update)&&e.applyCSSClass(e._ws_region)},applyCSSClass(t){e.updateColor(.3);var n=Object(x.getRoot)(e).settings,a=e.wsRegionElement(t);if(a){var r=[a.className,"htx-highlight","htx-highlight-last"];if(e.parent.showlabels||n.showLabels){var o,i=Xe.HTML.labelWithCSS(a,{labels:null===(o=e.labeling)||void 0===o?void 0:o.mainValue,score:e.score});r.push(i)}else r.push("htx-no-label");a.className=r.filter(Boolean).join(" ")}},selectRegion(){e.updateColor(.8);var t=e.wsRegionElement(e._ws_region);if(t){var n=window.document.scrollingElement,a=n.scrollTop,r=n.scrollLeft;t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded():t.scrollIntoView(),window.document.scrollingElement.scrollTo(r,a)}},afterUnselectRegion(){e.updateColor(.3)},setHighlight(t){e.highlighted=t,t?(e.updateColor(.8),e._ws_region.element.style.border=Er):(e.updateColor(.3),e._ws_region.element.style.border="none")},beforeDestroy(){e._ws_region&&e._ws_region.remove()},onClick(t){e.completion.relationMode||e._ws_region.update({color:Xe.Colors.rgbaChangeAlpha(e.selectedregionbg,.8)}),e.onClickRegion()},onMouseOver(){e.completion.relationMode&&(e.setHighlight(!0),e._ws_region.element.style.cursor=Cr)},onMouseLeave(){e.completion.relationMode&&(e.setHighlight(!1),e._ws_region.element.style.cursor=Or)},onUpdateEnd(t){e.start=e._ws_region.start,e.end=e._ws_region.end,e.updateColor(e.selected?.8:.3)}}})),Dr=x.types.compose("AudioRegionModel",dr,Ar,Pr,Mr,Lr);C.addRegionType(Dr,"audioplus");var Ir=x.types.model({name:x.types.identifier,value:x.types.maybeNull(x.types.string),zoom:x.types.optional(x.types.boolean,!0),volume:x.types.optional(x.types.boolean,!0),speed:x.types.optional(x.types.boolean,!0),hotkey:x.types.maybeNull(x.types.string),showlabels:x.types.optional(x.types.boolean,!1),showscores:x.types.optional(x.types.boolean,!1),height:x.types.optional(x.types.string,"128")}),Hr=x.types.model("AudioPlusModel",{type:"audio",_value:x.types.optional(x.types.string,""),playing:x.types.optional(x.types.boolean,!1),regions:x.types.array(Dr)}).views((function(e){return{get hasStates(){var t=e.states();return t&&t.length>0},get completion(){return Object(x.getRoot)(e).completionStore.selected},get regs(){var t;return(null===(t=e.completion)||void 0===t?void 0:t.regionStore.regions.filter((function(t){return t.object===e})))||[]},states:()=>e.completion.toNames.get(e.name),activeStates(){var t=e.states();return t&&t.filter((function(e){return"LabelsModel"===Object(x.getType)(e).name&&e.isSelected}))}}})).actions((function(e){return{onHotKey:t=>(t&&t.preventDefault(),e._ws.playPause()),fromStateJSON(t,n){var a,r,o=e.completion.names.get(t.from_name);if(o.fromStateJSON(t),o.perregion||"labels"===n.type){var i={pid:t.id,start:t.value.start,end:t.value.end,normalization:t.normalization,score:t.score,readonly:t.readonly};return a=e.findRegion({start:t.value.start,end:t.value.end}),n&&(r=M(n),a?a.states.push(r):a=e.createRegion(i,[r])),e._ws&&e._ws.addRegion({start:a.start,end:a.end}),a.updateAppearenceFromState(),a}},setRangeValue(t){e.rangeValue=t},setPlaybackRate(t){e.playBackRate=t},createRegion(t,n){var a=e.selectedregionbg,r=n.find((function(e){return"labels"===e.type}));r&&(a=Xe.Colors.convertToRGBA(r.getSelectedColor(),.3));var o=Dr.create({id:t.id?t.id:N(),pid:t.pid?t.pid:N(),parentID:null===t.parent_id?"":t.parent_id,start:t.start,end:t.end,score:t.score,readonly:t.readonly,regionbg:e.regionbg,selectedregionbg:a,normalization:t.normalization,states:n});return o._ws_region=t,e.regions.push(o),e.completion.addRegion(o),o},addRegion(t){var n=e.completion.areas.get(t.id);if(n)return n.applyCSSClass(t),n._ws_region=t,n;if(0!==e.getAvailableStates().length){var a=e.activeStates()[0],r={[a.valueType]:a.selectedValues()},o=e.completion.createResult(t,r,a,e);return o._ws_region=t,o.updateAppearenceFromState(),o}t.remove&&t.remove()},handlePlay(){e.playing=!e.playing},onLoad(t){e._ws=t,e.regs.forEach((function(t){var n={id:t.id,start:t.start,end:t.end,color:"orange"};t.readonly&&(n.drag=!1,n.resize=!1);var a=e._ws.addRegion(n);t._ws_region=a,t.updateAppearenceFromState()}))},wsCreated(t){e._ws=t}}})),Br=x.types.compose("AudioPlusModel",Ir,Hr,Aa,Na),Ur=Object(E.b)("store")(Object(E.c)((function(e){var t=e.store,n=e.item;return n._value?p.a.createElement(Pa,{item:n},p.a.createElement(d.Fragment,null,p.a.createElement(ir,{dataField:n.value,src:n._value,selectRegion:n.selectRegion,handlePlay:n.handlePlay,onCreate:n.wsCreated,addRegion:n.addRegion,onLoad:n.onLoad,speed:n.speed,zoom:n.zoom,volume:n.volume,regions:!0,height:n.height}),p.a.createElement(ka,{item:n,store:t}),p.a.createElement("div",{style:{marginBottom:"4px"}}))):null})));C.addTag("audioplus",Br,Ur),C.addObjectType(Br);var Vr=n(163),Fr=x.types.model().views((function(e){return{}})).actions((function(e){return{updateSpansColor(t,n){e._spans&&e._spans.forEach((function(e){t&&(e.style.backgroundColor=t),n&&(e.style.backgroundColor=Xe.Colors.rgbaChangeAlpha(e.style.backgroundColor,n))}))},updateAppearenceFromState(){var t=e.getLabelColor();e.updateSpansColor(t,e.selected?.8:.3),e.applyCSSClass(e._lastSpan)},createSpans(){var t=e.getLabelColor(),n=He(e,"htx-highlight",{backgroundColor:t}),a=n[n.length-1];if(a)return e.applyCSSClass(a),e._lastSpan=a,e._spans=n,n},getLabelColor(){var t=e.parent.highlightcolor||e.style.fillcolor;return t&&(t=Xe.Colors.convertToRGBA(t,.3)),t},applyCSSClass(t){if(t){var n=["htx-highlight","htx-highlight-last"],a=Object(x.getRoot)(e).settings;if(e.parent.showlabels||a.showLabels){var r,o=null===(r=e.labeling)||void 0===r?void 0:r.mainValue,i=Xe.HTML.labelWithCSS(t,{labels:o,score:e.score});n.push(i)}else n.push("htx-no-label");t.className=n.filter(Boolean).join(" ")}},addEventsToSpans(t){t&&t.forEach((function(t){return function(t){return t.onmouseover=function(n){e.completion.relationMode?(e.toggleHighlight(),t.style.cursor=Cr,n.stopPropagation()):t.style.cursor=kr},t.onmouseout=function(){e.setHighlight(!1)},t.onmousedown=function(t){e.parent._currentSpan!==this&&(t.stopPropagation(),e.parent._currentSpan=this)},t.onclick=function(n){e.parent._currentSpan===this&&(t.style.cursor=kr,e.onClickRegion())},!1}(t)}))},selectRegion(){e.updateSpansColor(null,.8);var t=e._spans[0];t&&(t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded():t.scrollIntoView({block:"center",behavior:"smooth"}))},afterUnselectRegion(){e.updateSpansColor(null,.3)},setHighlight(t){if(e.highlighted=t,e._spans){var n=e._spans.length,a=e._spans[0],r=e._spans[n-1],o=e._spans.slice(1,n-1),i=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.top,r=void 0===a||a,o=n.bottom,i=void 0===o||o,l=n.right,s=void 0===l||l,c=n.left,u=void 0===c||c;s&&(e.style.borderRight=t),u&&(e.style.borderLeft=t),r&&(e.style.borderTop=t),i&&(e.style.borderBottom=t)};if(e.highlighted){var l=Er;i(a,l,{right:!1}),i(r,l,{left:!1}),o.length&&o.forEach((function(e){return i(e,l,{left:!1,right:!1})}))}else{i(a,"0px"),i(r,"0px"),o.length&&o.forEach((function(e){return i(e,"0px",{left:!1,right:!1})}))}}}}})),Wr=x.types.model("HyperTextRegionModel",{id:x.types.optional(x.types.identifier,N),pid:x.types.optional(x.types.string,N),type:"hypertextregion",object:x.types.late((function(){return x.types.reference(qr)})),startOffset:x.types.integer,start:x.types.string,endOffset:x.types.integer,end:x.types.string,text:x.types.string}).views((function(e){return{get parent(){return e.object},get regionElement(){return e._spans[0]}}})).actions((function(e){return{beforeDestroy(){Xe.HTML.removeSpans(e._spans)},serialize(){var t={value:{start:e.start,end:e.end,startOffset:e.startOffset,endOffset:e.endOffset}};return"yes"===e.object.savetextresult&&(t.value.text=e.text),t}}})),Yr=x.types.compose("HyperTextRegionModel",dr,Ar,Pr,Mr,Wr,Fr);C.addRegionType(Yr,"hypertext");var Xr=n(1).types,Gr={range:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Xr.custom({name:"Range(".concat(e,"..").concat(t,")"),fromSnapshot:e=>parseFloat(e),toSnapshot:e=>e.toString(),isTargetType(n){var a=parseFloat(n);return e<=a&&a<=t},getValidationMessage(n){return this.isTargetType(n)?"":"Value ".concat(n," is outside of range ").concat(e,"..").concat(t,".")}})},color:Xr.custom({name:"CSSColor",fromSnapshot:e=>String(e),toSnapshot:e=>e.toString(),isTargetType(e){var t=(new Option).style;return t.color=e,""!==t.color},getValidationMessage(e){return this.isTargetType(e)?"":"Value ".concat(e," doesn't appear to be a valid HEX color.")}})},Kr=x.types.model("HyperTextModel",{name:x.types.optional(x.types.identifier,N(5)),value:x.types.maybeNull(x.types.string),savetextresult:x.types.optional(x.types.enumeration(["none","no","yes"]),(function(){return window.LS_SECURE_MODE?"no":"yes"})),clickablelinks:!1,highlightcolor:x.types.maybeNull(Gr.color),showlabels:x.types.optional(x.types.boolean,!1),encoding:x.types.optional(x.types.enumeration(["none","base64","base64unicode"]),"none")}),Jr=x.types.model("HyperTextModel",{type:"hypertext",_value:x.types.optional(x.types.string,""),_update:x.types.optional(x.types.number,1)}).views((function(e){return{get hasStates(){var t=e.states();return t&&t.length>0},get completion(){return Object(x.getRoot)(e).completionStore.selected},get regs(){return e.completion.regionStore.regions.filter((function(t){return t.object===e}))},states:()=>e.completion.toNames.get(e.name),activeStates(){var t=e.states();return t?t.filter((function(e){return e.isSelected&&("HyperTextLabelsModel"===Object(x.getType)(e).name||"RatingModel"===Object(x.getType)(e).name)})):null}}})).actions((function(e){return{needsUpdate(){e._update=e._update+1},updateValue(t){e._value=Ma(e.value,t.task.dataObj)},createRegion(t){var n=Yr.create(Object(u.a)({pid:t.id},t));return n._range=t._range,e.regions.push(n),e.completion.addRegion(n),n},addRegion(t){var n=e.getAvailableStates();if(0!==n.length){var a=n[0],r={[a.valueType]:a.selectedValues()},o=e.completion.createResult(t,r,a,e);return o._range=t._range,o}},fromStateJSON(t,n){var a=t.value,r=a.start,o=a.startOffset,i=a.end,l=a.endOffset,s=a.text;if("textarea"!==n.type&&"choices"!==n.type){var c=M(n),u={pid:t.id,parentID:null===t.parent_id?"":t.parent_id,startOffset:o,endOffset:l,start:r,end:i,text:s,score:t.score,readonly:t.readonly,normalization:t.normalization,states:[c]};c.fromStateJSON(t),e.createRegion(u),e.needsUpdate()}else e.completion.names.get(t.from_name).fromStateJSON(t)}}})),qr=x.types.compose("HyperTextModel",Ar,Kr,Jr,Na),Zr=function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.store;return t._value?p.a.createElement(eo,{store:n,item:t}):null}}]),n}(d.Component),$r=function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(h.a)(this,n),(a=t.call(this,e)).myRef=p.a.createRef(),a}return Object(f.a)(n,[{key:"captureDocumentSelection",value:function(){var e,t=[],n=[],a=window.getSelection();if(a.isCollapsed)return[];for(e=0;e<a.rangeCount;e++){var r=a.getRangeAt(e);"DIV"===r.endContainer.nodeName&&r.setEnd(r.startContainer,r.startContainer.length);try{var o=Vr.fromRange(r,this.myRef.current);Be(r),o._range=r,o.text=a.toString(),null===o?n.push(r):t.push(o)}catch(i){}}return a.removeAllRanges(),t}},{key:"onMouseUp",value:function(e){var t=this.props.item,n=t.activeStates();if(n&&0!==n.length){var a=this.captureDocumentSelection();if(0!==a.length){t._currentSpan=null;var r=t.addRegion(a[0]);if(r){var o=r.createSpans();r.addEventsToSpans(o)}}}}},{key:"_handleUpdate",value:function(){var e=this.myRef.current,t=this.props.item;t.regs.forEach((function(t){var n,a;if(!(null===(n=t._spans)||void 0===n||null===(a=n[0])||void 0===a?void 0:a.isConnected))try{var r=Vr.toRange(t.start,t.startOffset,t.end,t.endOffset,e);Be(r),t._range=r;var o=t.createSpans();t.addEventsToSpans(o)}catch(i){console.log(t)}})),t.clickablelinks||Array.from(this.myRef.current.getElementsByTagName("a")).forEach((function(e){e.addEventListener("click",(function(e){return e.preventDefault(),!1}))}))}},{key:"componentDidUpdate",value:function(){this._handleUpdate()}},{key:"componentDidMount",value:function(){this._handleUpdate()}},{key:"render",value:function(){var e=this.props,t=e.item,n=e.store,a=Ma(t.value,n.task.dataObj);return"base64"===t.encoding&&(a=atob(a)),"base64unicode"===t.encoding&&(a=Xe.Checkers.atobUnicode(a)),p.a.createElement(Pa,{item:t},p.a.createElement("div",{ref:this.myRef,"data-update":t._update,style:{overflow:"auto"},onMouseUp:this.onMouseUp.bind(this),dangerouslySetInnerHTML:{__html:a}}))}}]),n}(d.Component),Qr=Object(E.b)("store")(Object(E.c)(Zr)),eo=Object(E.b)("store")(Object(E.c)($r));C.addTag("hypertext",qr,Qr),C.addObjectType(qr);var to=x.types.model("BaseTool",{}).actions((function(e){return{}})),no={X:3,Y:3},ao=to,ro=n(126),oo=n.n(ro),io=Object(E.c)(function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){return p.a.createElement(d.Fragment,null,p.a.createElement($a.a,{defaultValue:this.props.default||15,max:this.props.max||50,min:1,vertical:!0,tipFormatter:null,style:{height:this.props.height||100},onChange:this.props.onChange}),p.a.createElement(L.a,{title:this.props.title,placement:"left"},p.a.createElement(D.a,{shape:"circle",type:this.props.selected?"primary":"default",className:oo.a.button,onClick:this.props.onClick},this.props.icon)))}}]),n}(d.Component)),lo=x.types.model({selected:x.types.optional(x.types.boolean,!1)}).views((function(e){return{get obj(){return e._manager.obj},get manager(){return e._manager},get control(){return e._control},get completion(){return Object(x.getRoot)(e.control).completionStore.selected},get viewClass(){return null},get clonedStates(){var t=[e.control],n=t?t.filter((function(e){return e.isSelected})):null;return n?n.map((function(e){return T(e)})):null},moreRegionParams(e){},get getActiveShape(){var t=e.obj;return t.regs[t.regs.length-1]},get getSelectedShape(){return e.control.completion.highlightedNode}}})).actions((function(e){return{setSelected(t){e.selected=t},event(t,n,a){var r=t+"Ev";"undefined"!==typeof e[r]&&e[r].call(e,n,a)},createFromJSON(t,n){var a,r=[],o=e.completion.names.get(t.from_name);if(o.fromStateJSON(t),!o.perregion||"textarea"!==n.type){var i=e.tagTypes,l=i.stateTypes,s=i.controlTagTypes;if(o.perregion||s.includes(n.type)){if(t.type===l&&((r=M(n)).fromStateJSON&&r.fromStateJSON(t),r=[r]),s.includes(t.type)){var c=e.moreRegionParams(t),d=Object(u.a)(Object(u.a)(Object(u.a)({pid:t.id,parentID:null===t.parent_id?"":t.parent_id,score:t.score,readonly:t.readonly,coordstype:"perc",states:r},{}),t.value),c);a=e.createRegion(d)}else if(o.perregion){var p=M(n);(a=e.obj.regions.find((function(e){return e.pid===t.id})))&&a.states.push(p)}return a}}},fromStateJSON(t,n){if(e.tagTypes)return e.createFromJSON(t,n)}}})),so=Object(E.c)((function(e){var t=e.item;return p.a.createElement(io,{selected:t.selected,icon:p.a.createElement(sn.a,null),onClick:function(e){var n=t.selected;t.manager.unselectAll(),t.setSelected(!n),t.selected&&t.updateCursor()},onChange:function(e){t.setStroke(e),t.updateCursor()}})})),co=x.types.model({strokeWidth:x.types.optional(x.types.number,10)}).views((function(e){return{get viewClass(){return p.a.createElement(so,{item:e})},get tagTypes(){return{stateTypes:"brushlabels",controlTagTypes:["brushlabels","brush"]}}}})).actions((function(e){return{fromStateJSON(t,n){var a=e.createFromJSON(t,n);t.value.points&&a.addPoints({type:"add"}).addPoints(t.value.points);return"rle"===t.value.format&&(a._rle=t.value.rle),a},createRegion(t){var n,a=e.control,r={[a.valueType]:null===(n=a.selectedValues)||void 0===n?void 0:n.call(a)};return e.obj.completion.createResult(t,r,a,e.obj)},updateCursor(){var t=e.strokeWidth,n=e.obj.stageRef,a=["url('",Re.brushSizeCircle(t),"')"," ",Math.floor(t/2)+4," ",Math.floor(t/2)+4,", auto"];n.container().style.cursor=a.join("")},setStroke(t){e.strokeWidth=t},mouseupEv(){e.mode="viewing"},mousemoveEv(t,n){var a=Object(Qt.a)(n,2),r=a[0],o=a[1];"drawing"===e.mode&&e.getSelectedShape.currentTouch.addPoints(Math.floor(r),Math.floor(o))},mousedownEv(t,n){var a=Object(Qt.a)(n,2),r=a[0],o=a[1],i=e.control,l=e.getSelectedShape;if(l)e.mode="drawing",l.addTouch({type:"add",strokeWidth:e.strokeWidth||i.strokeWidth}).addPoints(Math.floor(r),Math.floor(o));else if(i.isSelected){e.mode="drawing";var s=e.createRegion({touches:[],coordstype:"px"});e.obj.completion.selectArea(s),s.addTouch({type:"add",strokeWidth:e.strokeWidth||i.strokeWidth}).addPoints(Math.floor(r),Math.floor(o))}}}})),uo=x.types.compose(lo,ao,co),po=n(713),mo=Object(E.c)(function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){return p.a.createElement(L.a,{title:this.props.tooltip,placement:"left"},p.a.createElement(D.a,{shape:"circle",type:this.props.selected?"primary":"default",disabled:!!this.props.disabled,icon:this.props.icon,className:oo.a.button,onClick:this.props.onClick}))}}]),n}(d.Component)),go=Object(E.c)((function(e){var t=e.item;return p.a.createElement(mo,{selected:t.selected,onClick:function(e){var n=t.selected;t.manager.unselectAll(),t.setSelected(!n),t.selected&&t.updateCursor()},icon:p.a.createElement(po.a,null)})})),ho=x.types.model({}).views((function(e){return{get viewClass(){return p.a.createElement(go,{item:e})}}})).actions((function(e){return{updateCursor(){var t=e.obj.stageRef,n=["url('",Re.brushSizeCircle(24),"')"," ",Math.floor(12)+4," ",Math.floor(12)+4,", auto"];t.container().style.cursor=n.join("")},mouseupEv(){e.mode="viewing"},mousemoveEv(t,n){var a=Object(Qt.a)(n,2),r=a[0],o=a[1];if("drawing"===e.mode){var i=e.getSelectedShape;i&&"brushregion"===i.type&&i.currentTouch.addPoints(Math.floor(r),Math.floor(o))}},mousedownEv(t,n){var a=Object(Qt.a)(n,2);a[0],a[1];e.mode="drawing";var r=e.getSelectedShape;r&&r&&"brushregion"===r.type&&r.addTouch({type:"eraser"})}}})),fo=x.types.compose(lo,ho,ao),yo=x.types.model({default:x.types.optional(x.types.boolean,!0)}).views((function(e){return{get tagTypes(){return{stateTypes:"keypointlabels",controlTagTypes:["keypointlabels","keypoint"]}}}})).actions((function(e){return{createRegion(t){var n,a=e.control,r={[a.valueType]:null===(n=a.selectedValues)||void 0===n?void 0:n.call(a)};e.obj.completion.createResult(t,r,a,e.obj)},clickEv(t,n){var a=Object(Qt.a)(n,2),r=a[0],o=a[1],i=e.control;("keypointlabels"!==i.type||i.isSelected)&&e.obj.checkLabels()&&e.createRegion({x:r,y:o,width:Number(i.strokewidth),coordstype:"px"})}}})),vo=x.types.compose(lo,ao,yo),bo=x.types.model({default:x.types.optional(x.types.boolean,!0),mode:x.types.optional(x.types.enumeration(["drawing","viewing"]),"viewing")}).views((function(e){return{get getActivePolygon(){var t=e.getActiveShape;return t&&t.closed||void 0===t||"polygonregion"!==t.type?null:t},get tagTypes(){return{stateTypes:"polygonlabels",controlTagTypes:["polygonlabels","polygon"]}},moreRegionParams:e=>({x:e.value.points[0][0],y:e.value.points[0][1]})}})).actions((function(e){return{clickEv(t,n){var a=Object(Qt.a)(n,2),r=a[0],o=a[1],i=e.control,l=e.getActivePolygon;if((!(e.tagTypes.stateTypes===i.type)||i.isSelected||null!==l)&&(l||e.obj.checkLabels()))if(l)l.addPoint(r,o);else{var s,c={points:[[r,o]],width:10,coordstype:"px"};e.obj.completion.history.freeze();var u={[i.valueType]:null===(s=i.selectedValues)||void 0===s?void 0:s.call(i)};e.obj.completion.createResult(c,u,i,e.obj)}}}})),wo=x.types.compose(lo,ao,bo),xo=x.types.model("DrawingTool").actions((function(e){return{updateDraw:Ha()((function(t,n){var a=e.getActiveShape,r=e.obj,o=r.stageWidth,i=r.stageHeight,l=Xe.Image.reverseCoordinates({x:a.startX,y:a.startY},{x:t,y:n}),s=l.x1,c=l.y1,u=l.x2,d=l.y2;s=Math.max(0,s),c=Math.max(0,c),u=Math.min(o,u),d=Math.min(i,d),a.setPosition(s,c,u-s,d-c,a.rotation)}),48)}})),Eo=x.types.model({default:!0,mode:x.types.optional(x.types.enumeration(["drawing","viewing"]),"viewing")}).views((function(e){return{get tagTypes(){return{stateTypes:"rectanglelabels",controlTagTypes:["rectanglelabels","rectangle"]}}}})).actions((function(e){return{createRegion(t){var n,a=e.control,r={[a.valueType]:null===(n=a.selectedValues)||void 0===n?void 0:n.call(a)};e.obj.completion.createResult(t,r,a,e.obj)},mousedownEv(t,n){var a=Object(Qt.a)(n,2),r=a[0],o=a[1];(e.tagTypes.stateTypes!==e.control.type||e.control.isSelected)&&e.obj.checkLabels()&&(e.completion.history.freeze(),e.mode="drawing",e.createRegion({x:r,y:o,height:1,width:1,coordstype:"px"}))},mousemoveEv(t,n){var a=Object(Qt.a)(n,2),r=a[0],o=a[1];"drawing"===e.mode&&e.updateDraw(r,o)},mouseupEv(t,n){var a=Object(Qt.a)(n,2);a[0],a[1];if("drawing"===e.mode){var r=e.getActiveShape;r.width<no.X||r.height<no.Y?(e.completion.removeArea(r),"rectanglelabels"===e.control.type&&e.completion.unselectAll(!0)):e.completion.history.unfreeze(),e.mode="viewing"}}}})),So=x.types.compose(lo,ao,xo,Eo),_o=x.types.model({default:!0,mode:x.types.optional(x.types.enumeration(["drawing","viewing"]),"viewing")}).views((function(e){return{get tagTypes(){return{stateTypes:"ellipselabels",controlTagTypes:["ellipselabels","ellipse"]}}}})).actions((function(e){return{createRegion(t){var n,a=e.control,r={[a.valueType]:null===(n=a.selectedValues)||void 0===n?void 0:n.call(a)};e.obj.completion.createResult(t,r,a,e.obj)},mousedownEv(t,n){var a=Object(Qt.a)(n,2),r=a[0],o=a[1];(e.tagTypes.stateTypes!==e.control.type||e.control.isSelected)&&e.obj.checkLabels()&&(e.completion.history.freeze(),e.mode="drawing",e.createRegion({x:r,y:o,radiusX:1,radiusY:1,coordstype:"px"}))},mousemoveEv(t,n){var a=Object(Qt.a)(n,2),r=a[0],o=a[1];"drawing"===e.mode&&e.updateDraw(r,o)},mouseupEv(t,n){var a=Object(Qt.a)(n,2);a[0],a[1];if("drawing"===e.mode){var r=e.getActiveShape;r.radiusX<no.X||r.radiusY<no.Y?(e.completion.removeArea(r),"ellipselabels"===e.control.type&&e.completion.unselectAll(!0)):e.completion.history.unfreeze(),e.mode="viewing"}}}})),ko=x.types.compose(lo,ao,xo,_o),Oo=n(714),Co=Object(E.c)((function(e){var t=e.item;return p.a.createElement(d.Fragment,null,p.a.createElement(mo,{selected:t.selected,icon:p.a.createElement(Oo.a,null),tooltip:"Move position",onClick:function(e){var n=t.selected;(t.manager.unselectAll(),t.setSelected(!n),t.selected)&&(t.obj.stageRef.container().style.cursor="all-scroll")}}),p.a.createElement(mo,{icon:p.a.createElement(Ua.a,null),tooltip:"Zoom into the image",onClick:function(e){t.handleZoom(1.2)}}),p.a.createElement(mo,{icon:p.a.createElement(Ba.a,null),tooltip:"Zoom out of the image",onClick:function(e){t.handleZoom(.8)}}))})),jo=x.types.model({}).views((function(e){return{get viewClass(){return p.a.createElement(Co,{item:e})}}})).actions((function(e){return{mouseupEv(){e.mode="viewing"},handleDrag(t){var n=e._manager.obj,a=n.stageRef,r=a.scaleX(),o=a.x()+t.movementX,i=a.y()+t.movementY;o>0&&(o=0),i>0&&(i=0),n.setZoom(r,o,i),a.position({x:o,y:i}),a.batchDraw()},mousemoveEv(t,n){var a=Object(Qt.a)(n,2);a[0],a[1];e._manager.obj.stageRef.scaleX()<=1||"moving"===e.mode&&e.handleDrag(t)},mousedownEv(t,n){var a=Object(Qt.a)(n,2);a[0],a[1];e.mode="moving"},handleZoom(t,n){if(!t.evt||t.evt.ctrlKey){t.evt&&t.evt.ctrlKey&&t.evt.preventDefault();var a=e._manager.obj;a.freezeHistory();var r,o,i,l,s=a.stageRef,c=parseFloat(a.zoomby),u=s.scaleX();if(t.evt?(r={x:s.getPointerPosition().x/u-s.x()/u,y:s.getPointerPosition().y/u-s.y()/u},o=t.evt.deltaY>0?u*c:u/c,l={x:-(r.x-s.getPointerPosition().x/o)*o,y:-(r.y-s.getPointerPosition().y/o)*o}):(r={x:(i={x:s.width()/2,y:s.height()/2}).x/u-s.x()/u,y:i.y/u-s.y()/u},o=Math.max(.05,u*t),l={x:-(r.x-i.x/o)*o,y:-(r.y-i.y/o)*o}),!0!==a.negativezoom&&o<=1)return a.setZoom(1,0,0),s.scale({x:1,y:1}),s.position({x:0,y:0}),void s.batchDraw();s.scale({x:o,y:o}),a.setZoom(o,l.x,l.y),s.position(l),s.batchDraw()}}}})),Ro=x.types.compose(lo,ao,jo),No=n(715),To=n(716),Mo=Object(E.c)((function(e){var t=e.item;return p.a.createElement(p.a.Fragment,null,p.a.createElement(mo,{selected:t.selected,icon:p.a.createElement(No.a,null),tooltip:"Rotate Left",onClick:function(e){t.rotate(-90)}}),p.a.createElement(mo,{selected:t.selected,icon:p.a.createElement(To.a,null),tooltip:"Rotate Right",onClick:function(e){t.rotate(90)}}))})),Ao=x.types.model({}).views((function(e){return{get viewClass(){return p.a.createElement(Mo,{item:e})}}})).actions((function(e){return{rotate(t){e.obj.rotate(t)}}})),zo=x.types.compose(lo,ao,Ao),Po=n(718),Lo=n(717),Do=Object(E.c)(function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){var e=p.a.createElement(Ht.a,null,p.a.createElement(Ht.a.Item,{key:"1"},p.a.createElement($a.a,{defaultValue:this.props.default||15,max:this.props.max||50,value:this.props.value,min:0,vertical:!0,tipFormatter:null,style:{height:this.props.height||100},onChange:this.props.onChange}),p.a.createElement(D.a,{shape:"circle",type:this.props.selected?"primary":"default",className:oo.a.button,onClick:this.props.onResetClick},p.a.createElement(Lo.a,null))));return p.a.createElement(d.Fragment,null,p.a.createElement(Vt.a,{overlay:e},p.a.createElement(D.a,{shape:"circle",className:oo.a.button},this.props.icon)))}}]),n}(d.Component)),Io=n(208),Ho=n.n(Io),Bo=Object(E.c)((function(e){var t=e.item;return p.a.createElement(d.Fragment,null,p.a.createElement(Do,{default:jr,value:t.brightness,max:Rr,selected:t.selected,icon:p.a.createElement(Po.a,null),onResetClick:function(e){t.setStroke(jr)},onChange:function(e){t.setStroke(e)}}),p.a.createElement("span",{className:Ho.a.tooltitle},"Brightness"))})),Uo=x.types.model({brightness:x.types.optional(x.types.number,jr)}).views((function(e){return{get viewClass(){return p.a.createElement(Bo,{item:e})}}})).actions((function(e){return{setStroke(t){e.brightness=t,e.obj.setBrightnessGrade(t)}}})),Vo=x.types.compose(lo,ao,Uo),Fo=Object(E.c)((function(e){var t=e.item;return p.a.createElement(d.Fragment,null,p.a.createElement(Do,{default:Nr,value:t.contrast,max:Tr,selected:t.selected,icon:p.a.createElement(Po.a,null),onResetClick:function(e){t.setStroke(Nr)},onChange:function(e){t.setStroke(e)}}),p.a.createElement("span",{className:Ho.a.tooltitle},"Contrast"))})),Wo=x.types.model({contrast:x.types.optional(x.types.number,Nr)}).views((function(e){return{get viewClass(){return p.a.createElement(Fo,{item:e})}}})).actions((function(e){return{setStroke(t){e.contrast=t,e.obj.setContrastGrade(t)}}})),Yo=x.types.compose(lo,ao,Wo),Xo=n(31);var Go=function(e){var t=e.x,n=e.y,a=e.text,r=e.score,o=e.showLabels,i=e.showScore&&r,l=1/(e.zoomScale||1);return p.a.createElement(Xo.Group,{strokeScaleEnabled:!1,opacity:.8},i&&p.a.createElement(Xo.Label,{x:t,y:n-20*l,scaleX:l,scaleY:l},p.a.createElement(Xo.Tag,{fill:Xe.Colors.getScaleGradient(r),cornerRadius:2}),p.a.createElement(Xo.Text,{text:r.toFixed(2),fontFamily:"Calibri",fill:"white",padding:2})),o&&p.a.createElement(Xo.Label,{x:i?t+34*l:t,y:n-20*l,scaleX:l,scaleY:l},p.a.createElement(Xo.Tag,{fill:br,cornerRadius:2}),p.a.createElement(Xo.Text,{text:a,fontFamily:"Calibri",fill:vr,padding:2})))},Ko=Object(E.c)((function(e){var t=e.item,n=t.labeling;return n?p.a.createElement(Go,{x:t.x,y:t.y,text:n.getSelectedString(","),score:t.score,showLabels:Object(x.getRoot)(t).settings.showLabels,showScore:Object(x.getRoot)(t).settings.showLabels,zoomScale:t.parent.zoomScale}):null})),Jo=Object(E.c)((function(e){var t=e.item,n=t.labeling;return n?p.a.createElement(Go,{x:t.x,y:t.y,text:n.getSelectedString(","),score:t.score,showLabels:Object(x.getRoot)(t).settings.showLabels,showScore:Object(x.getRoot)(t).settings.showLabels,zoomScale:t.parent.zoomScale}):null})),qo=Object(E.c)((function(e){var t,n=e.item,a=n.labeling;if(!a)return null;var r=function(e){var t=[],n=[];return e.forEach((function(e){t.push(e.x),n.push(e.y)})),[[Math.min.apply(null,t),Math.max.apply(null,t)],[Math.min.apply(null,n),Math.max.apply(null,n)]]}(n.points),o=Object(x.getRoot)(n).settings;return p.a.createElement(d.Fragment,null,o&&(o.showLabels||o.showScore)&&p.a.createElement(Xo.Rect,{x:r[0][0],y:r[1][0],fillEnabled:!1,width:r[0][1]-r[0][0],height:r[1][1]-r[1][0],stroke:null===(t=n.style)||void 0===t?void 0:t.strokecolor,strokeWidth:1,strokeScaleEnabled:!1,shadowBlur:0}),p.a.createElement(Go,{x:r[0][0],y:r[1][0]+2/n.parent.zoomScale,text:a.getSelectedString(","),score:n.score,showLabels:o&&o.showLabels,showScore:o&&o.showScore,zoomScale:n.parent.zoomScale}))})),Zo=Object(E.c)((function(e){var t,n=e.item,a=Object(x.getRoot)(n).settings;if(a&&!a.showLabels&&!a.showScore)return null;var r=n.labeling;if(!r)return null;if(0===n.touches.length)return null;var o=function(e){var t=e.length;if(!t)return[[0,0],[0,0]];for(var n=[e[0],e[0]],a=[e[1],e[1]],r=2;r<t;r+=2)e[r]<n[0]?n[0]=e[r]:e[r]>n[1]&&(n[1]=e[r]),e[r+1]<a[0]?a[0]=e[r+1]:e[r+1]>a[1]&&(a[1]=e[r+1]);return[n,a]}(Z(n.touches.map((function(e){return e.points}))));return p.a.createElement(Xo.Group,{name:"region-label"},p.a.createElement(Xo.Rect,{x:o[0][0],y:o[1][0],fillEnabled:!1,width:o[0][1]-o[0][0],height:o[1][1]-o[1][0],stroke:null===(t=n.style)||void 0===t?void 0:t.strokecolor,strokeWidth:1,strokeScaleEnabled:!1,shadowBlur:0}),p.a.createElement(Go,{x:o[0][0],y:o[1][0]+2/n.parent.zoomScale,text:r.getSelectedString(","),score:n.score,showLabels:Object(x.getRoot)(n).settings.showLabels,showScore:a&&a.showScore,zoomScale:n.parent.zoomScale}))})),$o=Object(E.c)((function(e){var t=e.item,n=t.labeling;return n?p.a.createElement(Go,{x:t.x+(t.width+2)/t.parent.zoomScale,y:t.y+(t.width+2)/t.parent.zoomScale,text:n.getSelectedString(","),score:t.score,showLabels:Object(x.getRoot)(t).settings.showLabels,showScore:Object(x.getRoot)(t).settings.showScore,zoomScale:t.parent.zoomScale}):null})),Qo=x.types.model("PolygonPoint",{id:x.types.optional(x.types.identifier,N),relativeX:x.types.optional(x.types.number,0),relativeY:x.types.optional(x.types.number,0),initX:x.types.optional(x.types.number,0),initY:x.types.optional(x.types.number,0),x:x.types.number,y:x.types.number,index:x.types.number,selected:x.types.optional(x.types.boolean,!1),style:"circle",size:"small"}).views((function(e){return{get parent(){return Object(x.getParent)(e,2)},get completion(){return Object(x.getRoot)(e).completionStore.selected}}})).actions((function(e){return{afterCreate(){e.initX=e.x,e.initY=e.y,"perc"===e.parent.coordstype?(e.relativeX=e.x,e.relativeY=e.y):(e.relativeX=e.x/e.parent.parent.stageWidth*100,e.relativeY=e.y/e.parent.parent.stageHeight*100)},movePoint(t,n){e.initX=e.initX+t,e.initY=e.initY+n,e.x=e.x+t,e.y=e.y+n,e.relativeX=e.x/e.parent.parent.stageWidth*100,e.relativeY=e.y/e.parent.parent.stageHeight*100},_movePoint(t,n){e.initX=t,e.initY=n,e.relativeX=t/e.parent.parent.stageWidth*100,e.relativeY=n/e.parent.parent.stageHeight*100,e.x=t,e.y=n},closeStartPoint(t){e.completion.editable&&e.parent.mouseOverStartPoint&&e.parent.closePoly()},handleMouseOverStartPoint(t){if(t.cancelBubble=!0,e.parent.parent.stageRef.container().style.cursor="crosshair",!(e.parent.closed||e.parent.points.length<3)){var n=t.target;"rectangle"===e.style&&(n.setX(n.x()-n.width()/2),n.setY(n.y()-n.height()/2));var a={small:2,medium:3,large:4}[e.size];n.scale({x:a/e.parent.parent.zoomScale,y:a/e.parent.parent.zoomScale}),e.parent.setMouseOverStartPoint(!0)}},handleMouseOutStartPoint(t){var n=t.target;e.parent.parent.stageRef.container().style.cursor="default","rectangle"===e.style&&(n.setX(n.x()+n.width()/2),n.setY(n.y()+n.height()/2)),n.scale({x:1/e.parent.parent.zoomScale,y:1/e.parent.parent.zoomScale}),e.parent.setMouseOverStartPoint(!1)}}})),ei=Object(E.c)((function(e){var t=e.item,n=e.name,a=t.parent.style,r={small:1,medium:2,large:3},o={small:4,medium:8,large:12}[t.size],i=0===t.index?{hitStrokeWidth:12,fill:a.strokecolor||t.primary,onMouseOver:t.handleMouseOverStartPoint,onMouseOut:t.handleMouseOutStartPoint,onClick:t.closeStartPoint}:null,l={onDragMove:function(e){var n=e.target.attrs,a=n.x,r=n.y;a<0&&(a=0),r<0&&(r=0),a>t.parent.parent.stageWidth&&(a=t.parent.parent.stageWidth),r>t.parent.parent.stageHeight&&(r=t.parent.parent.stageHeight),t._movePoint(a,r)},onDragStart:function(e){t.completion.history.freeze()},onDragEnd:function(e){t.completion.history.unfreeze(),e.cancelBubble=!0},onMouseOver:function(e){e.cancelBubble=!0,t.parent.parent.stageRef.container().style.cursor="crosshair"},onMouseOut:function(e){t.parent.parent.stageRef.container().style.cursor="default"}},s=t.selected?"green":"white";return"circle"===t.style?p.a.createElement(Xo.Circle,Object.assign({key:n,name:n,x:t.x,y:t.y,radius:o,fill:s,stroke:"black",strokeWidth:r[t.size],dragOnTop:!1,strokeScaleEnabled:!1,scaleX:1/(t.parent.parent.zoomScale||1),scaleY:1/(t.parent.parent.zoomScale||1),onClick:function(e){t.parent.mouseOverStartPoint?t.parent.closePoly():t.parent.setSelectedPoint(t)}},l,i,{draggable:t.parent.editable})):p.a.createElement(Xo.Rect,Object.assign({name:n,key:n,x:t.x-o/2,y:t.y-o/2,width:o,height:o,fill:s,stroke:"black",strokeWidth:r[t.size],dragOnTop:!1},l,i,{draggable:t.parent.editable}))})),ti=n(261),ni=x.types.model({id:x.types.optional(x.types.identifier,N),pid:x.types.optional(x.types.string,N),type:"polygonregion",object:x.types.late((function(){return x.types.reference(Ii)})),points:x.types.array(x.types.union(Qo,x.types.array(x.types.number)),[]),coordstype:x.types.optional(x.types.enumeration(["px","perc"]),"perc")}).volatile((function(e){return{closed:!1,mouseOverStartPoint:!1,selectedPoint:null,hideable:!0}})).views((function(e){return{get store(){return Object(x.getRoot)(e)}}})).actions((function(e){return{afterCreate(){e.points.length&&(e.points[0].id||(e.points=e.points.map((function(t,n){var a=Object(Qt.a)(t,2),r=a[0],o=a[1];return{id:N(),x:r,y:o,size:e.pointSize,style:e.pointStyle,index:n}}))),e.points.length>2&&(e.closed=!0))},setMouseOverStartPoint(t){e.mouseOverStartPoint=t},setSelectedPoint(t){e.selectedPoint&&(e.selectedPoint.selected=!1),t.selected=!0,e.selectedPoint=t},handleMouseMove(t){var n=t.e,a=t.flattenedPoints,r=n.evt,o=r.offsetX,i=r.offsetY,l=e.parent.fixZoomedCoords([o,i]),s=Object(Qt.a)(l,2),c=ri({flattenedPoints:a,cursorX:s[0],cursorY:s[1]}),u=Object(Qt.a)(c,2);!function(e){var t=e.point,n=e.group,a=e.layer,r=e.zoom;(ii({layer:a})||function(e){var t=e.point,n=e.group,a=e.layer,r=e.zoom,o=new he.a.Circle({name:"hoverAnchor",x:t[0],y:t[1],stroke:ti.a.primary,fill:ti.a[0],scaleX:1/(r||1),scaleY:1/(r||1),strokeWidth:2,radius:5});return n.add(o),a.draw(),o}({point:t,group:n,layer:a,zoom:r})).to({x:t[0],y:t[1],duration:0})}({point:[u[0],u[1]],group:n.currentTarget,layer:n.currentTarget.getLayer(),zoom:e.parent.zoomScale})},handleMouseLeave(e){li({layer:e.e.currentTarget.getLayer()})},handleLineClick(t){var n=t.e,a=t.flattenedPoints,r=t.insertIdx;if(n.cancelBubble=!0,e.closed&&e.selected){li({layer:n.currentTarget.getLayer()});var o=n.evt,i=o.offsetX,l=o.offsetY,s=e.parent.fixZoomedCoords([i,l]),c=Object(Qt.a)(s,2),u=ri({flattenedPoints:a,cursorX:c[0],cursorY:c[1]});e.insertPoint(r,u[0],u[1])}},addPoint(t,n){e.closed||e._addPoint(t,n)},insertPoint(t,n,a){var r={id:N(),x:n,y:a,size:e.pointSize,style:e.pointStyle,index:e.points.length};e.points.splice(t,0,r)},_addPoint(t,n){e.points.push({id:N(),x:t,y:n,size:e.pointSize,style:e.pointStyle,index:e.points.length})},rotate(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-90;e.points.forEach((function(n){var a=e.rotatePoint(n,t);n._movePoint(a.x,a.y)}))},closePoly(){e.closed=!0,e.selectRegion(),e.completion.history.unfreeze()},canClose(t,n){if(e.points.length<2)return!1;var a=e.points[0],r=t,o=n;return Math.pow(a.x-r,2)+Math.pow(a.y-o,2)<50},destroyRegion(){Object(x.detach)(e.points),Object(x.destroy)(e.points)},afterUnselectRegion(){e.selectedPoint&&(e.selectedPoint.selected=!1)},setScale(t,n){e.scaleX=t,e.scaleY=n},updateOffset(){e.points.map((function(e){return e.computeOffset()}))},updateImageSize(t,n,a,r){"px"===e.coordstype&&e.points.forEach((function(e){var t=a*e.relativeX/100,n=r*e.relativeY/100;e._movePoint(t,n)})),e.completion.sentUserGenerate||"perc"!==e.coordstype||e.points.forEach((function(t){var n=a*t.x/100,o=r*t.y/100;e.coordstype="px",t._movePoint(n,o)}))},serialize(){if(e.points.length<3)return null;var t=e.object,n=t.naturalWidth,a=t.naturalHeight,r=t.stageWidth,o=t.stageHeight,i=-e.parent.rotation,l=e.rotateDimensions({width:n,height:a},i),s=e.rotateDimensions({width:r,height:o},i),c=s.width,u=s.height;return{value:{points:e.points.map((function(t){var n=e.rotatePoint(t,i,!1);return[100*n.x/c,100*n.y/u]}))},original_width:l.width,original_height:l.height,image_rotation:e.parent.rotation}}}})),ai=x.types.compose("PolygonRegionModel",dr,Ar,Pr,Mr,ni);function ri(e){var t=e.flattenedPoints,n=e.cursorX,a=e.cursorY,r=Object(Qt.a)(t,4),o=r[0],i=r[1],l=r[2],s=r[3];return[n-(s-i)*(l*i-o*s+n*(s-i)-a*(l-o))/((s-i)*(s-i)+(l-o)*(l-o)),((l-o)*(l*i-o*s)+(l-o)*(s-i)*n+(s-i)*(s-i)*a)/((s-i)*(s-i)+(l-o)*(l-o))]}function oi(e){return e.map((function(e){return[e.x,e.y]})).reduce((function(e,t){return e.concat(t)}),[])}function ii(e){return e.layer.findOne(".hoverAnchor")}function li(e){var t=e.layer,n=ii({layer:t});n&&(n.destroy(),t.draw())}var si=Object(E.c)((function(e){var t=e.item;if(t.hidden)return null;var n=t.store,a=t.style||t.tag||pr;function r(e){return e.reduce((function(e,t){return e[0]=void 0===e[0]||t<e[0]?t:e[0],e[1]=void 0===e[1]||t>e[1]?t:e[1],e}),[])}var o,i=0,l=0,s=0,c=0;return p.a.createElement(Xo.Group,{key:t.id?t.id:N(5),onDragStart:function(e){t.completion.setDragMode(!0);var n=t.points.map((function(e){return e.x})),a=t.points.map((function(e){return e.y})),o=r(n),u=Object(Qt.a)(o,2);i=u[0],l=u[1];var d=r(a),p=Object(Qt.a)(d,2);s=p[0],c=p[1]},dragBoundFunc:t.parent.fixForZoom((function(e){var n=e.x,a=e.y,r=t.parent.stageWidth,o=t.parent.stageHeight;return s+a<0&&(a=-1*s),i+n<0&&(n=-1*i),c+a>o&&(a=o-c),l+n>r&&(n=r-l),{x:n,y:a}})),onDragEnd:function(e){var n=e.target;t.completion.setDragMode(!1),t.closed||t.closePoly(),t.completion.history.freeze(),t.points.forEach((function(e){return e.movePoint(n.getAttr("x"),n.getAttr("y"))})),t.completion.history.unfreeze(),n.setAttr("x",0),n.setAttr("y",0)},onMouseOver:function(e){var a=t.parent.stageRef;n.completionStore.selected.relationMode?(t.setHighlight(!0),a.container().style.cursor=Cr):a.container().style.cursor=kr},onMouseOut:function(e){t.parent.stageRef.container().style.cursor=Sr,n.completionStore.selected.relationMode&&t.setHighlight(!1)},onClick:function(e){if(!e.evt.metaKey&&!e.evt.ctrlKey&&(e.cancelBubble=!0,t.closed)){var a=t.parent.stageRef;n.completionStore.selected.relationMode&&(a.container().style.cursor=Sr),t.setHighlight(!1),t.onClickRegion()}},draggable:t.editable},p.a.createElement(qo,{item:t}),t.mouseOverStartPoint,t.points&&t.closed?(o=t.points,p.a.createElement(Xo.Group,{key:"poly",name:"poly"},p.a.createElement(Xo.Line,{lineJoin:"bevel",points:oi(o),fill:a.strokecolor,closed:!0,opacity:.2}))):null,t.points?function(e){return p.a.createElement(Xo.Group,{key:"borders",name:"borders"},e.map((function(n,r){var o=r,i=r===e.length-1?0:r+1;return function(e){var n=e.points,r=e.idx1,o=e.idx2,i="border_".concat(r,"_").concat(o),l=a.strokecolor,s=a.strokewidth;if(t.highlighted&&(l=wr,s=xr),!t.closed&&0===o)return null;var c=r+1,u=oi([n[r],n[o]]);return p.a.createElement(Xo.Group,{key:i,name:i,onClick:function(e){return t.handleLineClick({e:e,flattenedPoints:u,insertIdx:c})},onMouseMove:function(e){t.closed&&t.selected&&t.editable&&t.handleMouseMove({e:e,flattenedPoints:u})},onMouseLeave:function(e){return t.handleMouseLeave({e:e})}},p.a.createElement(Xo.Line,{points:u,stroke:l,opacity:+a.opacity,lineJoin:"bevel",strokeWidth:+s,strokeScaleEnabled:!1}))}({points:e,idx1:o,idx2:i})})))}(t.points):null,t.points?function(e){return p.a.createElement(Xo.Group,{key:"anchors",name:"anchors"},e.map((function(n,a){return function(e){var n=e.points,a=e.idx,r="anchor_".concat(n.length,"_").concat(a),o=n[a];if(!t.closed||t.closed&&t.selected)return p.a.createElement(ei,{item:o,name:r,key:r})}({points:e,idx:a})})))}(t.points):null)}));C.addTag("polygonregion",ai,si),C.addRegionType(ai,"image",(function(e){return!!e.points}));var ci=Object(E.c)((function(e){var t=e.item;return p.a.createElement(io,{max:50,default:10,selected:t.selected,icon:"tool",onClick:function(e){var n=t.selected;t.manager.unselectAll(),t.setSelected(!n)},onChange:function(e){t.setThreshold(e)}})})),ui=x.types.model({threshold:x.types.optional(x.types.number,10)}).views((function(e){return{get viewClass(){return p.a.createElement(ci,{item:e})}}})).actions((function(e){return{setThreshold(t){e.threshold=t},mouseupEv(){e.mode="viewing"},mousemoveEv(t,n){var a=Object(Qt.a)(n,2);a[0],a[1];e.mode},createPolygonRegion(t){var n={},a=n.states,r=n.strokecolor,o=e.control,i=ai.create({id:N(),opacity:parseFloat(o.opacity),fillcolor:o.fillcolor,strokewidth:parseInt(o.strokewidth),strokecolor:r,pointsize:o.pointsize,pointstyle:o.pointstyle,states:a,coordstype:"px"});return t.forEach((function(e){return i.addPoint(e.x,e.y)})),e.obj.addShape(i),i.closePoly(),i},clickEv(t,n){var a=Object(Qt.a)(n,2),r=a[0],o=a[1],i=e.obj,l=me(pe(i.imageRef).data,i.naturalWidth,i.naturalHeight,r,o,e.threshold,!0);l&&e.createPolygonRegion(l),e.control.unselectAll()},mousedownEv(t,n){var a=Object(Qt.a)(n,2);a[0],a[1];e.mode="drawing"}}})),di=x.types.compose(lo,ui,ao),pi=Object(E.c)(function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){var e,t,n,a=this.props.item,r=(e=Math.ceil(a.stageWidth/a.gridSize),t=Math.ceil(a.stageHeight/a.gridSize),n=a.gridSize,Object(qn.a)(Array(e)).map((function(e,a){return Object(qn.a)(Array(t)).map((function(e,t){return{col:a,row:t,x:a*n,y:t*n,fill:"#fff"}}))})).reduce((function(e,t){return[].concat(Object(qn.a)(e),Object(qn.a)(t))})));return p.a.createElement(Xo.Layer,{opacity:.15,name:"ruler"},Object.values(r).map((function(e,t){return p.a.createElement(Xo.Rect,{key:t,x:e.x,y:e.y,width:a.gridSize,height:a.gridSize,stroke:a.gridColor,strokeWidth:1})})))}}]),n}(d.Component)),mi=function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(){var e;Object(h.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).constrainSizes=function(t,n){var a=void 0!==n.rotation?n.rotation:t.rotation,r=a!==t.rotation,o=e.transformer.getStage();if(n.width<no&&(n.width=no),n.height<no&&(n.height=no),a||r){var i=n.x,l=n.y,s=be({x:0,y:0,width:n.width,height:n.height},{x:i,y:l},a),c=we(s,o.width(),o.height());return["x","y","width","height"].some((function(e){return c[e]!==s[e]}))?t:n}return we(n,o.width(),o.height())},e}return Object(f.a)(n,[{key:"componentDidMount",value:function(){this.checkNode()}},{key:"componentDidUpdate",value:function(){this.checkNode()}},{key:"checkNode",value:function(){if(this.transformer){var e=this.transformer.getStage(),t=this.props.selectedShape;if(!t)return this.transformer.detach(),void this.transformer.getLayer().batchDraw();if(t.supportsTransform){var n=e.findOne("."+t.id);n!==this.transformer.node()&&(n?this.transformer.attachTo(n):this.transformer.detach(),this.transformer.getLayer().batchDraw())}}}},{key:"render",value:function(){var e=this;return this.props.selectedShape.supportsTransform?p.a.createElement(Xo.Transformer,{resizeEnabled:!0,ignoreStroke:!0,keepRatio:!1,rotateEnabled:this.props.rotateEnabled,borderDash:[3,1],boundBoxFunc:this.constrainSizes,anchorSize:8,ref:function(t){e.transformer=t}}):null}}]),n}(d.Component),gi=n(168),hi=n.n(gi),fi=Object(E.c)(function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(){var e;Object(h.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleOnClick=function(t){return e.props.item.event("click",t,t.evt.offsetX,t.evt.offsetY)},e.handleMouseDown=function(t){var n=e.props.item,a=t.target.getParent();if(!a||"Transformer"!==a.className){if(t.evt&&(t.evt.metaKey||t.evt.ctrlKey)||t.target===t.target.getStage()||t.target.parent&&("ruler"===t.target.parent.attrs.name||"segmentation"===t.target.parent.attrs.name)){window.addEventListener("mousemove",e.handleGlobalMouseMove),window.addEventListener("mouseup",e.handleGlobalMouseUp);var r=t.evt,o=r.offsetX,i=r.offsetY,l=e.container.getBoundingClientRect(),s=l.left,c=l.top;return e.canvasX=s,e.canvasY=c,n.event("mousedown",t,o,i)}return!0}},e.handleGlobalMouseUp=function(t){if(window.removeEventListener("mousemove",e.handleGlobalMouseMove),window.removeEventListener("mouseup",e.handleGlobalMouseUp),!t.target||"CANVAS"!==t.target.tagName){var n=e.props.item,a=t.clientX,r=t.clientY;return n.freezeHistory(),n.event("mouseup",t,a-e.canvasX,r-e.canvasY)}},e.handleGlobalMouseMove=function(t){if(!t.target||"CANVAS"!==t.target.tagName){var n=e.props.item,a=t.clientX,r=t.clientY;return n.event("mousemove",t,a-e.canvasX,r-e.canvasY)}},e.handleMouseUp=function(t){var n=e.props.item;return n.freezeHistory(),n.event("mouseup",t,t.evt.offsetX,t.evt.offsetY)},e.handleMouseMove=function(t){var n=e.props.item;n.freezeHistory();var a=n.stageRef,r=a.scaleX();if(!(t.evt&&(4===t.evt.buttons||1===t.evt.buttons&&t.evt.shiftKey)&&r>1))return n.event("mousemove",t,t.evt.offsetX,t.evt.offsetY);t.evt.preventDefault();var o={x:a.x()+t.evt.movementX,y:a.y()+t.evt.movementY};n.setZoom(r,o.x,o.y),a.position(o),a.batchDraw()},e.handleError=function(){Ra.error("Cannot load image (".concat(e.props.item._value,").\nCheck console/network panel for more info."))},e.updateGridSize=function(t){var n=e.props.item;n.freezeHistory(),n.setGridSize(t)},e.handleZoom=function(t){if(!t.evt||t.evt.ctrlKey){t.evt&&t.evt.ctrlKey&&t.evt.preventDefault();var n=e.props.item;n.freezeHistory();var a,r,o,i,l=n.stageRef,s=parseFloat(n.zoomby),c=l.scaleX();if(t.evt?(a={x:l.getPointerPosition().x/c-l.x()/c,y:l.getPointerPosition().y/c-l.y()/c},r=t.evt.deltaY>0?c*s:c/s,i={x:-(a.x-l.getPointerPosition().x/r)*r,y:-(a.y-l.getPointerPosition().y/r)*r}):(a={x:(o={x:l.width()/2,y:l.height()/2}).x/c-l.x()/c,y:o.y/c-l.y()/c},r=Math.max(.05,c*t),i={x:-(a.x-o.x/r)*r,y:-(a.y-o.y/r)*r}),!0!==n.negativezoom&&r<=1)return n.setZoom(1,0,0),l.scale({x:1,y:1}),l.position({x:0,y:0}),void l.batchDraw();l.scale({x:r,y:r}),n.setZoom(r,i.x,i.y),l.position(i),l.batchDraw()}},e.onResize=function(){e.props.item.onResize(e.container.offsetWidth,e.container.offsetHeight,!0)},e}return Object(f.a)(n,[{key:"renderRulers",value:function(){var e=this.props.item;return p.a.createElement(Xo.Group,{name:"ruler",onClick:function(e){e.cancelBubble=!1}},p.a.createElement(Xo.Line,{x:0,y:e.cursorPositionY,points:[0,0,e.stageWidth,0],strokeWidth:1,stroke:"white",tension:0,dash:[4,4],closed:!0}),p.a.createElement(Xo.Line,{x:e.cursorPositionX,y:0,points:[0,0,0,e.stageHeight],strokeWidth:1,stroke:"white",tension:0,dash:[1.5],closed:!0}))}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onResize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onResize)}},{key:"renderTools",value:function(){var e=this.props,t=e.item,n=e.store.completionStore;return n.viewingAllCompletions||n.viewingAllPredictions?null:p.a.createElement("div",{className:hi.a.block},t.getToolsManager().allTools().map((function(e){return e.viewClass})))}},{key:"render",value:function(){var e=this,t=this.props,n=t.item;if(!t.store.task||!n._value)return null;var a=n.selectedShape,r=n.regs.filter((function(e){return e!==a})),o=n.controlButton(),i=null,l=hi.a.container,s={},c={width:n.width,transformOrigin:"left top",filter:"brightness(".concat(n.brightnessGrade,"%) contrast(").concat(n.contrastGrade,"%)")},u=[];if(!1===Object(x.getRoot)(n).settings.imageFullSize&&(s.maxWidth=n.maxwidth),1!==n.zoomScale){var d=n.zoomingPositionX,m=n.zoomingPositionY;u.push("translate("+d+"px,"+m+"px)"),u.push("scale("+n.resize+", "+n.resize+")")}if(n.rotation){if(u.push("rotate(".concat(n.rotation,"deg)")),u.push("translate(".concat({90:"0, -100%",180:"-100%, -100%",270:"-100%, 0"}[n.rotation]||"0, 0",")")),[90,270].includes(n.rotation)){var g=n.naturalHeight/n.naturalWidth;i=p.a.createElement("div",{className:hi.a.filler,style:{marginTop:"".concat(100*g,"%")}}),l+=" "+hi.a.rotated,c.width="".concat(100*g,"%")}}return u.length&&(c.transform=u.join(" ")),p.a.createElement(Pa,{item:n,style:{position:"relative",display:"flex",alignItems:"flex-start",justifyContent:"space-between"}},p.a.createElement("div",{ref:function(t){e.container=t},className:l,style:s},i,p.a.createElement("img",{ref:function(e){n.setImageRef(e)},style:c,src:n._value,onLoad:n.updateImageSize,onError:this.handleError,onClick:this.handleOnClick,alt:"LS"})),n.stageWidth<=1?null:p.a.createElement(Xo.Stage,{ref:function(e){n.setStageRef(e)},style:{position:"absolute",top:0,left:0,brightness:"150%"},className:"image-element",width:n.stageWidth,height:n.stageHeight,scaleX:n.scale,scaleY:n.scale,x:n.zoomingPositionX,y:n.zoomingPositionY,onClick:this.handleOnClick,onMouseDown:this.handleMouseDown,onMouseMove:this.handleMouseMove,onMouseUp:this.handleMouseUp,onWheel:n.zoom?this.handleZoom:function(){}},n.grid&&n.sizeUpdated&&p.a.createElement(pi,{item:n}),r.filter((function(e){return"brushregion"===e.type})).map(P.renderItem),a&&"brushregion"===a.type&&P.renderItem(a),p.a.createElement(Xo.Layer,{name:"shapes"},r.filter((function(e){return"brushregion"!==e.type})).map(P.renderItem),a&&"brushregion"!==a.type&&P.renderItem(a),(null===a||void 0===a?void 0:a.editable)&&p.a.createElement(mi,{rotateEnabled:o&&o.canrotate,selectedShape:n.selectedShape}))),this.renderTools())}}]),n}(d.Component)),yi=function(){function e(t){var n=t.obj;Object(h.a)(this,e),this.obj=n,this.tools={},this._default_tool=null}return Object(f.a)(e,[{key:"addTool",value:function(e,t){this.tools[e]=t,t._manager=this,t.default&&(this._default_tool=t)}},{key:"unselectAll",value:function(){Object.values(this.tools).forEach((function(e){"undefined"!==typeof e.selected&&e.setSelected(!1)})),this.obj.stageRef.container().style.cursor="default"}},{key:"allTools",value:function(){return Object.values(this.tools)}},{key:"addToolsFromControl",value:function(e){var t=this;if(e.tools){var n=e.tools;Object.keys(n).forEach((function(e){t.addTool(e,n[e])}))}}},{key:"findSelectedTool",value:function(){return Object.values(this.tools).find((function(e){return e.selected}))}},{key:"event",value:function(e,t){for(var n=this.findSelectedTool(),a=arguments.length,r=new Array(a>2?a-2:0),o=2;o<a;o++)r[o-2]=arguments[o];n?n.event(e,t,r):this._default_tool&&this._default_tool.event(e,t,r)}}]),e}(),vi={shadowColor:"red",shadowBlur:1,shadowOffsetY:2,shadowOffsetX:2,shadowOpacity:1},bi=x.types.model("Points",{id:x.types.optional(x.types.identifier,N),type:x.types.optional(x.types.enumeration(["add","eraser"]),"add"),points:x.types.array(x.types.number),strokeWidth:x.types.optional(x.types.number,25)}).views((function(e){return{get store(){return Object(x.getRoot)(e)},get parent(){return Object(x.getParent)(e,2)}}})).actions((function(e){return{setType(t){e.type=t},addPoints(t,n){e.points.push(t/e.parent.scaleX),e.points.push(n/e.parent.scaleY)},rescale(t,n,a,r){var o=a/t;return e.points.map((function(e){return e*o}))},scaledStrokeWidth:(t,n,a,r)=>a/t*e.strokeWidth}})),wi=x.types.model({id:x.types.optional(x.types.identifier,N),pid:x.types.optional(x.types.string,N),type:"brushregion",object:x.types.late((function(){return x.types.reference(Ii)})),coordstype:x.types.optional(x.types.enumeration(["px","perc"]),"perc"),rle:x.types.frozen(),touches:x.types.array(bi),currentTouch:x.types.maybeNull(x.types.reference(bi))}).volatile((function(e){return{tension:1,opacity:1,scaleX:1,scaleY:1,mode:"brush",needsUpdate:1,hideable:!0}})).views((function(e){return{get parent(){return e.object}}})).actions((function(e){return{afterCreate(){},addTouch(t){var n=t.type,a=t.strokeWidth,r=bi.create({id:N(),type:n,strokeWidth:a});return e.touches.push(r),e.currentTouch=r,r},convertPointsToMask(){},setScale(t,n){e.scaleX=t,e.scaleY=n},updateImageSize(t,n,a,r){if(e.parent.initialWidth>1&&e.parent.initialHeight>1){var o=e.parent.stageWidth/e.parent.initialWidth,i=e.parent.stageHeight/e.parent.initialHeight;e.setScale(o,i),e.needsUpdate=e.needsUpdate+1}},addState(t){e.states.push(t)},serialize(){var t=e.object,n=Re.Region2RLE(e,t,{stroke:e.strokeColor,tension:e.tension});return n&&n.length?{original_width:t.naturalWidth,original_height:t.naturalHeight,value:{format:"rle",rle:Array.from(n)}}:null}}})),xi=x.types.compose("BrushRegionModel",dr,Ar,Mr,Pr,wi),Ei=Object(E.c)((function(e){var t=e.item,n=e.points,a=t.highlighted?vi:{shadowOpacity:0},r="add"===n.type?Object(u.a)(Object(u.a)({},a),{},{opacity:"brush"===t.mode?t.opacity:1,globalCompositeOperation:"source-over"}):{opacity:1,globalCompositeOperation:"destination-out"};return p.a.createElement(Xo.Line,Object.assign({onMouseDown:function(e){e.cancelBubble=!1},points:Object(qn.a)(n.points),stroke:t.style.strokecolor,strokeWidth:n.strokeWidth,lineJoin:"round",lineCap:"round",tension:t.tension},r))})),Si=Object(E.c)((function(e){var t=e.item;if(t.hidden)return null;var n=t.store,a=t.highlighted?vi:{shadowOpacity:0};return p.a.createElement(Xo.Layer,{id:t.cleanId},p.a.createElement(Xo.Group,{attrMy:t.needsUpdate,name:"segmentation",onMouseOver:function(e){var a=t.parent.stageRef;n.completionStore.selected.relationMode?(t.setHighlight(!0),a.container().style.cursor="crosshair"):t.parent.getToolsManager().findSelectedTool()||(a.container().style.cursor="pointer")},onMouseOut:function(e){(n.completionStore.selected.relationMode&&t.setHighlight(!1),t.parent.getToolsManager().findSelectedTool())||(t.parent.stageRef.container().style.cursor="default")},onClick:function(e){if(n.completionStore.selected.relationMode)t.onClickRegion();else if(!t.parent.getToolsManager().findSelectedTool()){var a=t.parent.stageRef;n.completionStore.selected.relationMode&&(a.container().style.cursor="default"),t.setHighlight(!1),t.onClickRegion()}}},p.a.createElement(Xo.Shape,Object.assign({sceneFunc:function(e,n){if(1===t.parent.naturalWidth)return null;if(!0===t._loadedOnce)return e.drawImage(t._img,0,0,t.parent.stageWidth,t.parent.stageHeight),void e.fillStrokeShape(n);if(t.rle){var a=Re.RLE2Region(t.rle,t.parent);t._loadedOnce=!0,a.onload=function(){e.drawImage(a,0,0,t.parent.stageWidth,t.parent.stageHeight),e.fillStrokeShape(n)},t._img=a}},opacity:1},a)),p.a.createElement(Xo.Group,{scaleX:t.scaleX,scaleY:t.scaleY},t.touches.map((function(e){return p.a.createElement(Ei,{key:e.id,store:n,item:t,points:e})})),p.a.createElement(Zo,{item:t}))))}));C.addTag("brushregion",xi,Si),C.addRegionType(xi,"image",(function(e){return e.rle||e.touches}));var _i=x.types.model({id:x.types.optional(x.types.identifier,N),pid:x.types.optional(x.types.string,N),type:"keypointregion",object:x.types.late((function(){return x.types.reference(Ii)})),x:x.types.number,y:x.types.number,width:x.types.number,coordstype:x.types.optional(x.types.enumeration(["px","perc"]),"perc")}).volatile((function(e){return{relativeX:0,relativeY:0,hideable:!0}})).views((function(e){return{get store(){return Object(x.getRoot)(e)}}})).actions((function(e){return{afterCreate(){if("perc"===e.coordstype)e.relativeX=e.x,e.relativeY=e.y;else{var t=e.parent,n=t.stageWidth,a=t.stageHeight;n&&a&&(e.relativeX=e.x/n*100,e.relativeY=e.y/a*100)}},rotate(t){var n=e.rotatePoint(e,t);e.setPosition(n.x,n.y)},setPosition(t,n){e.x=t,e.y=n,e.relativeX=t/e.parent.stageWidth*100,e.relativeY=n/e.parent.stageHeight*100},updateImageSize(t,n,a,r){"px"===e.coordstype&&(e.x=a*e.relativeX/100,e.y=r*e.relativeY/100),"perc"===e.coordstype&&(e.x=a*e.x/100,e.y=r*e.y/100,e.width=a*e.width/100,e.coordstype="px")},serialize(){var t=e.object,n=t.naturalWidth,a=t.naturalHeight,r=t.stageWidth,o=t.stageHeight,i=-e.parent.rotation,l=e.rotateDimensions({width:n,height:a},i),s=e.rotateDimensions({width:r,height:o},i),c=s.width,u=s.height,d=e.rotatePoint(e,i,!1),p=d.x,m=d.y;return{original_width:l.width,original_height:l.height,image_rotation:e.parent.rotation,value:{x:100*p/c,y:100*m/u,width:100*e.width/c}}}}})),ki=x.types.compose("KeyPointRegionModel",dr,Ar,Pr,Mr,_i),Oi=Object(E.c)((function(e){var t=e.item;if(t.hidden)return null;var n=t.store,a=t.x,r=t.y,o=t.style||t.tag||pr,i={};return i.opacity=+o.opacity,o.fillcolor&&(i.fill=o.fillcolor),i.stroke=o.strokecolor,i.strokeWidth=+o.strokewidth,i.strokeScaleEnabled=!1,i.shadowBlur=0,(t.highlighted||t.selected)&&(i.stroke=wr,i.strokeWidth=xr),p.a.createElement(d.Fragment,null,p.a.createElement(Xo.Circle,Object.assign({x:a,y:r,radius:t.width,perfectDrawEnabled:!1,scaleX:1/t.parent.zoomScale,scaleY:1/t.parent.zoomScale,name:t.id,onDragEnd:function(e){var n=e.target;t.setPosition(n.getAttr("x"),n.getAttr("y"))},dragBoundFunc:t.parent.fixForZoom((function(e){var n=t.parent.stageWidth,a=t.parent.stageHeight,r=e.x,o=e.y;return r<0&&(r=0),o<0&&(o=0),r>n&&(r=n),o>a&&(o=a),{x:r,y:o}})),onMouseOver:function(e){var a=t.parent.stageRef;n.completionStore.selected.relationMode?(t.setHighlight(!0),a.container().style.cursor="crosshair"):a.container().style.cursor="pointer"},onMouseOut:function(e){t.parent.stageRef.container().style.cursor="default",n.completionStore.selected.relationMode&&t.setHighlight(!1)},onClick:function(e){var a=t.parent.stageRef;t.completion.editable&&(n.completionStore.selected.relationMode&&(a.container().style.cursor="default"),t.setHighlight(!1),t.onClickRegion())}},i,{draggable:t.editable})),p.a.createElement($o,{item:t}))}));C.addTag("keypointregion",ki,Oi),C.addRegionType(ki,"image",(function(e){return"x"in e&&"y"in e&&"width"in e&&!("height"in e)}));var Ci=x.types.model({id:x.types.optional(x.types.identifier,N),pid:x.types.optional(x.types.string,N),type:"rectangleregion",object:x.types.late((function(){return x.types.reference(Ii)})),x:x.types.number,y:x.types.number,width:x.types.number,height:x.types.number,rotation:0,coordstype:x.types.optional(x.types.enumeration(["px","perc"]),"perc")}).volatile((function(e){return{relativeX:0,relativeY:0,relativeWidth:0,relativeHeight:0,startX:0,startY:0,scaleX:1,scaleY:1,opacity:.6,fill:!0,fillColor:"#ff8800",fillOpacity:.6,strokeColor:gr,strokeWidth:hr,supportsTransform:!0,hideable:!0}})).views((function(e){return{get store(){return Object(x.getRoot)(e)},get parent(){return e.object}}})).actions((function(e){return{afterCreate(){if(e.startX=e.x,e.startY=e.y,"perc"===e.coordstype){e.relativeX=e.x,e.relativeY=e.y,e.relativeWidth=e.width,e.relativeHeight=e.height;var t=e.parent,n=t.naturalWidth,a=t.naturalHeight,r=t.stageWidth,o=t.stageHeight;r&&o&&e.updateImageSize(r/n,o/a,r,o)}e.updateAppearenceFromState()},rotate(t){var n=e.rotatePoint(e,t);-90===t&&(n.y-=e.width),90===t&&(n.x-=e.height),e.setPosition(n.x,n.y,e.height,e.width,e.rotation)},coordsInside(t,n){var a=e.x,r=e.y,o=e.width*(e.scaleX||1),i=e.height*(e.scaleY||1);return t>a&&t<a+o&&n>r&&n<r+i},setPosition(t,n,a,r,o){e.x=t,e.y=n,e.width=a,e.height=r,e.relativeX=t/e.parent.stageWidth*100,e.relativeY=n/e.parent.stageHeight*100,e.relativeWidth=a/e.parent.stageWidth*100,e.relativeHeight=r/e.parent.stageHeight*100,e.rotation=(o+360)%360},setScale(t,n){e.scaleX=t,e.scaleY=n},addState(t){e.states.push(t)},setFill(t){e.fill=t},updateImageSize(t,n,a,r){"px"===e.coordstype?(e.x=a*e.relativeX/100,e.y=r*e.relativeY/100,e.width=a*e.relativeWidth/100,e.height=r*e.relativeHeight/100):"perc"===e.coordstype&&(e.x=a*e.x/100,e.y=r*e.y/100,e.width=a*e.width/100,e.height=r*e.height/100,e.coordstype="px")},serialize(){var t=e.object,n=(360-e.parent.rotation)%360,a=e.rotatePoint(e,n,!1),r=a.x,o=a.y;270===n&&(o-=e.width),90===n&&(r-=e.height),180===n&&(r-=e.width,o-=e.height);var i=e.rotateDimensions({width:t.naturalWidth,height:t.naturalHeight},n),l=e.rotateDimensions({width:t.stageWidth,height:t.stageHeight},n),s=e.rotateDimensions({width:e.width*(e.scaleX||1)*100/t.stageWidth,height:e.height*(e.scaleY||1)*100/t.stageHeight},n),c=s.width,u=s.height;return{original_width:i.width,original_height:i.height,image_rotation:e.parent.rotation,value:{x:100*r/l.width,y:100*o/l.height,width:c,height:u,rotation:e.rotation}}}}})),ji=x.types.compose("RectRegionModel",dr,Ar,Mr,Mr,Pr,Ci),Ri=Object(E.c)((function(e){var t=e.item;if(!Object(x.isAlive)(t))return null;var n=t.store,a=t.style||t.tag||pr,r=a.strokecolor,o=a.strokewidth;return t.highlighted&&(r=wr,o=xr),t.hidden?null:p.a.createElement(d.Fragment,null,p.a.createElement(Xo.Rect,{x:t.x,y:t.y,width:t.width,height:t.height,fill:t.fill?Xe.Colors.convertToRGBA(a.fillcolor,+a.fillopacity):null,stroke:r,strokeWidth:+o,strokeScaleEnabled:!1,shadowBlur:0,scaleX:t.scaleX,scaleY:t.scaleY,opacity:+a.opacity,rotation:t.rotation,name:t.id,onTransformEnd:function(e){var n=e.target;t.setPosition(n.getAttr("x"),n.getAttr("y"),n.getAttr("width")*n.getAttr("scaleX"),n.getAttr("height")*n.getAttr("scaleY"),n.getAttr("rotation")),n.setAttr("scaleX",1),n.setAttr("scaleY",1)},onDragEnd:function(e){var n=e.target;t.setPosition(n.getAttr("x"),n.getAttr("y"),n.getAttr("width"),n.getAttr("height"),n.getAttr("rotation")),t.setScale(n.getAttr("scaleX"),n.getAttr("scaleY"))},dragBoundFunc:t.parent.fixForZoom((function(e){var n=e.x,a=e.y,r=t.width,o=t.height,i=t.rotation,l=t.parent,s=l.stageHeight,c=l.stageWidth,u=be({x:0,y:0,width:r,height:o},{x:n,y:a},i),d=we(u,c,s);return d.width!==u.width&&(n+=(d.width-u.width)*(d.x!==u.x?-1:1)),d.height!==u.height&&(a+=(d.height-u.height)*(d.y!==u.y?-1:1)),{x:n,y:a}})),onMouseOver:function(e){var a=t.parent.stageRef;n.completionStore.selected.relationMode?(t.setHighlight(!0),a.container().style.cursor=Cr):a.container().style.cursor=kr},onMouseOut:function(e){t.parent.stageRef.container().style.cursor=Sr,n.completionStore.selected.relationMode&&t.setHighlight(!1)},onClick:function(e){var a=t.parent.stageRef;t.completion.editable&&(n.completionStore.selected.relationMode&&(a.container().style.cursor=Sr),t.setHighlight(!1),t.onClickRegion())},draggable:t.editable}),p.a.createElement(Jo,{item:t}))}));C.addTag("rectangleregion",ji,Ri),C.addRegionType(ji,"image");var Ni=x.types.model({id:x.types.optional(x.types.identifier,N),pid:x.types.optional(x.types.string,N),type:"ellipseregion",object:x.types.late((function(){return x.types.reference(Ii)})),x:x.types.number,y:x.types.number,radiusX:x.types.number,radiusY:x.types.number,rotation:0,coordstype:x.types.optional(x.types.enumeration(["px","perc"]),"perc")}).volatile((function(e){return{relativeX:0,relativeY:0,relativeWidth:0,relativeHeight:0,startX:0,startY:0,relativeRadiusX:0,relativeRadiusY:0,scaleX:1,scaleY:1,opacity:x.types.number,fill:!0,fillColor:mr,fillOpacity:.6,strokeColor:gr,strokeWidth:hr,supportsTransform:!0,hideable:!0}})).views((function(e){return{get store(){return Object(x.getRoot)(e)}}})).actions((function(e){return{afterCreate(){e.startX=e.x,e.startY=e.y,"perc"===e.coordstype&&(e.relativeX=e.x,e.relativeY=e.y,e.relativeRadiusX=e.radiusX,e.relativeRadiusY=e.radiusY,e.relativeWidth=e.width,e.relativeHeight=e.height),e.updateAppearenceFromState()},coordsInside(t,n){var a=e.radiusX,r=e.radiusY,o=t-e.x,i=n-e.y,l=e.rotation;return i=(o=o*Math.cos(Math.unit(l,"deg"))-i*Math.sin(Math.unit(l,"deg")))*Math.sin(Math.unit(l,"deg"))+i*Math.cos(Math.unit(l,"deg")),Math.abs(o)<a&&(Math.pow(i,2)<Math.pow(r,2)*(1-Math.pow(o,2)/Math.pow(a,2))||void 0)},rotate(t){var n=e.rotatePoint(e,t);e.setPosition(n.x,n.y,e.radiusY,e.radiusX,e.rotation)},setPosition(t,n,a,r,o){e.x=t,e.y=n,e.radiusX=a,e.radiusY=r,e.relativeX=t/e.parent.stageWidth*100,e.relativeY=n/e.parent.stageHeight*100,e.relativeRadiusX=a/e.parent.stageWidth*100,e.relativeRadiusY=r/e.parent.stageHeight*100,e.rotation=(o+360)%360},setScale(t,n){e.scaleX=t,e.scaleY=n},setFill(t){e.fill=t},updateImageSize(t,n,a,r){e.sw=a,e.sh=r,"px"===e.coordstype?(e.x=a*e.relativeX/100,e.y=r*e.relativeY/100,e.radiusX=a*e.relativeRadiusX/100,e.radiusY=r*e.relativeRadiusY/100):"perc"===e.coordstype&&(e.x=a*e.x/100,e.y=r*e.y/100,e.radiusX=a*e.radiusX/100,e.radiusY=r*e.radiusY/100,e.coordstype="px")},serialize(){var t=e.object,n=t.naturalWidth,a=t.naturalHeight,r=t.stageWidth,o=t.stageHeight,i=-e.parent.rotation,l=e.rotateDimensions({width:n,height:a},i),s=e.rotateDimensions({width:r,height:o},i),c=s.width,u=s.height,d=e.rotateDimensions({width:e.radiusX*(e.scaleX||1)*100/e.object.stageWidth,height:e.radiusY*(e.scaleY||1)*100/e.object.stageHeight},i),p=d.width,m=d.height,g=e.rotatePoint(e,i,!1),h=g.x,f=g.y;return{original_width:l.width,original_height:l.height,image_rotation:e.parent.rotation,value:{x:100*h/c,y:100*f/u,radiusX:p,radiusY:m,rotation:e.rotation}}}}})),Ti=x.types.compose("EllipseRegionModel",dr,Ar,Pr,Mr,Mr,Ni),Mi=Object(E.c)((function(e){var t=e.item;if(t.hidden)return null;var n=t.store,a=t.style||t.tag||pr,r=a.strokecolor,o=a.strokewidth;return t.highlighted&&(r=wr,o=xr),p.a.createElement(d.Fragment,null,p.a.createElement(Xo.Ellipse,{x:t.x,y:t.y,radiusX:t.radiusX,radiusY:t.radiusY,fill:t.fill?Xe.Colors.convertToRGBA(a.fillcolor,+a.fillopacity):null,stroke:r,strokeWidth:+o,strokeScaleEnabled:!1,shadowBlur:0,scaleX:t.scaleX,scaleY:t.scaleY,opacity:+a.opacity,rotation:t.rotation,name:t.id,onTransformEnd:function(e){var n=e.target;t.setPosition(n.getAttr("x"),n.getAttr("y"),n.getAttr("radiusX")*n.getAttr("scaleX"),n.getAttr("radiusY")*n.getAttr("scaleY"),n.getAttr("rotation")),n.setAttr("scaleX",1),n.setAttr("scaleY",1)},onDragEnd:function(e){var n=e.target;t.setPosition(n.getAttr("x"),n.getAttr("y"),n.getAttr("radiusX"),n.getAttr("radiusY"),n.getAttr("rotation")),t.setScale(n.getAttr("scaleX"),n.getAttr("scaleY"))},dragBoundFunc:t.parent.fixForZoom((function(e){var n=e.x,a=e.y,r=t.radiusX,o=t.radiusY,i=t.rotation,l=t.parent,s=l.stageHeight,c=l.stageWidth,u=be({x:-r,y:-o,width:2*r,height:2*o},{x:n,y:a},i),d=we(u,c,s);return d.width!==u.width&&(n+=(d.width-u.width)*(d.x!==u.x?-1:1)),d.height!==u.height&&(a+=(d.height-u.height)*(d.y!==u.y?-1:1)),{x:n,y:a}})),onMouseOver:function(e){var a=t.parent.stageRef;n.completionStore.selected.relationMode?(t.setHighlight(!0),a.container().style.cursor=Cr):a.container().style.cursor=kr},onMouseOut:function(e){t.parent.stageRef.container().style.cursor=Sr,n.completionStore.selected.relationMode&&t.setHighlight(!1)},onClick:function(e){var a=t.parent.stageRef;t.completion.editable&&(n.completionStore.selected.relationMode&&(a.container().style.cursor=Sr),t.setHighlight(!1),t.onClickRegion())},draggable:t.editable}),p.a.createElement(Ko,{item:t}))}));C.addTag("ellipseregion",Ti,Mi),C.addRegionType(Ti,"image");var Ai=x.types.model({name:x.types.identifier,value:x.types.maybeNull(x.types.string),resize:x.types.maybeNull(x.types.number),width:x.types.optional(x.types.string,"100%"),maxwidth:x.types.optional(x.types.string,"750px"),grid:x.types.optional(x.types.boolean,!1),gridSize:x.types.optional(x.types.number,30),gridColor:x.types.optional(Gr.color,"#EEEEF4"),zoom:x.types.optional(x.types.boolean,!1),negativezoom:x.types.optional(x.types.boolean,!1),zoomby:x.types.optional(x.types.string,"1.1"),showlabels:x.types.optional(x.types.boolean,!1),zoomcontrol:x.types.optional(x.types.boolean,!1),brightnesscontrol:x.types.optional(x.types.boolean,!1),contrastcontrol:x.types.optional(x.types.boolean,!1),rotatecontrol:x.types.optional(x.types.boolean,!1)}),zi="rectanglelabels",Pi="brushlabels",Li="ellipselabels",Di=x.types.model({type:"image",_value:x.types.optional(x.types.string,""),rotation:x.types.optional(x.types.number,0),sizeUpdated:x.types.optional(x.types.boolean,!1),naturalWidth:x.types.optional(x.types.integer,1),naturalHeight:x.types.optional(x.types.integer,1),initialWidth:x.types.optional(x.types.integer,1),initialHeight:x.types.optional(x.types.integer,1),stageWidth:x.types.optional(x.types.integer,1),stageHeight:x.types.optional(x.types.integer,1),zoomScale:x.types.optional(x.types.number,1),zoomingPositionX:x.types.maybeNull(x.types.number),zoomingPositionY:x.types.maybeNull(x.types.number),brightnessGrade:x.types.optional(x.types.number,100),contrastGrade:x.types.optional(x.types.number,100),cursorPositionX:x.types.optional(x.types.number,0),cursorPositionY:x.types.optional(x.types.number,0),brushControl:x.types.optional(x.types.string,"brush"),brushStrokeWidth:x.types.optional(x.types.number,15),mode:x.types.optional(x.types.enumeration(["drawing","viewing","brush","eraser"]),"viewing"),regions:x.types.array(x.types.union(xi,ji,Ti,ai,ki),[])}).views((function(e){return{get hasStates(){var t=e.states();return t&&t.length>0},get completion(){return Object(x.getRoot)(e).completionStore.selected},get regs(){var t;return(null===(t=e.completion)||void 0===t?void 0:t.regionStore.regions.filter((function(t){return t.object===e})))||[]},get selectedShape(){return e.regs.find((function(e){return e.selected}))},states:()=>e.completion.toNames.get(e.name),activeStates(){var t=e.states();return t&&t.filter((function(e){return e.isSelected&&e.type.includes("labels")}))},controlButton(){var t=e.states();if(t&&0!==t.length){var n=t[0];return t.forEach((function(e){e.type!==zi&&e.type!==Pi&&e.type!==Li||(n=e)})),n}},get controlButtonType(){var t=e.controlButton();return Object(x.getType)(t).name}}})).actions((function(e){var t=new yi({obj:e});return{afterCreate:function(){e.zoomcontrol&&t.addTool("zoom",Ro.create({},{manager:t})),e.brightnesscontrol&&t.addTool("brightness",Vo.create({},{manager:t})),e.contrastcontrol&&t.addTool("contrast",Yo.create({},{manager:t})),e.rotatecontrol&&t.addTool("rotate",zo.create({},{manager:t}))},getToolsManager:function(){return t}}})).actions((function(e){return{freezeHistory(){},updateBrushControl(t){e.brushControl=t},updateBrushStrokeWidth(t){e.brushStrokeWidth=t},setBrightnessGrade(t){e.brightnessGrade=t},setContrastGrade(t){e.contrastGrade=t},setGridSize(t){e.gridSize=t},setPointerPosition(t){var n=t.x,a=t.y;e.freezeHistory(),e.cursorPositionX=n,e.cursorPositionY=a},setZoom(t,n,a){e.resize=t,e.zoomScale=t,e.zoomingPositionX=n,e.zoomingPositionY=a},setZoomPosition(t,n){e.zoomingPositionX=t,e.zoomingPositionY=n},setMode(t){e.mode=t},setImageRef(t){e.imageRef=t},setStageRef(t){e.stageRef=t,e.initialWidth>1||(e.initialWidth=t&&t.attrs&&t.attrs.width?t.attrs.width:1,e.initialHeight=t&&t.attrs&&t.attrs.height?t.attrs.height:1)},setSelected(e){},rotate(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-90;e.rotation=(e.rotation+t+360)%360;var n=e.stageWidth;e.stageWidth=e.stageHeight,e.stageHeight=n;var a=e.naturalWidth;e.naturalWidth=e.naturalHeight,e.naturalHeight=a;var r=e.stageHeight/e.stageWidth;e.regions.forEach((function(e){return e.rotate(t)})),e._updateImageSize({width:n,height:Math.round(r*n),naturalWidth:e.naturalWidth,naturalHeight:e.naturalHeight})},_updateImageSize(t){var n=t.width,a=t.height,r=t.naturalWidth,o=t.naturalHeight,i=t.userResize;void 0!==r&&(e.naturalWidth=r,e.naturalHeight=o),e.stageWidth=n,e.stageHeight=a,e.sizeUpdated=!0,e.regions.forEach((function(e){e.updateImageSize(n/r,a/o,n,a,i)})),e.regs.forEach((function(e){e.updateImageSize(n/r,a/o,n,a,i)}))},updateImageSize(t){var n=t.target,a=n.width,r=n.height,o=n.naturalWidth,i=n.naturalHeight;e.initialWidth=a,e.initialHeight=r,(e.rotation+360)%180===90?e._updateImageSize({width:r,height:a,naturalWidth:i,naturalHeight:o}):e._updateImageSize({width:a,height:r,naturalWidth:o,naturalHeight:i}),setTimeout(e.completion.reinitHistory,0)},checkLabels(){var t=(e.states()||[]).filter((function(e){return e.type.includes("labels")}));return 0!==e.getAvailableStates().length||0===t.length},addShape(t){e.regions.push(t),e.completion.addRegion(t),e.setSelected(t.id),t.selectRegion()},fixZoomedCoords(t){var n=Object(Qt.a)(t,2),a=n[0],r=n[1];return[(a-e.zoomingPositionX)/e.zoomScale,(r-e.zoomingPositionY)/e.zoomScale]},zoomOriginalCoords(t){var n=Object(Qt.a)(t,2),a=n[0],r=n[1];return[a*e.zoomScale+e.zoomingPositionX,r*e.zoomScale+e.zoomingPositionY]},fixForZoom:t=>function(n){var a=void 0===n.x,r=e.fixZoomedCoords(a?n:[n.x,n.y]),o=Object(Qt.a)(r,2),i=o[0],l=o[1],s=t(a?[i,l]:{x:i,y:l}),c=e.zoomOriginalCoords(a?s:[s.x,s.y]);return a?c:{x:c[0],y:c[1]}},onResize(t,n,a){e._updateImageSize({width:t,height:n,userResize:a})},event(t,n){for(var a,r=arguments.length,o=new Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];(a=e.getToolsManager()).event.apply(a,[t,n.evt||n].concat(Object(qn.a)(e.fixZoomedCoords(o))))},fromStateJSON(t,n){var a=e.getToolsManager().allTools();0===a.length&&t.value.choices?e.completion.names.get(t.from_name).fromStateJSON(t):a.forEach((function(e){return e.fromStateJSON&&e.fromStateJSON(t,n)}))}}})),Ii=x.types.compose("ImageModel",Ai,Di,Aa,Na),Hi=Object(E.b)("store")(fi);C.addTag("image",Ii,Hi),C.addObjectType(Ii);var Bi=x.types.model("TextRegionModel",{type:"textrange",object:x.types.late((function(){return x.types.reference(Xi)})),start:x.types.number,end:x.types.number,text:""}).views((function(e){return{get parent(){return e.object},get regionElement(){return e._spans[0]}}})).actions((function(e){return{beforeDestroy(){Xe.HTML.removeSpans(e._spans)},setText(t){e.text=t},serialize(){var t={value:{start:e.start,end:e.end}};return"yes"===e.object.savetextresult&&(t.value.text=e.text),t}}})),Ui=x.types.compose("TextRegionModel",dr,Ar,Pr,Mr,Bi,Fr);C.addRegionType(Ui,"text");var Vi=n(262),Fi=n.n(Vi),Wi=x.types.model("TextModel",{name:x.types.identifier,value:x.types.maybeNull(x.types.string),valuetype:x.types.optional(x.types.enumeration(["text","url"]),(function(){return window.LS_SECURE_MODE?"url":"text"})),savetextresult:x.types.optional(x.types.enumeration(["none","no","yes"]),(function(){return window.LS_SECURE_MODE?"no":"none"})),selectionenabled:x.types.optional(x.types.boolean,!0),highlightcolor:x.types.maybeNull(Gr.color),showlabels:x.types.optional(x.types.boolean,!0),granularity:x.types.optional(x.types.enumeration(["symbol","word","sentence","paragraph"]),"symbol"),encoding:x.types.optional(x.types.enumeration(["none","base64","base64unicode"]),"none")}),Yi=x.types.model("TextModel",{type:"text",loaded:x.types.optional(x.types.boolean,!1),_value:x.types.optional(x.types.string,""),_update:x.types.optional(x.types.number,1)}).views((function(e){return{get hasStates(){var t=e.states();return t&&t.length>0},get completion(){return Object(x.getRoot)(e).completionStore.selected},get regs(){return e.completion.regionStore.regions.filter((function(t){return t.object===e}))},states:()=>e.completion.toNames.get(e.name),activeStates(){var t=e.states();return t&&t.filter((function(e){return e.isSelected&&"labels"===e.type}))}}})).actions((function(e){return{setRef(t){e._ref=t},needsUpdate(){e._update=e._update+1},updateValue(t){if(e._value=Ma(e.value,t.task.dataObj),"url"===e.valuetype){var n=e._value;if(!/^https?:\/\//.test(n)){var a=[];return n?(a.push("URL (".concat(n,") is not valid.")),a.push('You should not put text directly in your task data if you use valuetype="url".')):a.push("URL is empty, check ".concat(e.value," in data JSON.")),window.LS_SECURE_MODE&&a.unshift('In SECURE MODE valuetype set to "url" by default.'),Ra.error(a.map((function(e){return p.a.createElement("p",null,e)}))),void e.loadedValue("")}fetch(n).then((function(e){if(!e.ok)throw new Error("".concat(e.status," ").concat(e.statusText));return e.text()})).then(e.loadedValue).catch((function(t){var a=tr.ERR_LOADING_HTTP({attr:e.value,error:String(t),url:n});Ra.error(a,"Wow!"),e.loadedValue("")}))}else e.loadedValue(e._value)},loadedValue(t){e.loaded=!0,"base64"===e.encoding&&(t=atob(t)),"base64unicode"===e.encoding&&(t=Xe.Checkers.atobUnicode(t)),e._value=t,e._regionsCache.forEach((function(t){var n=t.region,a=t.completion;n.setText(e._value.substring(n.startOffset,n.endOffset)),e.regions.push(n),a.addRegion(n)})),e._regionsCache=[]},afterCreate(){e._regionsCache=[],"none"===e.savetextresult&&("url"===e.valuetype?e.savetextresult="no":"text"===e.valuetype&&(e.savetextresult="yes"))},createRegion(t){var n=Ui.create(t);if(n._range=t._range,"url"!==e.valuetype||!1!==e.loaded)return e.regions.push(n),e.completion.addRegion(n),n;e._regionsCache.push({region:n,completion:e.completion})},addRegion(t){t.start=t.startOffset,t.end=t.endOffset;var n=e.getAvailableStates();if(0!==n.length){var a=n[0],r={[a.valueType]:a.selectedValues()},o=e.completion.createResult(t,r,a,e);return o._range=t._range,o}},fromStateJSON(t,n){var a,r,o=e.completion.names.get(t.from_name);if(o.fromStateJSON(t),o.perregion||"labels"===n.type){var i=t.value,l=i.start,s=i.end;if(a=e.findRegion({startOffset:t.value.start,endOffset:t.value.end}),n)if(r=M(n),a&&n.perregion)a.states.push(r);else{var c={pid:t.id,parentID:null===t.parent_id?"":t.parent_id,startOffset:l,endOffset:s,start:"",end:"",score:t.score,readonly:t.readonly,text:e._value.substring(l,s),normalization:t.normalization,states:[r]};a=e.createRegion(c)}return a}}}})),Xi=x.types.compose("TextModel",Ar,Wi,Yi,Na),Gi=function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.store;return t._value?p.a.createElement(qi,{store:n,item:t}):null}}]),n}(d.Component),Ki=function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(h.a)(this,n),(a=t.call(this,e)).myRef=p.a.createRef(),a}return Object(f.a)(n,[{key:"getValue",value:function(){var e=this.props,t=e.item,n=e.store,a=Ma(t.value,n.task.dataObj);return"base64"===t.encoding&&(a=atob(a)),"base64unicode"===t.encoding&&(a=Xe.Checkers.atobUnicode(a)),a}},{key:"alignWord",value:function(e,t,n){var a=this.getValue(),r=a.substring(0,t),o=e.cloneRange();if(r.length>0){var i=r.lastIndexOf(" "),l=r.lastIndexOf("\n"),s=i>l?i:l;if(-1===s&&o.setStart(e.startContainer,0),s>0){var c=Xe.HTML.findIdxContainer(this.myRef,s+1),u=c.node,d=c.len;o.setStart(u,d)}}var p=a.substring(n,a.length);if(p.length>0){var m,g=p.indexOf(" "),h=p.indexOf("\n");if(-1===h&&(m=g),-1===g&&(m=h),h>0&&g>0&&(m=g>h?h:g),-1===(m+=n)&&o.setEnd(e.endContainer,e.endContainer.length),m>0){var f=Xe.HTML.findIdxContainer(this.myRef,m+1),y=f.node,v=f.len;o.setEnd(y,v>0?v-1:0)}}return o}},{key:"alignRange",value:function(e){var t=this.props.item,n=t.activeStates()[0].selectedLabels[0].granularity||t.granularity;if("symbol"===n)return e;var a=Xe.HTML.mainOffsets(this.myRef),r=a.start,o=a.end;return"word"===n?this.alignWord(e,r,o):void 0}},{key:"captureDocumentSelection",value:function(e){var t,n=[],a=[],r=window.getSelection();if(r.isCollapsed)return[];var o=e.altKey;for(t=0;t<r.rangeCount;t++){var i=r.getRangeAt(t);if("DIV"===i.endContainer.nodeName&&i.setEnd(i.startContainer,i.startContainer.length),o||(i=this.alignRange(i)),!i.collapsed&&!/^\s*$/.test(i.toString()))try{var l=Vr.fromRange(i,this.myRef);Be(i),l._range=i;var s=Array.from(i.cloneContents().childNodes).reduce((function(e,t){return e+("BR"===t.tagName?"\n":t.textContent)}),"");l.text=s;var c=Xe.HTML.toGlobalOffset(this.myRef,i.startContainer,i.startOffset),u=Xe.HTML.toGlobalOffset(this.myRef,i.endContainer,i.endOffset);l.startOffset=c,l.endOffset=u,null===l?a.push(i):n.push(l)}catch(d){}}return r.removeAllRanges(),n}},{key:"onClick",value:function(e){}},{key:"onMouseUp",value:function(e){var t=this.props.item;if(t.selectionenabled){var n=t.activeStates();if(n&&0!==n.length){var a=this.captureDocumentSelection(e);if(0!==a.length){t._currentSpan=null;var r=t.addRegion(a[0]);if(r){var o=r.createSpans();r.addEventsToSpans(o)}}}}}},{key:"_handleUpdate",value:function(){var e=this.myRef;this.props.item.regs.forEach((function(t){var n,a;if(!(null===(n=t._spans)||void 0===n||null===(a=n[0])||void 0===a?void 0:a.isConnected)){var r=function(e,t){var n=t;return function e(t){if("#text"===t.nodeName){if(n-t.length<=0)return{node:t,left:n};n-=t.length}if("BR"===t.nodeName){if(n-1<0)return{node:t,left:n};n-=1}for(var a=0;a<=t.childNodes.length;a++){var r=t.childNodes[a];if(r){var o=e(r);if(o)return o}}}(e)},o=r(e,t.start),i=r(e,t.end),l=document.createRange();l.setStart(o.node,o.left),l.setEnd(i.node,i.left),Be(l),t._range=l;var s=t.createSpans();t.addEventsToSpans(s)}}))}},{key:"componentDidUpdate",value:function(){this._handleUpdate()}},{key:"componentDidMount",value:function(){this._handleUpdate();var e=this.myRef,t=this.props.store.settings;e&&e.classList&&t&&e.classList.toggle("htx-line-numbers",t.showLineNumbers)}},{key:"render",value:function(){var e=this,t=this.props.item;if(!t.loaded)return null;var n=t._value.split("\n").reduce((function(e,t,n){return n&&e.push(p.a.createElement("br",{key:n})),e.push(p.a.createElement("span",{className:Fi.a.line},t)),e}),[]);return p.a.createElement(Pa,{item:t},p.a.createElement("div",{ref:function(n){e.myRef=n,t.setRef(n)},className:Fi.a.block+" htx-text","data-update":t._update,onMouseUp:this.onMouseUp.bind(this)},n))}}]),n}(d.Component),Ji=Object(E.b)("store")(Object(E.c)(Gi)),qi=Object(E.b)("store")(Object(E.c)(Ki));C.addTag("text",Xi,Ji),C.addObjectType(Xi);var Zi=n(87),$i=n.n(Zi),Qi=n(164),el=n(21);function tl(e){return function(t){return x.types.maybeNull(x.types.array(e(t)))}}function nl(e,t){return function(n){return x.types.union({dispatcher:function(a){if(n.find((function(e){return a.type===e})))return e(a.type);throw Error(t+a.type)}})}}var al=nl(C.getModelByTag,"Not expecting tag: ");var rl={unionArray:function(e){return x.types.maybeNull(x.types.array(al(e)))},allModelsTypes:function(){var e=[{dispatcher:function(e){if(!e)return x.types.literal(void 0);if(C.tags.includes(e.type))return C.getModelByTag(e.type);throw Error("Not expecting tag: "+e.type)}},C.modelsArr()],t=[].concat.apply([],e);return x.types.union.apply(null,t)},unionTag:function(e){return x.types.maybeNull(x.types.enumeration("unionTag",e))},isType:function(e,t){var n,a=Object(x.getType)(e),r=Object(S.a)(t);try{for(r.s();!(n=r.n()).done;){if(a===n.value)return!0}}catch(o){r.e(o)}finally{r.f()}return!1},getParentOfTypeString:function(e,t){var n=Object(x.getParent)(e);Array.isArray(t)||(t=[t]);for(var a=function(){var e=Object(x.getType)(n).name;if(t.find((function(t){return t===e})))return{v:n};n=Object(x.getParent)(n)};n;){var r=a();if("object"===typeof r)return r.v}return null},tagsArray:tl(al),toolsArray:tl(nl(C.getTool,"Not expecting tool: "))},ol=function(e){return e.substr(1)},il=function(){return(window.screen&&window.screen.width||1440)*(window.devicePixelRatio||2)},ll=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e6;if(e.length<=t)return e;var n=0,a=(e.length-1)/(t-1);return e.filter((function(e,t){return!(t<n)&&(n+=a,!0)}))},sl=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=(null===(t=e.style)||void 0===t?void 0:t.fillcolor)||"grey";return Xe.Colors.convertToRGBA(a,n)},cl=function(e){return!el.e.sourceEvent||(e?el.e.sourceEvent.type===e:["start","brush","end"].includes(el.e.sourceEvent.type))},ul=function(e){return new Date(e).toLocaleString()},dl=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"auto",a=e.split("\n");if("auto"!==n&&!a[0].includes(n))throw new Error(['Cannot find provided separator "'.concat(n,'".'),"Row 1: ".concat(a[0])].join("\n"));if("auto"===n&&a.length>1){var r=a[1].trim().match(/[,;\s\t]/g);if(!r.length)throw new Error("No separators found");if(r.some((function(e){return e!==r[0]}))){var o=Array.from(new Set(r)).map(ee).map((function(e){return'"'.concat(e,'"')})).join(", ");throw new Error(["More than one possible separator found: ".concat(o),'You can provide correct one with <Timeseries sep=",">'].join("\n"))}if(n=r[0],a[0].split(n).length!==a[1].split(n).length)throw new Error(["Different amount of elements in rows.","Row 1: ".concat(a[0]),"Row 2: ".concat(a[1]),"Guessed separator: ".concat(n),'You can provide correct one with <Timeseries sep=",">'].join("\n"))}var i=new RegExp(['"(""|[^"]+)*"','[^"'.concat(n,"]+"),"(?=".concat(n,"(").concat(n,"|$))"),"^(?=".concat(n,")")].join("|"),"g"),l=function(e){return e.trim().match(i)},s=performance.now();t=l(a[0]);var c=l(a[1]);t.every((function(e,t){return isNaN(e)===isNaN(c[t])}))?t=t.map((function(e,t){return String(t)})):(a.shift(),t=t.map((function(e){return e.toLowerCase()})));var u,d,p,m={},g=Object(S.a)(t);try{for(g.s();!(u=g.n()).done;){var h=u.value;m[h]=[]}}catch(w){g.e(w)}finally{g.f()}if(t.length!==l(a[0]).length)throw new Error(["Column names count differs from data columns count.","Columns: ".concat(t.join(", "),";"),"Data: ".concat(a[0],";"),'Separator: "'.concat(n,'".')].join("\n"));var f,y=Object(S.a)(a);try{for(y.s();!(f=y.n()).done;){var v=f.value;if(v.trim())for(d=l(v),p=0;p<d.length;p++){var b=+d[p];m[t[p]].push(isNaN(b)?d[p]:b)}}}catch(w){y.e(w)}finally{y.f()}return console.log("Parsed in ".concat(performance.now()-s," ms")),[m,t]},pl=function(e){if(X(e)&&"{"===e[0])try{return JSON.parse(e)}catch(t){}return!1},ml={required:(e,t)=>({modelName:e,field:t,error:"ERR_REQUIRED"}),unknownTag:(e,t,n)=>({modelName:e,field:t,value:n,error:"ERR_UNKNOWN_TAG"}),tagNotFound:(e,t,n)=>({modelName:e,field:t,value:n,error:"ERR_TAG_NOT_FOUND"}),tagUnsupported:(e,t,n,a)=>({modelName:e,field:t,value:n,validType:a,error:"ERR_TAG_UNSUPPORTED"}),badAttributeValueType:(e,t,n,a)=>({modelName:e,field:t,value:n,validType:a,error:"ERR_BAD_TYPE"}),internalError:e=>({error:"ERR_INTERNAL",value:String(e).substr(0,1e3),field:String(e.code),modelName:""}),generalError:e=>({error:"ERR_GENERAL",value:String(e).substr(0,1e3),field:String(e.code),modelName:""}),loadingError(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:tr.ERR_LOADING_HTTP;return console.log("ERR",e,e.code),{error:"ERR_GENERAL",value:a({attr:n,error:String(e),url:t}),field:n,modelName:""}}},gl=function(e,t){var n=t.properties.name;return n&&!n.optionalValues&&void 0===e.name?ml.required(t.name,"name"):null},hl=function(e,t,n){var a=t.properties,r=a.toname,o=a.controlledTags;if(r&&void 0===e.toname)return ml.required(t.name,"toname");if(!e.toname)return null;var i,l=e.toname.split(","),s=Object(S.a)(l);try{var c=function(){var e=i.value,a=n.find((function(t){return t.name===e}));return void 0===a?{v:ml.tagNotFound(t.name,"toname",e)}:o&&o.validate(a.tagName).length?{v:ml.tagUnsupported(t.name,"toname",a.tagName,o)}:void 0};for(s.s();!(i=s.n()).done;){var u=c();if("object"===typeof u)return u.v}}catch(d){s.e(d)}finally{s.f()}return null},fl=function(e,t,n){for(var a=[],r=0,o=Object.keys(t.properties);r<o.length;r++){var i=o[r];if(e.hasOwnProperty(i)&&!n.includes(i)){var l=e[i],s=t.properties[i.toLowerCase()];0!==s.validate(l,s).length&&a.push(ml.badAttributeValueType(t.name,i,l,s))}}return a},yl=function(){function e(){Object(h.a)(this,e)}return Object(f.a)(e,null,[{key:"validate",value:function(e){var t,n=function e(t){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=[],o=Object(S.a)(t.children);try{for(o.s();!(n=o.n()).done;){var i,l=n.value,s=Object(u.a)(Object(u.a)({},l),{},{parent:null!==(i=null===a||void 0===a?void 0:a.id)&&void 0!==i?i:null});delete s.children,r.push(s),l.children instanceof Array&&r.push.apply(r,Object(qn.a)(e(l,l)))}}catch(c){o.e(c)}finally{o.f()}return r}(e),a=["id","children","name","toname","controlledTags"],r=[],o=Object(S.a)(n);try{for(o.s();!(t=o.n()).done;){var i=t.value,l=C.getModelByTag(i.type),s=gl(i,l);null!==s&&r.push(s);var c=hl(i,l,n);null!==c&&r.push(c),r.push.apply(r,Object(qn.a)(fl(i,l,a)))}}catch(d){o.e(d)}finally{o.f()}return r.length?r.map((function(e){return Object(u.a)(Object(u.a)({},e),{},{validType:(t=e.validType,t?function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.describe().match(/([a-z0-9?|]+)/gi).join("").split("|");if(!1===t){var a=n.indexOf("null?");a>=0&&n.splice(a,1)}return n}(t,!1):null)});var t})):[]}}]),e}(),vl=x.types.model({}).views((function(e){return{get persistentValuesKey(){return"labelStudio:storedValues"},get persistentValues(){return{}}}})).actions((function(e){return{afterCreate(){setTimeout(e.restoreValues)},beforeDestroy(){e.storeValues()},storeValues(){var t,n=e.persistentValuesKey,a={task:null===(t=Object(x.getRoot)(e).task)||void 0===t?void 0:t.id,values:e.persistentValues};localStorage.setItem(n,JSON.stringify(a))},restoreValues(){var t,n=JSON.parse(localStorage.getItem(e.persistentValuesKey)||"{}");if(n&&n.task===(null===(t=Object(x.getRoot)(e).task)||void 0===t?void 0:t.id))for(var a=n.values||{},r=0,o=Object.keys(a);r<o.length;r++){var i=o[r];e[i]=a[i]}}}})),bl=x.types.model({legend:"",units:"",displayformat:x.types.optional(x.types.string,".1f"),interpolation:x.types.optional(x.types.enumeration(Object.values({curvestep:"curveStep",curvebasis:"curvebasis",curvebasisopen:"curveBasisOpen",curvebundle:"curveBundle",curvecardinal:"curveCardinal",curvecardinalopen:"curveCardinalOpen",curvecatmullrom:"curveCatmullRom",curvecatmullromopen:"curveCatmullRomOpen",curvelinear:"curveLinear",curvemonotonex:"curveMonotoneX",curvemonotoney:"curveMonotoneY",curvenatural:"curveNatural",curveradial:"curveRadial",curvestep:"curveStep",curvestepafter:"curveStepAfter",curvestepbefore:"curveStepBefore"})),"curveStep"),height:x.types.optional(x.types.string,"200"),strokewidth:x.types.optional(x.types.string,"1"),strokecolor:x.types.optional(x.types.string,"#1f77b4"),column:x.types.string}),wl=x.types.model("ChannelModel",{id:x.types.optional(x.types.identifier,N),type:"channel",children:rl.unionArray(["channel","view"])}).views((function(e){return{get parent(){return rl.getParentOfTypeString(e,"TimeSeriesModel")},get columnName(){var t=e.column;return/^\d+$/.test(t)&&(t=e.parent.headers[t]||t),t=t.toLowerCase()}}})),xl=x.types.compose("ChannelModel",wl,bl,Na),El=function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(){var e;Object(h.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).ref=p.a.createRef(),e.extent=[0,0],e.useOptimizedData=!1,e.optimizedSeries=null,e.zoomStep=10,e.height=+e.props.item.height,e.state={width:840},e.changeWidth=function(){var t=e.ref.current.offsetWidth;console.log("WIDTH",t);var n=e.props.item.parent.margin;if(t){var a=t-n.left-n.right;e.setState({width:a})}},e.getRegion=function(t,n){var a=t.map((function(t){return+e.stick(t)[0]})),r=Object(Qt.a)(a,2),o=r[0],i=r[1];return{start:o,end:n?o:i}},e.createBrushMovedHandler=function(t){return function(){if(!cl("end")&&el.e.selection){var n=e.props.ranges,a=e.props.item.parent,r=n.findIndex((function(e){return e.id===t}));if(r<0)console.error("REGION ".concat(t," was not found"));else{var o=n[r],i=e.getRegion(el.e.selection,o.instant);i.start===o.start&&i.end===o.end?(a.completion.unselectAreas(),o.onClickRegion()):a.regionChanged(i,r)}}}},e.newBrushHandler=function(){var t=e.props,n=t.ranges,a=t.item.parent,r=a.activeStates(),o=r&&r.length;if(!cl("end")){if(!el.e.selection){var i=el.k(el.e.sourceEvent.target)[0],l=e.newRegion;l&&Math.abs(l.x-i)<4?(clearTimeout(e.newRegionTimer),a.regionChanged(l.range,n.length,l.states),e.newRegion=null,e.newRegionTimer=null):o&&(e.newRegion={range:e.getRegion([i,i]),states:r.map((function(e){return T(e)})),x:i},e.newRegionTimer=setTimeout((function(){e.newRegion=null,e.newRegionTimer=null}),300));var s=e.x.invert(i),c=n.filter((function(e){return e.start<=s&&e.end>=s})),u=c.findIndex((function(e){return e.selected}))+1,d=c[u];return a.completion.unselectAreas(),void(d&&d.onClickRegion())}var p=e.getRegion(el.e.selection);e.brushCreator.move(e.gCreator,null),o&&a.addRegion(p.start,p.end)}},e.updateTracker=function(t){var n=e.state.width;if(!(t<0||t>n)){var a=e.stick(t),r=Object(Qt.a)(a,2),o=r[0],i=r[1];e.tracker.attr("transform","translate(".concat(e.x(o)+.5,",0)")),e.trackerTime.text(e.formatTime(o)),e.trackerValue.text(e.formatValue(i)+" "+e.props.item.units),e.trackerPoint.attr("cy",e.y(i)),e.tracker.attr("text-anchor",t>n-100?"end":"start")}},e.renderTracker=function(){var t=e.updateTracker;e.tracker=e.main.append("g").style("pointer-events","none"),e.trackerValue=e.tracker.append("text").attr("font-size",10).attr("fill","#666"),e.trackerTime=e.tracker.append("text").attr("y",e.height-1).attr("font-size",10).attr("fill","#666"),e.trackerPoint=e.tracker.append("circle").attr("cx",0).attr("r",3).attr("stroke","red").attr("fill","none"),e.tracker.append("line").attr("y1",e.height).attr("y2",0).attr("stroke","#666"),e.main.on("mousemove",(function(){t(el.k(this)[0])}))},e.renderXAxis=function(){var t=e.props.item,n=e.state.width,a=t.parent.margin,r=e.height+a.top,o=-a.top;e.main.selectAll(".xaxis").data([0]).enter().append("g").attr("class","xaxis").attr("transform","translate(0,".concat(o,")")).call(el.a(e.x).ticks(n/80).tickSize(r+4)).call((function(e){return e.selectAll(".domain").remove()})).call((function(e){return e.selectAll(".tick").attr("stroke-opacity",.2).selectAll(".bottom").data([0]).enter().append("line").attr("class","bottom").attr("stroke","currentColor").attr("y1",r+16).attr("y2",r+a.bottom)}))},e.renderYAxis=function(){e.main.append("g").call(el.b(e.y).tickFormat(e.formatValue).tickSize(3)).call((function(e){return e.select(".domain").remove()})).call((function(t){return t.append("text").attr("class","title").attr("font-size",8).attr("x",-6).attr("y",0).attr("fill","currentColor").attr("text-anchor","end").text(e.props.item.units)}))},e}return Object(f.a)(n,[{key:"renderBrushes",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.state.width,a=this.height,r=this.props.item,o=[[0,0],[n,a]],i=el.d().extent(o),l=this.x;t&&this.gBrushes.selectAll(".brush").remove();var s=this.gBrushes.selectAll(".brush").data(e,(function(e){return e.id})),c=this.createBrushMovedHandler,u=this.updateTracker,d=this.getRegion;s.enter().append("g").attr("class","brush").attr("id",(function(e){return"brush_".concat(r.id,"_").concat(e.id)})).each((function(e){var t=el.n(this),n=el.d().extent(o);n.on("brush",(function(){if(!cl("brush")){var n=d(el.e.selection,e.instant);i.move(t,[l(n.start),l(n.end)+.5*e.instant]),u(el.k(this)[0])}})),n.on("end",c(e.id)),n(t),e.instant?t.selectAll(".handle").style("pointer-events","none"):t.selectAll(".selection").style("pointer-events","none"),t.selectAll(".overlay").style("pointer-events","none"),void 0!==e._brushRef&&e._brushRef.isConnected||(e._brushRef=t.select(".selection").node())})).merge(s).each((function(e,t){var n=el.n(this),a=n.selectAll(".selection"),r=sl(e);if(e.instant){a.attr("stroke-opacity",e.selected||e.highlighted?.6:.2).attr("fill-opacity",e.selected||e.highlighted?1:.6).attr("stroke-width",3).attr("stroke",r).attr("fill",r);var o=l(e.start);i.move(n,[o,o+1])}else a.attr("stroke-opacity",e.selected||e.highlighted?.8:.5).attr("fill-opacity",e.selected||e.highlighted?.6:.3).attr("stroke",r).attr("fill",r),i.move(n,[e.start,e.end].map(l))})),s.exit().remove()}},{key:"renderBrushCreator",value:function(){this.gCreator?this.gCreator.selectAll("*").remove():this.gCreator=this.main.append("g").attr("class","new_brush");var e=this.updateTracker,t=this.gCreator,n=this.getRegion,a=this.x,r=this.brushCreator=el.d().extent([[0,0],[this.state.width,this.height]]).on("brush",(function(){if(!cl("brush")&&el.e.selection){var o=n(el.e.selection);r.move(t,[a(o.start),a(o.end)]),e(el.k(this)[0])}})).on("end",this.newBrushHandler);this.gCreator.call(this.brushCreator)}},{key:"initZoom",value:function(){var e=this,t=this.props,n=t.data,a=t.item,r=n[t.time],o=a.parent.throttledRangeUpdate();this.main.on("wheel",(function(){var t=el.e;if(t.ctrlKey||t.metaKey){t.preventDefault();var n=e.props.range,a=n.map((function(e){return el.c(r,e)})),i=el.k(el.e.target),l=Object(Qt.a)(i,1)[0],s=e.x.range()[1],c=Math.min(.3,-t.deltaY/e.height);if(!(a[1]-a[0]<10&&c>0)){var u=n[1]-n[0],d=[Math.max(+e.extent[0],+n[0]+u*c*l/s),Math.min(+e.extent[1],n[1]-u*c*(1-l/s))];o(d,c)}}}))}},{key:"componentDidMount",value:function(){var e=this;if(this.ref.current){var t=this.props,n=t.data,a=t.item,r=t.range,o=t.time,i=t.column,l=a.parent,s=l.isDate,c=l.formatTime,u=l.margin,d=l.slicesCount,p=this.height;this.zoomStep=d;var m="clip_".concat(a.id),g=n[o],h=n[i],f=this.props.series;if(h){this.useOptimizedData=f.length>il()*this.zoomStep,this.useOptimizedData&&(this.optimizedSeries=ll(f,il()*this.zoomStep)),this.slices=a.parent.dataSlices;var y=el.g(a.displayformat);this.formatValue=y,this.formatTime=c;var v=this.ref.current.offsetWidth,b=v?v-u.left-u.right:this.state.width;this.state.width=b,this.extent=el.f(g);var w=(s?el.m():el.l()).domain(this.extent).range([0,b]),E=el.l().domain([el.j(h),el.i(h)]).range([p-u.max,u.min]);this.x=w,this.y=E,this.plotX=w.copy(),this.stick=function(e){var t=w.invert(e),n=el.c(g,t);return g[n]-t>t-g[n-1]&&n--,[g[n],h[n]]},this.line=el.h().y((function(t){return e.y(t[i])})).x((function(t){return e.plotX(t[o])})),this.lineSlice=el.h().defined((function(e){return e[o]>=r[0]&&e[o]<=r[1]})).y((function(t){return e.y(t[i])})).x((function(t){return e.x(t[o])}));var S=el.n(this.ref.current).append("svg").attr("viewBox",[0,0,b+u.left+u.right,p+u.top+u.bottom]).style("display","block").append("g").attr("transform","translate("+u.left+","+u.top+")");S.append("clipPath").attr("id",m).append("rect").attr("x",0).attr("y",0).attr("height",p).attr("width",b),S.append("text").text(a.legend).attr("dx","1em").attr("dy","1em").attr("font-weight","bold").attr("font-size","1.4em").attr("dy","1em").attr("opacity",.1),this.main=S;var _=S.append("g").attr("clip-path",'url("#'.concat(m,'")'));this.path=_.append("path").datum(this.useOptimizedData?this.optimizedSeries:f).attr("d",this.line),this.path2=_.append("path"),_.selectAll("path").attr("vector-effect","non-scaling-stroke").attr("fill","none").attr("stroke-width",a.strokewidth||1).attr("stroke",a.strokecolor||"steelblue"),this.renderTracker(),this.renderYAxis(),this.setRangeWithScaling(r),this.renderBrushCreator(),this.initZoom(),this.gBrushes=S.append("g").attr("class","brushes").attr("clip-path",'url("#'.concat(m,'")')),this.renderBrushes(this.props.ranges),window.addEventListener("resize",this.changeWidth)}else{var k=Object.keys(n).filter((function(e){return e!==o})),O="`".concat(i,"` not found in data. Available columns: ").concat(k.join(", "),". For headless csv you can use column index");Object(x.getRoot)(a).completionStore.addErrors([ml.generalError(O)])}}}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.changeWidth)}},{key:"setRangeWithScaling",value:function(e){this.x.domain(e);var t=this.x.range(),n=this.plotX.domain().map(this.x),a=(n[1]-n[0])/(t[1]-t[0]),r=Math.max(0,Math.floor(this.zoomStep*(t[0]-n[0])/(n[1]-n[0]))),o=Math.max(0,Math.floor(this.zoomStep*(t[1]-n[0])/(n[1]-n[0]))),i=n[0]-t[0];console.log("SOME MATH",{left:r,right:o,xDomain:Object(qn.a)(e),pDomain:this.plotX.domain(),xRange:t,all:n,scale:a,translate:i,use:this.useOptimizedData});var l=a>this.zoomStep===this.useOptimizedData;this.optimizedSeries&&l&&(this.useOptimizedData=!this.useOptimizedData,this.useOptimizedData?(this.path.datum(this.optimizedSeries),this.path.attr("d",this.line)):this.path.attr("transform","")),this.useOptimizedData?(this.path.attr("transform","translate(".concat(i," 0) scale(").concat(a," 1)")),this.path2.attr("d","")):this.optimizedSeries?(this.path.datum(this.slices[r]),this.path.attr("d",this.lineSlice),r!==o?(this.path2.datum(this.slices[o]),this.path2.attr("d",this.lineSlice)):this.path2.attr("d","")):(this.path.attr("d",this.lineSlice),this.path2.attr("d","")),this.renderXAxis()}},{key:"componentDidUpdate",value:function(e,t){var n=this.props.range,a=this.state.width,r=!1;if(a!==t.width){var o=this.props,i=o.item,l=o.range,s=i.parent.margin,c=this.height,u=el.n(this.ref.current).selectAll("svg");u.attr("viewBox",[0,0,a+s.left+s.right,c+s.top+s.bottom]),this.x.range([0,a]),this.renderBrushCreator(),u.selectAll("clipPath rect").attr("width",a),this.setRangeWithScaling(l),this.renderBrushCreator(),r=!0}else{var d=this.x.domain();+d[0]===+n[0]&&+d[1]===+n[1]||this.setRangeWithScaling(n)}this.renderBrushes(this.props.ranges,r)}},{key:"render",value:function(){return this.props.ranges.map((function(e){var t;return e.start,e.end,e.selected,e.highlighted,void(null===(t=e.style)||void 0===t||t.fillcolor)})),this.props.range.map(Number),p.a.createElement("div",{className:"htx-timeseries-channel",ref:this.ref})}}]),n}(p.a.Component),Sl=Object(E.c)(El),_l=Object(E.c)((function(e){var t=e.item;return t.parent.dataObj?p.a.createElement(Sl,{time:t.parent.keyColumn,column:t.columnName,item:t,data:t.parent.dataObj,series:t.parent.dataHash,range:t.parent.brushRange,ranges:t.parent.regs}):null}));C.addTag("channel",xl,_l);var kl=x.types.model({name:x.types.identifier,value:x.types.string,valuetype:x.types.optional(x.types.enumeration(["url","json"]),"url"),timecolumn:"",sep:",",timeformat:"",timedisplayformat:"",overviewchannels:"",multiaxis:x.types.optional(x.types.boolean,!1),hotkey:x.types.maybeNull(x.types.string)}),Ol=x.types.model("TimeSeriesModel",{type:"timeseries",children:rl.unionArray(["channel","timeseriesoverview","view","hypertext"]),width:840,margin:x.types.frozen({top:20,right:20,bottom:30,left:50,min:10,max:10}),brushRange:x.types.array(x.types.number),_needsUpdate:x.types.optional(x.types.number,0)}).volatile((function(e){return{data:null,valueLoaded:!1,zoomedRange:0,scale:1,headers:[]}})).views((function(e){return{get regionsTimeRanges(){return e.regs.map((function(e){return[e.start,e.end]}))},get store(){return Object(x.getRoot)(e)},get completion(){return Object(x.getRoot)(e).completionStore.selected},get regs(){return e.completion.regionStore.regions.filter((function(t){return t.object===e}))},get isDate(){return Boolean(e.timeformat)||e.timedisplayformat&&/[a-zA-Z]/.test(e.timedisplayformat[0])},get keyColumn(){return(e.timecolumn||"#@$").toLowerCase()},get parseTimeFn(){return e.timeformat&&e.timecolumn?el.p(e.timeformat):Number},parseTime:t=>+(0,e.parseTimeFn)(t),get dataObj(){if(!e.valueLoaded||!e.data)return null;var t=e.data;if(e.timecolumn){if(e.timeformat){var n=t[e.keyColumn].map(e.parseTime);t=Object(u.a)(Object(u.a)({},t),{},{[e.keyColumn]:n})}}else{var a=Object.values(t)[0],r=Array.from({length:a.length},(function(e,t){return t}));t=Object(u.a)(Object(u.a)({},t),{},{[e.keyColumn]:r})}return t},get dataHash(){var t=e.dataObj,n=e.keyColumn;if(!t)return null;for(var a=[],r=0,o=Object.keys(t);r<o.length;r++)for(var i=o[r],l=0;l<t[i].length;l++)a[l]?a[l][i]=t[i][l]:a[l]={[i]:t[i][l]},e.timecolumn||(a[l][n]=l);return a},get slicesCount(){return 10},get dataSlices(){if(e.slices)return e.slices;for(var t=e.slicesCount,n=e.dataHash,a=Math.floor(n.length/t),r=[],o=0;o<t-1;o++)r[o]=n.slice(a*o,a*o+a+1);return r.push(n.slice(a*(t-1))),e.slices=r,r},get keysRange(){var t,n=null===(t=e.dataObj)||void 0===t?void 0:t[e.keyColumn];return n?[n[0],n[n.length-1]]:[]},get persistentValues(){return{brushRange:e.brushRange,initialRange:e.initialRange,scale:e.scale+1e-4}},states:()=>e.completion.toNames.get(e.name),activeStates(){var t=e.states();return t?t.filter((function(e){return e.isSelected&&"TimeSeriesLabelsModel"===Object(x.getType)(e).name})):null},formatTime(t){if(!e._format){var n=e.timedisplayformat,a=e.isDate;e._format="date"===n?ul:n?a?el.o(n):el.g(n):String}return e._format(t)}}})).actions((function(e){return{setData(t){e.data=t,e.valueLoaded=!0},setColumnNames(t){e.headers=t},setZoomedRange(t){e.zoomedRange=t},setScale(t){e.scale=t},updateView(){e._needsUpdate=e._needsUpdate+1},scrollToRegion(t){var n=Object(qn.a)(e.brushRange);if(!(t.start>=n[0]&&t.end<=n[1])){var a=n[1]-n[0],r=t.end-t.start,o=1.5*r,i=(o-r)/2;if(a<o){var l=(o-a)/2;n[0]-=l,n[1]+=l}t.start<n[0]&&(n[1]-=n[0]-(t.start-i),n[0]=t.start-i),t.end>n[1]&&(n[0]+=t.end+i-n[1],n[1]=t.end+i),n[0]=Math.max(e.keysRange[0],n[0]),n[1]=Math.min(e.keysRange[1],n[1]),e.updateTR(n,e.scale+1e-4)}},updateTR(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;null!==t&&(e.initialRange=t,e.brushRange=t,e.setZoomedRange(t[1]-t[0]),e.setScale(n),e.updateView())},throttledRangeUpdate:()=>Ha()(e.updateTR,100),fromStateJSON(t,n){if(t.value.choices&&e.completion.names.get(t.from_name).fromStateJSON(t),"timeserieslabels"in t.value){var a=M(n);a.fromStateJSON(t),e.createRegion(t.value.start,t.value.end,[a]),e.updateView()}},addRegion(t,n,a){var r=e.getAvailableStates();if(0!==r.length){var o=r[0],i={[o.valueType]:o.selectedValues()};return e.completion.createResult({start:t,end:n,instant:t===n},i,o,e)}},regionChanged(t,n,a){var r=e.regs[n],o=!1;r?(o=r.start!==t.start||r.end!==t.end,r.updateRegion(t.start,t.end)):(e.addRegion(t.start,t.end,a),o=!0),o&&e.updateView()},preloadValue:t=>Object(Qi.a)($i.a.mark((function n(){var a,r,o,i,l,s,c,u,d,p,m,g,h,f,y;return $i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=t.task.dataObj,"url"===e.valuetype){n.next=4;break}return e.value?e.setData(a[ol(e.value)]):e.setData(a),n.abrupt("return");case 4:if(e.value){n.next=8;break}return r="Attribute <b>value</b> for <b>".concat(e.name,'</b> should be provided when <b>valuetype="url"</b>'),t.completionStore.addErrors([ml.generalError(r)]),n.abrupt("return");case 8:if((o=a[ol(e.value)])&&"string"===typeof o){n.next=13;break}return i="Cannot find url in <b>".concat(ol(e.value),"</b> field of your task"),t.completionStore.addErrors([ml.generalError(i)]),n.abrupt("return");case 13:return l="",s=!1,n.prev=15,n.next=18,fetch(o);case 18:if((c=n.sent).ok){n.next=24;break}if(400!==c.status){n.next=23;break}return t.completionStore.addErrors([ml.loadingError("".concat(c.status," ").concat(c.statusText),o,e.value,tr.ERR_LOADING_S3)]),n.abrupt("return");case 23:throw new Error("".concat(c.status," ").concat(c.statusText));case 24:return n.next=26,c.text();case 26:l=n.sent,n.next=45;break;case 29:if(n.prev=29,n.t0=n.catch(15),u=n.t0,c){n.next=43;break}return n.prev=33,n.next=36,fetch(o,{mode:"no-cors"});case 36:(c=n.sent).ok||0!==c.status||(s=!0),n.next=43;break;case 40:n.prev=40,n.t1=n.catch(33),u=n.t1;case 43:return t.completionStore.addErrors([ml.loadingError(u,o,e.value,s?tr.ERR_LOADING_CORS:void 0)]),n.abrupt("return");case 45:try{d=pl(l),p=[],d||(g=e.sep,(null===(m=g)||void 0===m?void 0:m.length)>1&&(g={tab:"\t","\\t":"\t",space:" ",auto:"auto",comma:",",dot:"."}[g]||g[0]),h=dl(l,g),f=Object(Qt.a)(h,2),d=f[0],p=f[1]),e.setData(d),e.setColumnNames(p),e.updateValue(t)}catch(v){y="Problems with parsing CSV: ".concat((null===v||void 0===v?void 0:v.message)||v,"<br>URL: ").concat(o),t.completionStore.addErrors([ml.generalError(y)])}case 46:case"end":return n.stop()}}),n,null,[[15,29],[33,40]])})))(),updateValue:t=>Object(Qi.a)($i.a.mark((function n(){var a,r,o;return $i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.dataObj){n.next=3;break}return n.next=3,e.preloadValue(t);case 3:if(a=e.dataObj){n.next=6;break}return n.abrupt("return");case 6:if(r=a[e.keyColumn]){n.next=11;break}return o=["<b>".concat(e.keyColumn,"</b> not found in data."),'Use <b>valueType="url"</b> for data loading or column index for headless csv'].join(" "),t.completionStore.addErrors([ml.generalError(o)]),n.abrupt("return");case 11:if(!e.brushRange.length){n.next=13;break}return n.abrupt("return");case 13:e.updateTR([r[0],r[r.length>>2]]);case 14:case"end":return n.stop()}}),n)})))(),onHotKey(){}}}));var Cl=Object(E.c)((function(e){var t=e.item,n=e.data,a=e.series,r=(e.range,e.forceUpdate,t.regs),o=function(){var e=p.a.useState(840),t=Object(Qt.a)(e,2),n=t[0],a=t[1],r=p.a.useState(null),o=Object(Qt.a)(r,2),i=o[0],l=o[1],s=p.a.useCallback((function(e){l(e)}),[]);return p.a.useLayoutEffect((function(){if(i){var e=function(){return a(i.offsetWidth)};return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}}),[i]),[s,n,i]}(),i=Object(Qt.a)(o,3),l=i[0],s=i[1],c=i[2],u=t.margin,d=t.keyColumn,m=s-u.left-u.right,g=t.children.map((function(e){return e.columnName}));if(t.overviewchannels){var h=t.overviewchannels.toLowerCase().split(",").map((function(e){return/^\d+$/.test(e)?t.headers[e]:e})).filter((function(e){return g.includes(e)}));h.length&&(g=h)}var f=p.a.useRef(),y=p.a.useRef(),v=p.a.useRef(),b=p.a.useRef(),w=p.a.useRef(),x=(t.isDate?el.m():el.l()).domain(el.f(n[d])).range([0,m]),E=p.a.useCallback(t.throttledRangeUpdate(),[]),_=[0,m>>2],k=p.a.useRef(_);var O=el.d().extent([[0,0],[m,60]]).on("brush",(function(){if(el.e.selection&&!cl("brush")&&!cl("wheel")){var e=Object(Qt.a)(el.e.selection,2),n=e[0],a=e[1],r=k.current,o=a-n,i=+x.invert(n),l=+x.invert(a);if(r[0]===n&&r[1]===a);else if(r[0]!==n&&r[1]!==a&&Math.abs(o-10)<.001){var s=(i+l)/2;i=s-t.zoomedRange/2,l=s+t.zoomedRange/2}else o<10&&(r[0]===n?a=Math.min(m,n+10):r[1]===a&&(n=Math.max(0,a-10)),w.current.call(O.move,[n,a]));k.current=[n,a],E([i,l])}})).on("end",(function(){if(!el.e.selection){var e=el.k(this)[0],n=t.brushRange.map(x),a=n[1]-n[0]>>1,r=[e-a,e+a];r[0]<0&&(r=[0,2*a]),r[1]>m&&(r=[m-2*a,m]),w.current.call(O.move,r)}})),C=function(e){var r=t.children.find((function(t){return t.columnName===e})),o=r?r.strokecolor:"steelblue",i=el.l().domain([el.j(n[e]),el.i(n[e])]).range([60-u.max,u.min]);v.current.append("path").datum(ll(a,il())).attr("class","channel").attr("fill","none").attr("stroke",o).attr("d",el.h().y((function(t){return i(t[e])})).defined((function(e){return e[d]})).x((function(e){return x(e[d])})))};return p.a.useEffect((function(){c&&(f.current=el.n(c).append("svg").attr("viewBox",[0,0,m+u.left+u.right,60+u.bottom]).style("display","block").append("g").attr("transform","translate("+u.left+",0)"),b.current=f.current.append("g").attr("transform","translate(0,".concat(60,")")),v.current=f.current.append("g").attr("class","channels"),y.current=f.current.append("g").attr("class","regions"),w.current=f.current.append("g").call(O).call(O.move,_),w.current.select(".handle--w").style("transform","translate(-1px, 0)"),w.current.select(".handle--e").style("transform","translate(1px, 0)"))}),[c]),p.a.useEffect((function(){if(c){el.n(c).selectAll("svg").attr("viewBox",[0,0,m+u.left+u.right,60+u.bottom]),v.current.selectAll("path").remove();var e,n=Object(S.a)(g);try{for(n.s();!(e=n.n()).done;){var a=e.value;C(a)}}catch(r){n.e(r)}finally{n.f()}b.current.call(el.a(x).ticks(m/80).tickSizeOuter(0)),w.current.call(O).call(O.move,t.brushRange.map(x))}}),[m,c]),p.a.useEffect((function(){if(w.current){var e=t.brushRange.map(x);if(e[1]-e[0]<10){var n=(e[1]+e[0])/2;e[0]=Math.max(0,n-5),e[1]=Math.min(m,n+5)}k.current=e,w.current.call(O.move,e)}}),[t.scale]),p.a.useEffect((function(){c&&function(e){var t=y.current.selectAll(".region").data(e);t.enter().append("rect").attr("class","region").merge(t).attr("y",0).attr("height",60).attr("x",(function(e){return x(e.start)})).attr("width",(function(e){return Math.max(2,x(e.end)-x(e.start))})).attr("fill",(function(e){return sl(e,e.selected?.8:.3)})),t.exit().remove()}(r)})),t.regs.map((function(e){var t;return e.start,e.end,e.selected,void(null===(t=e.style)||void 0===t||t.fillcolor)})),p.a.createElement("div",{className:"htx-timeseries-overview",ref:l})})),jl=x.types.compose("TimeSeriesModel",Na,vl,kl,Ol),Rl=Object(E.b)("store")(Object(E.c)((function(e){e.store;var t=e.item;console.log("TS",t.brushRange,t);var n=p.a.createRef();return p.a.useEffect((function(){t&&t.brushRange.length&&(t._nodeReference=n.current)}),[t,n]),t.brushRange.length&&t.data?p.a.createElement("div",{ref:n,className:"htx-timeseries"},p.a.createElement(Pa,{item:t},P.renderChildren(t),p.a.createElement(Cl,{data:t.dataObj,series:t.dataHash,item:t,range:t.brushRange}))):null})));C.addTag("timeseries",jl,Rl),C.addObjectType(jl);var Nl=x.types.model("LabelMixin").actions((function(e){return{beforeSend(){e.selectedValues()&&e.type===e._type&&e.unselectAll()},copyState(t){t.selectedValues().forEach((function(t){e.findLabel(t).setSelected(!0)}))},fromStateJSON(t,n){e.unselectAll();var a=t.value[e._type];a?(t.id&&(e.pid=t.id),a.forEach((function(t){var n=e.findLabel(t);n?n.setSelected(!0):Ra.error("Error with ".concat(e._type,". Not found: ")+a)}))):Ra.error("Error with ".concat(e._type,"."))}}})),Tl=x.types.model().views((function(e){return{get tiedChildren(){return P.filterChildrenOfType(e,e._child)},get selectedLabels(){return e.tiedChildren.filter((function(e){return!0===e.selected}))},getSelectedColor(){var t=e.tiedChildren.find((function(e){return!0===e.selected}));return t&&t.background},get selectedColor(){var t=e.tiedChildren.find((function(e){return!0===e.selected}));return t&&t.background},get isSelected(){return e.selectedLabels.length>0},get holdsState(){return e.selectedLabels.length>0},selectedValues:()=>e.selectedLabels.map((function(e){return e.alias?e.alias:e.value})),get selectedAliases(){return e.selectedLabels.filter((function(e){return e.alias})).map((function(e){return e.alias}))},getSelectedString(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:" ";return e.selectedValues().join(t)},findLabel:t=>e.tiedChildren.find((function(e){return e.alias===t||e.value===t}))}})).actions((function(e){return{unselectAll(){e.tiedChildren.forEach((function(e){return e.setSelected(!1)}))},checkMaxUsages(){var t=e.tiedChildren.filter((function(e){return!e.canBeUsed()}));return t.length&&t.forEach((function(e){return e.setSelected(!1)})),t},selectFirstVisible(){var t=e.tiedChildren.find((function(e){return e.visible}));return t&&t.toggleSelected(),t},updateFromResult(t){(e.unselectAll(),t)&&(Array.isArray(t)?t:[t]).map((function(t){return e.findLabel(t)})).forEach((function(e){return e.setSelected(!0)}))}}})),Ml=x.types.model({}).views((function(e){return{get resultType(){return e.type},get valueType(){return e.type}}})),Al=x.types.model({name:x.types.identifier,toname:x.types.maybeNull(x.types.string),strokewidth:x.types.optional(x.types.string,"15")}),zl=x.types.model({type:"brush"}).views((function(e){return{get hasStates(){var t=e.states();return t&&t.length>0},get completion(){return Object(x.getRoot)(e).completionStore.selected}}})).actions((function(e){return{afterCreate(){var t=uo.create(),n=fo.create();t._control=e,n._control=e,e.tools={brush:t,erase:n}}}})),Pl=x.types.compose("BrushModel",Al,zl,Ml);C.addTag("brush",Pl,(function(){return null}));var Ll=x.types.model({required:x.types.optional(x.types.boolean,!1),requiredmessage:x.types.maybeNull(x.types.string)}).actions((function(e){return{validate(){if(e.perregion){var t,n=e.completion.names.get(e.toname),a=Object(S.a)(n.regs);try{for(a.s();!(t=a.n()).done;){var r=t.value,o=r.results.find((function(t){return t.type===e.resultType}));if(e.whenlabelvalue&&!r.hasLabel(e.whenlabelvalue))return!0;if(!(null===o||void 0===o?void 0:o.hasValue))return e.completion.selectArea(r),e.requiredModal(),!1}}catch(i){a.e(i)}finally{a.f()}}else if(!e.holdsState)return e.requiredModal(),!1;return!0}}})),Dl=n(348),Il=n.n(Dl),Hl=x.types.model({value:x.types.maybeNull(x.types.string),selected:x.types.optional(x.types.boolean,!1),maxusages:x.types.maybeNull(x.types.string),alias:x.types.maybeNull(x.types.string),hotkey:x.types.maybeNull(x.types.string),showalias:x.types.optional(x.types.boolean,!1),aliasstyle:x.types.optional(x.types.string,"opacity: 0.6"),size:x.types.optional(x.types.string,"medium"),background:x.types.optional(Gr.color,fr),selectedcolor:x.types.optional(Gr.color,"#ffffff"),granularity:x.types.maybeNull(x.types.enumeration(["symbol","word","sentence","paragraph"])),groupcancontain:x.types.maybeNull(x.types.string)}),Bl=x.types.model({id:x.types.optional(x.types.identifier,N),type:"label",visible:x.types.optional(x.types.boolean,!0),_value:x.types.optional(x.types.string,"")}).views((function(e){return{get completion(){return Object(x.getRoot)(e).completionStore.selected},get maxUsages(){return Number(e.maxusages||e.parent.maxusages)},usedAlready:()=>e.completion.regionStore.regions.reduce((function(t,n){return t+n.hasLabel(e.value)}),0),canBeUsed:()=>!e.maxUsages||e.usedAlready()<e.maxUsages,get parent(){return rl.getParentOfTypeString(e,["LabelsModel","EllipseLabelsModel","RectangleLabelsModel","PolygonLabelsModel","KeyPointLabelsModel","BrushLabelsModel","HyperTextLabelsModel","TimeSeriesLabelsModel"])}}})).actions((function(e){return{toggleSelected(){var t=e.completion.highlightedNode,n=t&&t.parent.name===e.parent.toname;if((!t||!0!==t.readonly||!n)&&e.completion.editable)if(e.selected||e.canBeUsed()){var a=e.parent;if(!(t&&n&&1===a.selectedLabels.length&&e.selected)){if(!a.selectedLabels.length&&!e.selected){e.completion.toNames.get(a.toname).filter((function(e){return e.type&&e.type.endsWith("labels")&&e.name!==a.name})).forEach((function(e){return e.unselectAll&&e.unselectAll()}));var r=Object.values(e.parent.tools||{})[0];r&&r.manager.findSelectedTool()!==r&&(r.manager.unselectAll(),r.setSelected(!0))}a.shouldBeUnselected||e.setSelected(!e.selected),a.shouldBeUnselected&&(e.selected?a.unselectAll():(a.unselectAll(),e.setSelected(!e.selected))),t&&n&&t.setValue(e.parent)}}else Ra.warning("You can't use ".concat(e.value," more than ").concat(e.maxUsages," time(s)"))},setVisible(t){e.visible=t},setSelected(t){e.selected=t},onHotKey:()=>e.toggleSelected(),_updateBackgroundColor(t){e.background===fr&&(e.background=Il.a.make_color({seed:t})[0])},afterCreate(){e._updateBackgroundColor(e._value||e.value)},updateValue(t){e._value=Ma(e.value,t.task.dataObj)||"",e._updateBackgroundColor(e._value)}}})),Ul=x.types.compose("LabelModel",Hl,Bl,Aa),Vl=Object(E.b)("store")(Object(E.c)((function(e){var t=e.item,n=e.store,a=t.background,r={borderLeftWidth:3,borderLeftColor:a,backgroundColor:t.selected?a:"#e8e8e8",color:t.selected?t.selectedcolor:"#333333",cursor:"pointer",margin:"5px"};return t.visible||(r.display="none"),t.selected&&(r.borderTopColor=a,r.borderBottomColor=a,r.borderRightColor=a),p.a.createElement(It.a,{onClick:function(e){return t.toggleSelected(),!1},style:r,size:t.size},t._value,!0===t.showalias&&t.alias&&p.a.createElement("span",{style:Xe.styleToProp(t.aliasstyle)},"\xa0",t.alias),(n.settings.enableTooltips||n.settings.enableLabelTooltips)&&n.settings.enableHotkeys&&t.hotkey&&p.a.createElement(at,null,"[",t.hotkey,"]"))})));C.addTag("label",Ul,Vl);var Fl=x.types.model({name:x.types.identifier,toname:x.types.maybeNull(x.types.string),choice:x.types.optional(x.types.enumeration(["single","multiple"]),"single"),maxusages:x.types.maybeNull(x.types.string),showinline:x.types.optional(x.types.boolean,!0),groupdepth:x.types.maybeNull(x.types.string)}),Wl=x.types.model({pid:x.types.optional(x.types.string,N),type:"labels",children:rl.unionArray(["label","header","view","hypertext"]),visible:x.types.optional(x.types.boolean,!0)}),Yl=Nl.views((function(e){return{get shouldBeUnselected(){return"single"===e.choice}}})).actions((function(e){return{validate(){var t,n=e.completion.regionStore.regions,a=Object(S.a)(n);try{for(a.s();!(t=a.n()).done;){var r,o=t.value,i=Object(S.a)(o.states);try{for(i.s();!(r=i.n()).done;){if(r.value.name===e.name)return!0}}catch(l){i.e(l)}finally{i.f()}}}catch(l){a.e(l)}finally{a.f()}return Ra.warning(e.requiredmessage||'Labels "'.concat(e.name,'" were not used.')),!1}}})),Xl=x.types.compose("LabelsModel",Wl,Fl,Yl,Ll,Tl.props({_child:"LabelModel"}),Ml),Gl=Object(E.c)((function(e){var t=e.item,n={marginTop:"1em",marginBottom:"1em",display:"flex",justifyContent:"flex-start",alignItems:"center",flexFlow:"wrap",marginLeft:"-5px"};return t.showinline||(n.flexDirection="column",n.alignItems="flex-start",n.marginTop="0"),t.visible||(n.display="none"),p.a.createElement("div",{style:n},P.renderChildren(t))}));C.addTag("labels",Xl,Gl);var Kl=x.types.model({name:x.types.identifier,toname:x.types.maybeNull(x.types.string)}),Jl=x.types.model({controlledTags:rl.unionTag(["Image"])}),ql=x.types.model("BrushLabelsModel",{type:"brushlabels",children:rl.unionArray(["label","header","view","hypertext"])}),Zl=x.types.compose("BrushLabelsModel",Xl,ql,Pl,Kl,Jl,Nl,Tl.props({_child:"LabelModel"}),Ml),$l=Object(E.c)((function(e){var t=e.item;return p.a.createElement(Gl,{item:t})}));C.addTag("brushlabels",Zl,$l);var Ql=x.types.model({perregion:x.types.optional(x.types.boolean,!1),whenlabelvalue:x.types.maybeNull(x.types.string)}).views((function(e){return{perRegionVisible(){if(!e.perregion)return!0;var t=e.completion.highlightedNode;return!!t&&(t.parent.name===e.toname&&(null===e.whenlabelvalue||void 0===e.whenlabelvalue||t.hasLabel(e.whenlabelvalue)))}}})).actions((function(e){return{}})),es=x.types.model({visiblewhen:x.types.maybeNull(x.types.string),whentagname:x.types.maybeNull(x.types.string),whenchoicevalue:x.types.maybeNull(x.types.string),whenlabelvalue:x.types.maybeNull(x.types.string)}).views((function(e){return{get isVisible(){if(e.visiblewhen){var t={"region-selected":function(t){var n,a=t.tagName,r=t.labelValue,o=e.completion.highlightedNode;return!(!o||a&&(null===(n=o.labeling)||void 0===n?void 0:n.from_name.name)!==a)&&(!r||r.split(",").some((function(e){return o.hasLabel(e)})))},"choice-selected":function(t){var n=t.tagName,a=t.choiceValue;if(!n){var r,o=Object(S.a)(e.completion.names.values());try{for(o.s();!(r=o.n()).done;){var i=r.value;if("choices"===i.type&&i.selectedValues&&i.selectedValues().length)return!0}}catch(s){o.e(s)}finally{o.f()}return!1}var l=e.completion.names.get(n);return!!l&&(a?a.split(",").map((function(e){return l.findLabel(e)})).some((function(e){return e&&e.selected})):l.isSelected)},"no-region-selected":function(t){t.tagName;return!e.completion.highlightedNode}};if(Object.keys(t).includes(e.visiblewhen))return!1!==t[e.visiblewhen]({tagName:e.whentagname,choiceValue:e.whenchoicevalue,labelValue:e.whenlabelvalue})}return!0}}})).actions((function(e){return{}})),ts=n(211),ns=x.types.model({selected:x.types.optional(x.types.boolean,!1),alias:x.types.maybeNull(x.types.string),value:x.types.maybeNull(x.types.string),hotkey:x.types.maybeNull(x.types.string),style:x.types.maybeNull(x.types.string)}),as=x.types.model({type:"choice",visible:x.types.optional(x.types.boolean,!0),_value:x.types.optional(x.types.string,""),children:rl.unionArray(["choice"])}).views((function(e){return{get isCheckbox(){var t=e.parent.choice;return"multiple"===t||"single"===t},get isSelect(){return console.log(e.parent.layout),"select"===e.parent.layout},get completion(){return Object(x.getRoot)(e).completionStore.selected},get parent(){return Object(x.getParentOfType)(e,us)},canBeUsed:()=>!0}})).actions((function(e){return{toggleSelected(){var t=e.parent;t.shouldBeUnselected&&t.resetSelected(),e.setSelected(!e.selected),t.updateResult()},setVisible(t){e.visible=t},setSelected(t){e.selected=t},onHotKey:()=>e.toggleSelected()}})),rs=x.types.compose("ChoiceModel",ns,as,Aa),os=function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){var e=this.props,t=e.item,n=e.store,a={};t.style&&(a=P.cssConverter(t.style)),t.visible||(a.display="none");var r=(n.settings.enableTooltips||n.settings.enableLabelTooltips)&&n.settings.enableHotkeys&&t.hotkey,o={checked:t.selected,disabled:t.parent.readonly,onChange:function(e){t.completion.editable&&(t.toggleSelected(),e.nativeEvent.target.blur())}};if(t.isCheckbox){var i=Object.assign({display:"flex",alignItems:"center",marginBottom:0},a);return p.a.createElement(lt.a.Item,{style:i},p.a.createElement(Nt.a,Object.assign({name:t._value},o),t._value,r&&p.a.createElement(at,null,"[",t.hotkey,"]")))}return p.a.createElement("div",{style:a},p.a.createElement(ts.a,Object.assign({value:t._value,style:{display:"inline-block",marginBottom:"0.5em"}},o),t._value,r&&p.a.createElement(at,null,"[",t.hotkey,"]")))}}]),n}(d.Component),is=Object(E.b)("store")(Object(E.c)(os));C.addTag("choice",rs,is);var ls=Pn.a.Option,ss=x.types.model({name:x.types.identifier,toname:x.types.maybeNull(x.types.string),showinline:x.types.maybeNull(x.types.boolean),choice:x.types.optional(x.types.enumeration(["single","single-radio","multiple"]),"single"),layout:x.types.optional(x.types.enumeration(["select","inline","vertical"]),"vertical")}),cs=x.types.model({pid:x.types.optional(x.types.string,N),readonly:x.types.optional(x.types.boolean,!1),visible:x.types.optional(x.types.boolean,!0),type:"choices",children:rl.unionArray(["choice","view","header","hypertext"])}).views((function(e){return{get shouldBeUnselected(){return"single"===e.choice||"single-radio"===e.choice},get completion(){return Object(x.getRoot)(e).completionStore.selected},states:()=>e.completion.toNames.get(e.name),get serializableValue(){var t=e.selectedValues();return t&&t.length?{choices:t}:null},get result(){if(e.perregion){var t=e.completion.highlightedNode;return t?e.completion.results.find((function(n){return n.from_name===e&&n.area===t})):null}return e.completion.results.find((function(t){return t.from_name===e}))}}})).actions((function(e){return{afterCreate(){!0===e.showinline&&(e.layout="inline"),!1===e.showinline&&(e.layout="vertical")},needsUpdate(){e.result?e.setResult(e.result.mainValue):e.setResult([])},requiredModal(){Ra.warning(e.requiredmessage||'Checkbox "'.concat(e.name,'" is required.'))},copyState(t){t.selectedValues().forEach((function(t){e.findLabel(t).setSelected(!0)}))},unselectAll(){},updateFromResult(t){e.setResult(Array.isArray(t)?t:[t])},resetSelected(){e.selectedLabels.forEach((function(e){return e.setSelected(!1)}))},setResult(t){e.tiedChildren.forEach((function(e){return e.setSelected(t.includes(e.alias||e._value))}))},updateResult(){if(e.result)e.result.area.setValue(e);else if(e.perregion){var t=e.completion.highlightedNode;if(!t)return null;t.setValue(e)}else e.completion.createResult({},{choices:e.selectedValues()},e,e.toname)},toStateJSON(){var t=e.selectedValues();if(t&&t.length){var n=e.toname||e.name;return{id:e.pid,from_name:e.name,to_name:n,type:e.type,value:{choices:t}}}},fromStateJSON(t,n){if(e.unselectAll(),!t.value.choices)throw new Error("No labels param");t.id&&(e.pid=t.id),e.readonly=t.readonly,t.value.choices.forEach((function(t){var n=e.findLabel(t);if(!n)throw new Error("No label "+t);n.setSelected(!0)}))}}})),us=x.types.compose("ChoicesModel",Ml,ss,Tl.props({_child:"ChoiceModel"}),Ll,Ql,es,cs),ds=Object(E.c)((function(e){var t=e.item,n=t.perRegionVisible()?{}:{display:"none"};return!1===t.isVisible&&(n.display="none"),p.a.createElement("div",{style:Object(u.a)(Object(u.a)({},{marginTop:"1em",marginBottom:"1em"}),n)},"select"===t.layout?p.a.createElement(Pn.a,{style:{width:"100%"},value:t.selectedLabels.map((function(e){return e._value})),mode:"multiple"===t.choice?"multiple":"",onChange:function(e,n){if(Array.isArray(e))t.resetSelected(),e.forEach((function(e){return t.findLabel(e).setSelected(!0)})),t.updateResult();else{var a=t.findLabel(e);a&&a.toggleSelected()}}},t.tiedChildren.map((function(e){return p.a.createElement(ls,{key:e._value,value:e._value},e._value)}))):p.a.createElement(lt.a,{layout:t.layout},P.renderChildren(t)))}));C.addTag("choices",us,ds);var ps=x.types.model({name:x.types.identifier,toname:x.types.maybeNull(x.types.string)}),ms=x.types.model({controlledTags:rl.unionTag(["HyperText"])}),gs=x.types.model("HyperTextLabelesModel",{type:"htmllabels",children:rl.unionArray(["label","header","view","hypertext"])}).views((function(e){return{get hasStates(){var t=e.states();return t&&t.length>0},get serializableValue(){var t={};return t[e.resultType]=e.selectedValues(),t},get resultType(){return"hypertextlabels"},get valueType(){return"htmllabels"}}})),hs=x.types.compose(Ml,Xl,gs,ps,ms,Nl,Tl.props({_child:"LabelModel"})),fs=x.types.compose("HyperTextLabelsModel",hs),ys=Object(E.c)((function(e){var t=e.item;return p.a.createElement(Gl,{item:t})}));C.addTag("hypertextlabels",fs,ys);var vs=x.types.model({name:x.types.identifier,toname:x.types.maybeNull(x.types.string),opacity:x.types.optional(Gr.range(),"0.9"),fillcolor:x.types.optional(Gr.color,"#8bad00"),strokecolor:x.types.optional(Gr.color,"#8bad00"),strokewidth:x.types.optional(x.types.string,"1")}),bs=x.types.model({type:"keypoint"}).views((function(e){return{get hasStates(){var t=e.states();return t&&t.length>0},get completion(){return rl.getParentOfTypeString(e,"Completion")}}})).actions((function(e){return{fromStateJSON(e){},afterCreate(){var t=vo.create();t._control=e,e.tools={keypoint:t}}}})),ws=x.types.compose("KeyPointModel",vs,bs,Ml);C.addTag("keypoint",ws,(function(){return null}));var xs=x.types.model({name:x.types.identifier,toname:x.types.maybeNull(x.types.string)}),Es=x.types.model({controlledTags:rl.unionTag(["Image"])}),Ss=x.types.model("KeyPointLabelesModel",{type:"keypointlabels",children:rl.unionArray(["label","header","view","hypertext"])}).views((function(e){return{get hasStates(){var t=e.states();return t&&t.length>0}}})),_s=x.types.compose(Xl,Ss,ws,xs,Es,Nl,Tl.props({_child:"LabelModel"}),Ml),ks=x.types.compose("KeyPointLabelsModel",_s),Os=Object(E.c)((function(e){var t=e.item;return p.a.createElement(Gl,{item:t})}));C.addTag("keypointlabels",ks,Os);var Cs=n(146),js=n.n(Cs),Rs=n(116),Ns=x.types.model({backgroundColor:x.types.optional(x.types.string,"transparent"),value:x.types.maybeNull(x.types.string),_value:x.types.maybeNull(x.types.string),selected:x.types.optional(x.types.boolean,!1),idx:x.types.number}).views((function(e){return{}})).actions((function(e){return{setBG(t){e.backgroundColor=t},setIdx(t){e.idx=t},setSelected(t){e.selected=t}}})),Ts=x.types.model({axis:x.types.optional(x.types.enumeration(["x","y"]),"y"),lockaxis:x.types.maybeNull(x.types.enumeration(["x","y"])),elementvalue:x.types.maybeNull(x.types.string),elementtag:x.types.optional(x.types.enumeration(["Text","Image","Audio"]),"Text"),sortedhighlightcolor:x.types.maybeNull(x.types.string),name:x.types.maybeNull(x.types.string),value:x.types.maybeNull(x.types.string)}),Ms=x.types.model({id:x.types.optional(x.types.identifier,N),type:"list",update:x.types.optional(x.types.number,1),regions:x.types.array(Ns)}).views((function(e){return{}})).actions((function(e){return{setUpdate(){e.update=e.update+1},addRegion(t,n){var a=Ns.create({value:e.elementvalue,idx:n,_value:Ta(e.elementvalue,t[n])});e.regions.push(a)},updateValue(t){var n=Ta(e.value,t.task.dataObj);e.regions=[],n.forEach((function(t,a){return e.addRegion(n,a)})),n.forEach((function(e,t){e._orig_idx=t})),e._value=n,e.setUpdate()},moveItems(t){var n=t.oldIndex,a=t.newIndex;n!==a&&(e.sortedhighlightcolor&&e.regions[n].setBG(e.sortedhighlightcolor),e.regions[n].setSelected(!0),e._value&&(e._value=js()(e._value,n,a)),e.regions=js()(e.regions,n,a),e.setUpdate())},toStateJSON(){var t={};e._value.forEach((function(n,a){t[e.regions[a].idx]=1/(1+a)}));for(var n=Object.keys(t).sort((function(e,t){return e-t})).map((function(e){return t[e]})),a=[],r=0;r<Object.keys(t).length;r++)a[e.regions[r].idx]=e.regions[r].selected?1:0;return{from_name:e.name,to_name:e.name,value:{weights:n,selected:a}}},fromStateJSON(t,n){var a=[],r=[],o={};t.value.weights.forEach((function(e,t){o[e]?o[e].push(t):o[e]=[t]})),Object.keys(o).sort((function(e,t){return t-e})).forEach((function(t){o[t].forEach((function(t){r.push(e.regions[t]),a.push(e._value[t])}))})),r.forEach((function(e,t){return e.setIdx(t)})),e._value=a,e.regions=r,e.setUpdate()}}})),As=x.types.compose("ListModel",Ts,Ms),zs=Object(Rs.c)((function(){return p.a.createElement("div",{className:"drag-handle"})}));function Ps(){try{return"undefined"!==typeof window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")}catch(e){return!1}}var Ls=Object(Rs.b)((function(e){var t,n=e.item,a=e.value;Ps&&(t="noselect");var r={text:function(e){return p.a.createElement("span",{className:t},e._value)},image:function(e){return p.a.createElement("img",{src:e._value,alt:""})},audio:function(e){return p.a.createElement("audio",{src:e._value})}};return p.a.createElement("div",{style:{padding:"1em",userSelect:"none",display:"flex",alignItems:"center",background:a.selected?n.sortedhighlightcolor:"transparent"},className:t,onClick:function(e){return a.selected?(a.setSelected(!1),n.setUpdate()):(a.setSelected(!0),n.setUpdate()),e.preventDefault(),!1}},p.a.createElement(zs,null),r[n.elementtag.toLowerCase()](a))})),Ds=Object(Rs.a)((function(e){var t=e.item,n=e.items;return p.a.createElement(B.b,{celled:!0},n.map((function(e,n){return p.a.createElement(Ls,{key:"item-".concat(n),index:n,value:e,color:e.backgroundColor,item:t,onClick:function(e){}})})))})),Is=Object(E.b)("store")(Object(E.c)((function(e){e.store;var t=e.item,n={};return Ps()?n.pressDelay=100:n.distance=7,p.a.createElement("div",null,p.a.createElement(Ds,Object.assign({update:t.update,item:t,items:t.regions,onSortEnd:t.moveItems},n)))})));C.addTag("list",As,Is);var Hs=x.types.model({name:x.types.identifier,toname:x.types.maybeNull(x.types.string),selectionstyle:x.types.maybeNull(x.types.string),leftclass:x.types.maybeNull(x.types.string),rightclass:x.types.maybeNull(x.types.string)}),Bs=x.types.model({type:"pairwise",selected:x.types.maybeNull(x.types.enumeration(["left","right","none"]))}).views((function(e){return{get completion(){return Object(x.getRoot)(e).completionStore.selected},get names(){return e.toname.split(",")},get left(){return e.completion.names.get(e.names[0])},get right(){return e.completion.names.get(e.names[1])},get valueType(){return"selected"},get result(){return e.completion.results.find((function(t){return t.from_name===e}))}}})).actions((function(e){return{updateResult(){var t=e.result,n=e.selected;"none"===n?t&&t.area.removeResult(t):t?t.setValue(n):e.completion.createResult({},{selected:n},e,e.name)},setResult(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"none";e.selected=t,e.left.addProp("style","left"===t?e._selection:{}),e.right.addProp("style","right"===t?e._selection:{})},selectLeft(){e.setResult("left"===e.selected?"none":"left"),e.updateResult()},selectRight(){e.setResult("right"===e.selected?"none":"right"),e.updateResult()},afterCreate(){2===e.names.length&&e.names[0]!==e.names[1]||Ra.error("Incorrect toName parameter on Pairwise, should be two names separated by the comma: name1,name2");var t={};if(e.selectionstyle){var n=P.cssConverter(e.selectionstyle);for(var a in n)t[a]=n[a]}else t={backgroundColor:"#f6ffed",border:"1px solid #b7eb8f"};e._selection=t},needsUpdate(){e.result?e.setResult(e.result.value.selected):e.setResult()},completionAttached(){setTimeout((function(){var t;e.left.addProp("onClick",e.selectLeft),e.right.addProp("onClick",e.selectRight),e.setResult(null===(t=e.result)||void 0===t?void 0:t.value.selected)}))}}})),Us=x.types.compose("PairwiseModel",Hs,Ml,Bs);C.addTag("pairwise",Us,(function(){return null})),C.addObjectType(Us);var Vs=x.types.model({name:x.types.identifier,toname:x.types.maybeNull(x.types.string),opacity:x.types.optional(Gr.range(),"0.6"),fillcolor:x.types.optional(Gr.color,"#f48a42"),strokewidth:x.types.optional(x.types.string,"3"),strokecolor:x.types.optional(Gr.color,"#f48a42"),pointsize:x.types.optional(x.types.string,"small"),pointstyle:x.types.optional(x.types.string,"circle")}),Fs=x.types.model({controlledTags:rl.unionTag(["Image"])}),Ws=x.types.model({type:"polygon",_value:x.types.optional(x.types.string,"")}).views((function(e){return{get completion(){return Object(x.getRoot)(e).completionStore.selected}}})).actions((function(e){return{fromStateJSON(){},afterCreate(){var t=wo.create(),n=di.create();t._control=e,n._control=e,e.tools={poly:t}}}})),Ys=x.types.compose("PolygonModel",Ml,Vs,Fs,Ws);C.addTag("polygon",Ys,(function(){return null}));var Xs=x.types.model({name:x.types.identifier,toname:x.types.maybeNull(x.types.string)}),Gs=x.types.model({controlledTags:rl.unionTag(["Image"])}),Ks=x.types.model("PolygonLabelsModel",{type:"polygonlabels",children:rl.unionArray(["label","header","view","hypertext"])}),Js=x.types.compose(Xl,Ks,Ys,Xs,Gs,Nl,Tl.props({_child:"LabelModel"}),Ml),qs=x.types.compose("PolygonLabelsModel",Js),Zs=Object(E.c)((function(e){var t=e.item;return p.a.createElement(Gl,{item:t})}));C.addTag("polygonlabels",qs,Zs);var $s=x.types.model({backgroundColor:x.types.optional(x.types.string,"transparent"),value:x.types.maybeNull(x.types.string),_value:x.types.maybeNull(x.types.string),selected:x.types.optional(x.types.boolean,!1),idx:x.types.number}).views((function(e){return{}})).actions((function(e){return{setBG(t){e.backgroundColor=t},setIdx(t){e.idx=t},setSelected(t){e.selected=t}}})),Qs=x.types.model({axis:x.types.optional(x.types.enumeration(["x","y"]),"y"),lockaxis:x.types.maybeNull(x.types.enumeration(["x","y"])),elementtag:x.types.optional(x.types.string,"Text"),ranked:x.types.optional(x.types.boolean,!0),sortable:x.types.optional(x.types.boolean,!0),sortedhighlightcolor:x.types.maybeNull(x.types.string),name:x.types.maybeNull(x.types.string),value:x.types.maybeNull(x.types.string)}),ec=x.types.model({id:x.types.optional(x.types.identifier,N),type:"ranker",update:x.types.optional(x.types.number,1),regions:x.types.array($s)}).views((function(e){return{}})).actions((function(e){return{setUpdate(){e.update=e.update+1},_addRegion(t,n){var a=$s.create({value:t,idx:n,_value:t});e.regions.push(a)},moveItems(t){var n=t.oldIndex,a=t.newIndex;n!==a&&(e.sortedhighlightcolor&&e.regions[n].setBG(e.sortedhighlightcolor),e.regions[n].setSelected(!0),e._value&&(e._value=js()(e._value,n,a)),e.regions=js()(e.regions,n,a),e.setUpdate())},toStateJSON:()=>({from_name:e.name,to_name:e.name,value:{items:e.regions.map((function(e){return e.value})),selected:e.regions.map((function(e){return e.selected}))}}),fromStateJSON(t,n){t.value.items.forEach((function(t,n){e._addRegion(t,n)})),e.setUpdate()}}})),tc=x.types.compose("RankerModel",Qs,ec),nc=Object(Rs.c)((function(){return p.a.createElement("div",{className:"drag-handle"})}));function ac(){try{return"undefined"!==typeof window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")}catch(e){return!1}}var rc=Object(Rs.b)((function(e){var t,n=e.item,a=e.value;ac&&(t="noselect");var r={text:function(e){return p.a.createElement("span",{className:t},e._value)},image:function(e){return p.a.createElement("img",{src:e._value,alt:""})},audio:function(e){return p.a.createElement("audio",{src:e._value})}};return p.a.createElement("div",{style:{padding:"1em",userSelect:"none",display:"flex",alignItems:"center",background:a.selected?n.sortedhighlightcolor:"transparent"},className:t,onClick:function(e){return a.selected?(a.setSelected(!1),n.setUpdate()):(a.setSelected(!0),n.setUpdate()),e.preventDefault(),!1}},p.a.createElement(nc,null),r[n.elementtag.toLowerCase()](a))})),oc=Object(Rs.a)((function(e){var t=e.item,n=e.items;return p.a.createElement(B.b,{celled:!0},n.map((function(e,n){return p.a.createElement(rc,{key:"item-".concat(n),index:n,value:e,color:e.backgroundColor,item:t,onClick:function(e){}})})))})),ic=Object(E.b)("store")(Object(E.c)((function(e){e.store;var t=e.item,n={};return ac()?n.pressDelay=100:n.distance=7,p.a.createElement("div",null,p.a.createElement(oc,Object.assign({update:t.update,item:t,items:t.regions,onSortEnd:t.moveItems},n)))})));C.addTag("ranker",tc,ic);var lc=n(665),sc=x.types.model({name:x.types.identifier,toname:x.types.maybeNull(x.types.string),maxrating:x.types.optional(x.types.string,"5"),icon:x.types.optional(x.types.string,"star"),size:x.types.optional(x.types.string,"medium"),defaultvalue:x.types.optional(x.types.string,"0"),hotkey:x.types.maybeNull(x.types.string)}),cc=x.types.model({pid:x.types.optional(x.types.string,N),type:"rating",rating:x.types.maybeNull(x.types.number)}).views((function(e){return{get completion(){return Object(x.getRoot)(e).completionStore.selected},selectedValues:()=>e.rating,get serializableValue(){var t=e.selectedValues();return t?{rating:t}:null},get holdsState(){return e.rating>0},get result(){if(e.perregion){var t=e.completion.highlightedNode;return t?e.completion.results.find((function(n){return n.from_name===e&&n.area===t})):null}return e.completion.results.find((function(t){return t.from_name===e}))}}})).actions((function(e){return{getSelectedString:()=>e.rating+" star",copyState(t){e.setRating(t.rating)},needsUpdate(){e.result?e.rating=e.result.mainValue:e.rating=null},unselectAll(){},setRating(t){if(e.rating=t,e.result)e.result.area.setValue(e);else if(e.perregion){var n=e.completion.highlightedNode;if(!n)return null;n.setValue(e)}else e.completion.createResult({},{rating:t},e,e.toname)},updateFromResult(t){e.rating=t},requiredModal(){Ra.warning(e.requiredmessage||'Rating "'.concat(e.name,'" is required.'))},increaseValue(){e.rating>=Number(e.maxrating)?e.setRating(0):e.rating>0?e.setRating(e.rating+1):e.setRating(1)},onHotKey:()=>e.increaseValue(),toStateJSON(){if(e.rating){var t=e.toname||e.name;return{id:e.pid,from_name:e.name,to_name:t,type:e.type,value:{rating:e.rating}}}},fromStateJSON(t,n){t.id&&(e.pid=t.id),e.rating=t.value.rating}}})),uc=x.types.compose("RatingModel",Ml,sc,cc,Ll,Ql),dc=Object(E.b)("store")(Object(E.c)((function(e){var t,n=e.item,a=e.store;"small"===n.size?t=15:"medium"===n.size?t=25:"large"===n.size&&(t=40);var r=n.perRegionVisible()?{}:{display:"none"};return p.a.createElement("div",{style:r},p.a.createElement(lc.a,{character:p.a.createElement(V.a,{style:{fontSize:t}}),value:n.rating,count:Number(n.maxrating),defaultValue:Number(n.defaultvalue),onChange:n.setRating}),a.settings.enableTooltips&&a.settings.enableHotkeys&&n.hotkey&&p.a.createElement("sup",{style:{fontSize:"9px"}},"[",n.hotkey,"]"))})));C.addTag("rating",uc,dc);var pc=x.types.model({name:x.types.identifier,toname:x.types.maybeNull(x.types.string),opacity:x.types.optional(Gr.range(),"0.6"),fillcolor:x.types.optional(Gr.color,"#f48a42"),strokewidth:x.types.optional(x.types.string,"1"),strokecolor:x.types.optional(Gr.color,"#f48a42"),fillopacity:x.types.optional(Gr.range(),"0.6"),canrotate:x.types.optional(x.types.boolean,!0)}),mc=x.types.model({type:"rectangle"}).views((function(e){return{get completion(){return Object(x.getRoot)(e).completionStore.selected}}})).actions((function(e){return{fromStateJSON(){},afterCreate(){var t=So.create({activeShape:null});t._control=e,e.tools={rect:t}}}})),gc=x.types.compose("RectangleModel",Ml,pc,mc);C.addTag("rectangle",gc,(function(){return null}));var hc=x.types.model({name:x.types.identifier,toname:x.types.maybeNull(x.types.string)}),fc=x.types.model({controlledTags:rl.unionTag(["Image"])}),yc=x.types.model("RectangleLabelsModel",{pid:x.types.optional(x.types.string,N),type:"rectanglelabels",children:rl.unionArray(["label","header","view","hypertext"])}),vc=x.types.compose(Xl,yc,gc,hc,fc,Nl,Tl.props({_child:"LabelModel"}),Ml),bc=x.types.compose("RectangleLabelsModel",vc),wc=Object(E.c)((function(e){var t=e.item;return p.a.createElement(Gl,{item:t})}));C.addTag("rectanglelabels",bc,wc);var xc=x.types.model({value:x.types.maybeNull(x.types.string),alias:x.types.maybeNull(x.types.string),hotkey:x.types.maybeNull(x.types.string)}),Ec=x.types.model({id:x.types.optional(x.types.identifier,N),type:"shortcut",_value:x.types.optional(x.types.string,"")}).views((function(e){return{get hotkeyScope(){return Object(x.getParent)(Object(x.getParent)(e)).name}}})).actions((function(e){return{onClick(){var t=Object(x.getParent)(Object(x.getParent)(e));t.onShortcut&&t.onShortcut(e.value)},onHotKey:()=>e.onClick()}})),Sc=x.types.compose("ShortcutModel",xc,Ec,Aa),_c=Object(E.b)("store")(Object(E.c)((function(e){var t=e.item,n=e.store,a={backgroundColor:t.selected?t.background:"#e8e8e8",color:t.selected?t.selectedcolor:"#333333",cursor:"pointer",margin:"5px"};return p.a.createElement(It.a,{onClick:function(e){return t.onClick(),!1},style:a},t.alias?t.alias:t._value,n.settings.enableTooltips&&n.settings.enableHotkeys&&t.hotkey&&p.a.createElement(at,null,"[",t.hotkey,"]"))})));C.addTag("shortcut",Sc,_c);var kc=n(350),Oc=n.n(kc),Cc=(n(653),x.types.model({name:x.types.identifier,toname:x.types.maybeNull(x.types.string)})),jc=x.types.model({pid:x.types.optional(x.types.string,N),readonly:x.types.optional(x.types.boolean,!1),type:"taxonomy",children:rl.unionArray(["choice"])}).views((function(e){return{get completion(){return Object(x.getRoot)(e).completionStore.selected},get holdsState(){return!0},get valueType(){return"taxonomy"},get result(){if(e.perregion){var t=e.completion.highlightedNode;return t?e.completion.results.find((function(n){return n.from_name===e&&n.area===t})):null}return e.completion.results.find((function(t){return t.from_name===e}))}}})).actions((function(e){var t=[];return{needsUpdate(){t=e.result?e.result.mainValue:[]},selectedValues:()=>t,onChange(n,a){if(t=a.map((function(e){return e.path})),e.result)e.result.area.setValue(e);else if(e.perregion){var r=e.completion.highlightedNode;if(!r)return null;r.setValue(e)}else e.completion.createResult({},{taxonomy:t},e,e.toname)},traverse(e){var n=function e(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=n.value,o=[].concat(Object(qn.a)(a),[r]),i={label:r,path:o,checked:t.some((function(e){return e.length&&e[e.length-1]===r}))||void 0};return n.children&&(i.children=n.children.map((function(t){return e(t,o)}))),i};return Array.isArray(e)?e.map((function(e){return n(e)})):n(e)}}})),Rc=x.types.compose("TaxonomyModel",Ml,Cc,jc,es),Nc=Object(E.c)((function(e){var t=e.item;return p.a.createElement("div",{style:Object(u.a)({},{marginTop:"1em",marginBottom:"1em"})},p.a.createElement(Oc.a,{data:t.traverse(t.children),onChange:t.onChange,showPartiallySelected:!0}))}));C.addTag("taxonomy",Rc,Nc);var Tc=n(148),Mc=n.n(Tc),Ac=n(719),zc=n(720),Pc=n(169),Lc=n.n(Pc),Dc=jn.a.Paragraph,Ic=function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(){var e;Object(h.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={editing:!1,height:0,value:e.props.text},e.textRef=p.a.createRef(),e.inputRef=p.a.createRef(),e.startEditing=function(){var t,n,a,r=(null===(t=e.textRef.current)||void 0===t?void 0:t.parentNode.offsetHeight)||0;e.setState({editing:!0,height:r}),null===(n=(a=e.props).onStartEditing)||void 0===n||n.call(a),setTimeout(e.focus)},e.focus=function(){var t=e.inputRef.current;t&&(t.selectionStart=e.state.value.length)},e.setEditing=function(t){e.setState({editing:t})},e.setValue=function(t){e.setState({value:t})},e.cancel=function(){e.setValue(e.props.text),e.setEditing(!1)},e.save=function(){e.props.onChange(e.state.value),e.setEditing(!1)},e.updateHeight=Ha()((function(){var t,n=((null===(t=e.inputRef.current)||void 0===t?void 0:t.scrollHeight)||0)+2;n&&n!==e.state.height&&e.setState({height:n})}),100),e}return Object(f.a)(n,[{key:"renderEdit",value:function(){var e=this,t=this.props,n=t.className,a=void 0===n?"":n,r=(t.onChange,t.onDelete,t.text,t.rows),o=void 0===r?1:r,i=Object(hn.a)(t,["className","onChange","onDelete","text","rows"]),l=this.state,s=l.height,c=l.value,u={className:"ant-input "+Lc.a.input,style:s?{height:s}:null,autoFocus:!0,ref:this.inputRef,value:c,onBlur:this.save,onChange:function(t){e.setValue(t.target.value),e.updateHeight()},onKeyDown:function(t){var n=t.key,a=t.shiftKey;"Enter"===n?(1===+o||a)&&(t.preventDefault(),t.stopPropagation(),e.save()):"Escape"===n&&e.cancel()}};return p.a.createElement(Dc,Object.assign({},i,{className:a+" ant-typography-edit-content "+Lc.a.editing}),o>1?p.a.createElement("textarea",u):p.a.createElement("input",u),p.a.createElement(L.a,{title:"Save: [shift+enter]"},p.a.createElement(Ac.a,{className:"ant-typography-edit-content-confirm "+Lc.a.enter,onClick:this.save})))}},{key:"renderView",value:function(){var e=this.props,t=e.onChange,n=e.onDelete,a=e.text,r=Object(hn.a)(e,["onChange","onDelete","text"]);return p.a.createElement(p.a.Fragment,null,p.a.createElement(Dc,r,p.a.createElement("span",{ref:this.textRef},a),t&&p.a.createElement(zc.a,{onClick:this.startEditing,className:"ant-typography-edit"})),n&&p.a.createElement(F.a,{className:Lc.a.delete,onClick:n}))}},{key:"render",value:function(){return this.state.editing?this.renderEdit():this.renderView()}}]),n}(p.a.Component),Hc=(jn.a.Paragraph,x.types.model("TextAreaRegionModel",{id:x.types.optional(x.types.identifier,N),pid:x.types.optional(x.types.string,N),type:"textarearegion",_value:x.types.string}).views((function(e){return{get parent(){return Object(x.getParentOfType)(e,Yc)},get regionElement(){return document.querySelector("#TextAreaRegion-".concat(e.id))}}})).actions((function(e){return{setValue(t){e._value=t,e.parent.onChange()}}}))),Bc=x.types.compose("TextAreaRegionModel",dr,Ar,Mr,Hc),Uc=Object(E.c)((function(e){var t=e.item,n=[Mc.a.mark],a={},r=t.parent,o=t.completion.relationMode;o&&n.push(Mc.a.relation),t.selected?n.push(Mc.a.selected):t.highlighted&&n.push(Mc.a.highlighted),r.editable&&(a.onChange=function(e){t.setValue(e)});var i={};return r.perregion?a.onDelete=function(){return t.parent.remove(t)}:i={onMouseOver:function(){o&&t.setHighlight(!0)},onMouseOut:function(){o&&t.setHighlight(!1)}},p.a.createElement("div",Object.assign({},i,{className:Mc.a.row,"data-testid":"textarea-region"}),p.a.createElement(Ic,Object.assign({id:"TextAreaRegion-".concat(t.id),className:n.join(" "),rows:r.rows,text:t._value},a)))}));C.addTag("textarearegion",Bc,Uc);var Vc=st.a.TextArea,Fc=x.types.model({name:x.types.identifier,toname:x.types.maybeNull(x.types.string),allowsubmit:x.types.optional(x.types.boolean,!0),label:x.types.optional(x.types.string,""),value:x.types.maybeNull(x.types.string),rows:x.types.optional(x.types.string,"1"),showsubmitbutton:x.types.optional(x.types.boolean,!1),placeholder:x.types.maybeNull(x.types.string),maxsubmissions:x.types.maybeNull(x.types.string),editable:x.types.optional(x.types.boolean,!1)}),Wc=x.types.model({type:"textarea",regions:x.types.array(Bc),_value:x.types.optional(x.types.string,""),children:rl.unionArray(["shortcut"])}).views((function(e){return{get valueType(){return"text"},get holdsState(){return e.regions.length>0},get submissionsNum(){return e.regions.length},get completion(){return Object(x.getRoot)(e).completionStore.selected},get showSubmit(){if(e.maxsubmissions){var t=parseInt(e.maxsubmissions);return e.submissionsNum<t}return!0},get serializableValue(){return e.regions.length?{text:e.selectedValues()}:null},selectedValues:()=>e.regions.map((function(e){return e._value})),get result(){if(e.perregion){var t=e.completion.highlightedNode;return t?e.completion.results.find((function(n){return n.from_name===e&&n.area===t})):null}return e.completion.results.find((function(t){return t.from_name===e}))}}})).actions((function(e){return{getSerializableValue(){var t=e.regions.map((function(e){return e._value}));if(0!==t.length)return{text:t}},needsUpdate(){var t;e.updateFromResult(null===(t=e.result)||void 0===t?void 0:t.mainValue)},requiredModal(){Ra.warning(e.requiredmessage||'Input for the textarea "'.concat(e.name,'" is required.'))},setResult(t){(Array.isArray(t)?t:[t]).forEach((function(t){return e.createRegion(t)}))},updateFromResult(t){e.regions=[],t&&e.setResult(t)},setValue(t){e._value=t},remove(t){var n=e.regions.indexOf(t);n<0||(e.regions.splice(n,1),Object(x.destroy)(t),e.onChange())},copyState(t){e.regions=t.regions.map((function(e){return T(e)}))},perRegionCleanup(){e.regions=[]},createRegion(t,n){var a=Bc.create({pid:n,_value:t});return e.regions.push(a),a},onChange(){if(e.result)e.result.area.setValue(e);else if(e.perregion){var t=e.completion.highlightedNode;if(!t)return null;t.setValue(e)}else e.completion.createResult({},{text:e.selectedValues()},e,e.toname)},addText(t,n){e.createRegion(t,n),e.onChange()},beforeSend(){e._value&&e._value.length&&(e.addText(e._value),e._value="")},submitChanges(){e.beforeSend()},deleteText(e){Object(x.destroy)(e)},onShortcut(t){e.setValue(e._value+t)},toStateJSON(){if(e.regions.length){var t=e.toname||e.name;return{id:e.pid,from_name:e.name,to_name:t,type:"textarea",value:{text:e.regions.map((function(e){return e._value}))}}}},fromStateJSON(t,n){var a=t.value.text;Array.isArray(a)||(a=[a]),a.forEach((function(n){return e.addText(n,t.id)}))}}})),Yc=x.types.compose("TextAreaModel",Ml,Fc,Wc,Aa,Ll,Ql),Xc=Object(E.c)((function(e){var t=e.item,n=parseInt(t.rows),a={name:t.name,value:t._value,rows:t.rows,className:"is-search",label:t.label,placeholder:t.placeholder,onChange:function(e){var n=e.target.value;t.setValue(n)}};n>1&&(a.onKeyDown=function(e){"Enter"===e.key&&e.shiftKey&&t.allowsubmit&&t._value&&(e.preventDefault(),e.stopPropagation(),t.addText(t._value),t.setValue(""))}),t.completion.editable||(a.disabled=!0);var r=t.perRegionVisible()?{}:{display:"none"},o=t.completion.editable&&1!==n||t.showSubmitButton,i={};return o&&(i.marginBottom=0),r.marginTop="4px",p.a.createElement("div",{style:r},P.renderChildren(t),t.showSubmit&&p.a.createElement(lt.a,{onFinish:function(e){return t.allowsubmit&&t._value&&(t.addText(t._value),t.setValue("")),!1}},p.a.createElement(lt.a.Item,{style:i},1===n?p.a.createElement(st.a,a):p.a.createElement(Vc,a),o&&p.a.createElement(lt.a.Item,null,p.a.createElement(D.a,{style:{marginTop:"10px"},type:"primary",htmlType:"submit"},"Add")))),t.regions.length>0&&p.a.createElement("div",{style:{marginBottom:"1em"}},t.regions.map((function(e){return p.a.createElement(Uc,{key:e.id,item:e})}))))}));C.addTag("textarea",Yc,Xc);var Gc=x.types.model({name:x.types.identifier,toname:x.types.maybeNull(x.types.string),opacity:x.types.optional(x.types.string,"0.9"),fillcolor:x.types.maybeNull(x.types.string),strokeWidth:x.types.optional(x.types.number,1),strokeColor:x.types.optional(x.types.string,"#f48a42")}),Kc=x.types.model("TimeSeriesLabelesModel",{pid:x.types.optional(x.types.string,N),type:"timeserieslabels",children:rl.unionArray(["labels","label","choice"])}).views((function(e){return{get hasStates(){var t=e.states();return t&&t.length>0},states:()=>e.completion.toNames.get(e.name),activeStates(){var t=e.states();return t?t.filter((function(e){return!0===e.isSelected})):null}}})),Jc=Nl.props({_type:"timeserieslabels"}).views((function(e){return{get shouldBeUnselected(){return"single"===e.choice}}})),qc=x.types.compose(Xl,Kc,Gc,Jc,Ll,Tl.props({_child:"LabelModel"}),Ml),Zc=x.types.compose("TimeSeriesLabelsModel",qc),$c=Object(E.c)((function(e){var t=e.item;return p.a.createElement(Gl,{item:t})}));C.addTag("timeserieslabels",Zc,$c);var Qc=x.types.model({name:x.types.identifier,toname:x.types.maybeNull(x.types.string),opacity:x.types.optional(Gr.range(),"0.6"),fillcolor:x.types.optional(Gr.color,"#f48a42"),strokewidth:x.types.optional(x.types.string,"1"),strokecolor:x.types.optional(Gr.color,"#f48a42"),fillopacity:x.types.optional(Gr.range(),"0.6"),canrotate:x.types.optional(x.types.boolean,!0)}),eu=x.types.model({type:"ellipse"}).views((function(e){return{get hasStates(){var t=e.states();return t&&t.length>0},get completion(){return Object(x.getRoot)(e).completionStore.selected}}})).actions((function(e){return{afterCreate(){var t=ko.create({activeShape:null});t._control=e,e.tools={ellipse:t}}}})),tu=x.types.compose("EllipseModel",Qc,eu,Ml);C.addTag("ellipse",tu,(function(){return null}));var nu=x.types.model({name:x.types.identifier,toname:x.types.maybeNull(x.types.string)}),au=x.types.model("EllipseLabelsModel",{type:"ellipselabels",children:rl.unionArray(["label","header","view","hypertext"])}),ru=x.types.compose(Xl,au,tu,nu,Nl,Tl.props({_child:"LabelModel"}),Ml),ou=x.types.compose("EllipseLabelsModel",ru),iu=Object(E.c)((function(e){var t=e.item;return p.a.createElement(Gl,{item:t})}));C.addTag("ellipselabels",ou,iu);var lu=x.types.model({choice:x.types.optional(x.types.enumeration(["single","multiple"]),"multiple")}),su=x.types.model({id:x.types.optional(x.types.identifier,N),pid:x.types.optional(x.types.string,N),type:"relations",children:rl.unionArray(["relations","relation"])}).views((function(e){return{getSelected:()=>e.children.filter((function(e){return!0===e.selected})),selectedValues:()=>e.getSelected().map((function(e){return e.value})),findRelation:t=>e.children.find((function(e){return e.value===t}))}})).actions((function(e){return{unselectAll(){e.children.map((function(e){return e.setSelected(!1)}))}}})),cu=x.types.compose("RelationsModel",su,lu,Ml);C.addTag("relations",cu,(function(){return null}));var uu=x.types.model({value:x.types.maybeNull(x.types.string),background:x.types.optional(Gr.color,yr)}),du=x.types.model({id:x.types.optional(x.types.identifier,N),selected:x.types.optional(x.types.boolean,!1),type:"relation"}).actions((function(e){return{setSelected(t){e.selected=t}}})),pu=x.types.compose("RelationModel",uu,du);C.addTag("relation",pu,(function(){return null}));var mu=n(104),gu=n(131),hu=n.n(gu),fu=function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"render",value:function(){var e,t,n,a="".concat(hu.a.block);return this.props.hint&&(e=p.a.createElement(It.a,{color:"blue"},this.props.hint)),this.props.bg&&(t=this.props.bg),this.props.selected&&(a="".concat(a," ").concat(hu.a.block_selected),e=p.a.createElement("div",null,p.a.createElement(It.a,{color:"magenta"},"Selected Message")),this.props.hint&&(e=p.a.createElement("div",{className:hu.a.tag},p.a.createElement(It.a,{color:"magenta"},this.props.hint)))),this.props.date&&(n=p.a.createElement("span",{className:hu.a.date},this.props.date)),p.a.createElement("div",{className:a,style:{background:t,width:"max-content",maxWidth:"100%"}},p.a.createElement("span",{className:hu.a.name},this.props.name,":\xa0"),p.a.createElement("p",{className:hu.a.text},this.props.text),n,e)}}]),n}(p.a.Component),yu=x.types.model({name:x.types.string,text:x.types.string,selected:x.types.optional(x.types.boolean,!1),date:x.types.optional(x.types.string,""),hint:x.types.optional(x.types.string,"")}),vu=x.types.model({value:x.types.maybeNull(x.types.string),name:x.types.maybeNull(x.types.string)});var bu=x.types.model({id:x.types.optional(x.types.identifier,N),type:"Dialog",data:x.types.map(yu)}).views((function(e){return{get completion(){return Object(x.getRoot)(e).completionStore.selected}}})).actions((function(e){return function(e){return{fromStateJSON(t){t.value.choices&&e.completion.names.get(t.from_name).fromStateJSON(t),t.value.text&&e.completion.names.get(t.from_name).fromStateJSON(t)}}}(e)})),wu=x.types.compose("DialogModel",vu,bu),xu=Object(E.b)("store")(Object(E.c)((function(e){var t=e.store,n=e.item;if(!t.task||!t.task.dataObj)return p.a.createElement(mu.a,null);var a=[],r=n.value;return"$"===r.charAt(0)&&(r=r.substr(1)),t.task.dataObj[r].forEach((function(e,t){var n;e.name&&(n=le(se(e.name),.1)),a.push(p.a.createElement(fu,{key:t,name:e.name,hint:e.hint,text:e.text,selected:e.selected,date:e.date,id:e.id,bg:n}))})),p.a.createElement("div",null,p.a.createElement("div",{style:{display:"flex",flexFlow:"column",maxHeight:"500px",overflowY:"scroll",paddingRight:"10px",marginTop:"10px"}},a),p.a.createElement(Ut.a,{dashed:!0}))})));C.addTag("dialog",wu,xu);var Eu=x.types.model({type:"header",size:x.types.optional(x.types.string,"4"),style:x.types.maybeNull(x.types.string),_value:x.types.optional(x.types.string,""),value:x.types.optional(x.types.string,""),underline:x.types.optional(x.types.boolean,!1)}),Su=x.types.compose("HeaderModel",Eu,Aa),_u=Object(E.c)((function(e){var t=e.item,n=parseInt(t.size),a=t.style?P.cssConverter(t.style):{margin:"10px 0"};return!a.fontSize&&n>4&&(a.fontSize=5===n?"1.2em":"1.1em"),p.a.createElement(jn.a.Title,{underline:t.underline,level:n,style:a},t._value)}));C.addTag("header",Su,_u);var ku=x.types.model({type:"table",value:x.types.maybeNull(x.types.string)}).views((function(e){return{get _value(){if(e.value){var t=Object(x.getRoot)(e),n=e.value.substr(1);return t.task.dataObj[n]}}}})),Ou=x.types.compose("TableModel",ku),Cu=Object(E.b)("store")(Object(E.c)((function(e){var t=e.store,n=e.item,a=n._value;a||t.task&&(a=t.task.dataObj);console.log(n._value),console.log(Object.keys(a));var r=Object.keys(a).map((function(e){var t=a[e];return"object"===typeof t&&(t=JSON.stringify(t)),{type:e,value:t}}));return p.a.createElement(Ct.a,{bordered:!0,dataSource:r,columns:[{title:"Name",dataIndex:"type"},{title:"Value",dataIndex:"value"}],pagination:{hideOnSinglePage:!0}})})));C.addTag("table",Ou,Cu);var ju=x.types.model({classname:x.types.optional(x.types.string,""),display:x.types.optional(x.types.string,"block"),style:x.types.maybeNull(x.types.string)}),Ru=x.types.model({id:x.types.identifier,type:"view",children:rl.unionArray(["view","header","labels","label","table","taxonomy","choices","choice","rating","ranker","rectangle","ellipse","polygon","keypoint","brush","rectanglelabels","ellipselabels","polygonlabels","keypointlabels","brushlabels","hypertextlabels","timeserieslabels","text","audio","image","hypertext","timeseries","audioplus","list","dialog","textarea","pairwise","style","label","relations","filter"])}).views((function(e){return{get completion(){return Object(x.getRoot)(e).completionStore.selected}}})),Nu=x.types.compose("ViewModel",ju,Ru,es),Tu=Object(E.c)((function(e){var t=e.item,n=(e.store,{});return"inline"===t.display&&(n={display:"inline-block",marginRight:"15px"}),t.style&&(n=P.cssConverter(t.style)),!1===t.isVisible&&(n.display="none"),p.a.createElement("div",{className:t.classname,style:n},P.renderChildren(t))}));C.addTag("view",Nu,Tu);var Mu=x.types.model({type:"style",value:x.types.optional(x.types.string,"")}),Au=x.types.compose("StyleModel",Mu),zu=Object(E.c)((function(e){var t=e.item;return p.a.createElement("style",{dangerouslySetInnerHTML:{__html:t.value}})}));C.addTag("style",Au,zu);var Pu=x.types.model({casesensetive:x.types.optional(x.types.boolean,!1),cleanup:x.types.optional(x.types.boolean,!0),placeholder:x.types.optional(x.types.string,"Quick Filter"),minlength:x.types.optional(x.types.string,"3"),hotkey:x.types.maybeNull(x.types.string)}),Lu=x.types.model({type:"filter",_value:x.types.maybeNull(x.types.string),name:x.types.identifier,toname:x.types.maybeNull(x.types.string)}).views((function(e){return{get completion(){return Object(x.getRoot)(e).completionStore.selected},get toTag(){return e.completion.names.get(e.toname)}}})).actions((function(e){return{applyFilter(){var t=e._value,n=e.toTag.tiedChildren;Number(e.minlength)>t.length?n.filter((function(e){return!e.visible})).forEach((function(e){return e.setVisible(!0)})):(e.casesensetive||(t=t.toLowerCase()),n.forEach((function(n){var a=n._value;e.casesensetive||(a=a.toLowerCase()),-1!==a.indexOf(t)?n.setVisible(!0):n.setVisible(!1)})))},applyFilterEv(t){var n=t.target.value;e._value=n,e.applyFilter()},onHotKey:()=>(e._ref&&e._ref.focus(),!1),setInputRef(t){e._ref=t},selectFirstElement(){e.toTag.selectFirstVisible()&&e.cleanup&&(e._value="",e.applyFilter())}}})),Du=x.types.compose("FilterModel",Lu,Pu,Aa),Iu=Object(E.c)((function(e){var t=e.item,n=t.toTag;return-1===n.type.indexOf("labels")&&-1===n.type.indexOf("choices")?null:p.a.createElement(st.a,{ref:function(e){t.setInputRef(e)},value:t._value,size:"small",onChange:t.applyFilterEv,onPressEnter:t.selectFirstElement,placeholder:t.placeholder})}));C.addTag("filter",Du,Iu);var Hu=n(119),Bu=n.n(Hu),Uu=n(263),Vu=n.n(Uu),Fu=Object(E.b)("store")(Object(E.c)((function(e){var t=e.store,n=e.errors;return console.log(Vu.a),p.a.createElement("div",{className:"ls-errors"},n.map((function(e,n){return p.a.createElement("code",{key:"error-".concat(n),className:Vu.a["ls-error"],dangerouslySetInnerHTML:{__html:Object(x.getEnv)(t).messages[e.error](e)}})})))}))),Wu=function(e){Object(y.a)(n,e);var t=Object(v.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"renderSuccess",value:function(){return p.a.createElement(b.a,{status:"success",title:Object(x.getEnv)(this.props.store).messages.DONE})}},{key:"renderNoCompletion",value:function(){return p.a.createElement(b.a,{status:"success",title:Object(x.getEnv)(this.props.store).messages.NO_COMP_LEFT})}},{key:"renderNothingToLabel",value:function(){return p.a.createElement(b.a,{status:"success",title:Object(x.getEnv)(this.props.store).messages.NO_NEXT_TASK})}},{key:"renderNoAccess",value:function(){return p.a.createElement(b.a,{status:"warning",title:Object(x.getEnv)(this.props.store).messages.NO_ACCESS})}},{key:"renderConfigValidationException",value:function(){return p.a.createElement(Ot,null,p.a.createElement(Fu,{errors:this.props.store.completionStore.validation}))}},{key:"renderLoader",value:function(){return p.a.createElement(b.a,{icon:p.a.createElement(w.a,{size:"large"})})}},{key:"_renderAll",value:function(e){return 1===e.length?p.a.createElement(Ot,{completion:e[0]},[P.renderItem(e[0].root)]):p.a.createElement("div",{className:"ls-renderall"},e.map((function(e){return p.a.createElement("div",{className:"ls-fade"},p.a.createElement(Ot,{completion:e},[P.renderItem(e.root)]))})))}},{key:"_renderUI",value:function(e,t,n,a){return p.a.createElement(p.a.Fragment,null,!n.viewingAllCompletions&&!n.viewingAllPredictions&&p.a.createElement(Ot,{completion:n.selected,className:a.bottomSidePanel?"":Bu.a.segment+" ls-segment"},p.a.createElement("div",{style:{position:"relative"}},P.renderItem(e),this.renderRelations(n.selected)),t.hasInterface("controls")&&p.a.createElement(it,{item:n.selected})),n.viewingAllCompletions&&this.renderAllCompletions(),n.viewingAllPredictions&&this.renderAllPredictions())}},{key:"renderAllCompletions",value:function(){return this._renderAll(this.props.store.completionStore.completions)}},{key:"renderAllPredictions",value:function(){return this._renderAll(this.props.store.completionStore.predictions)}},{key:"renderRelations",value:function(e){var t=e.relationStore;return p.a.createElement(Ea,{key:N(),store:t})}},{key:"render",value:function(){var e=this.props.store,t=e.completionStore,n=t.selected&&t.selected.root,a=e.settings;if(e.isLoading)return this.renderLoader();if(e.noTask)return this.renderNothingToLabel();if(e.noAccess)return this.renderNoAccess();if(e.labeledSuccess)return this.renderSuccess();if(!n)return this.renderNoCompletion();var r=a.fullscreen?Bu.a.editorfs:Bu.a.editor,o=a.bottomSidePanel?Bu.a.commonbsp:Bu.a.common,i=a.bottomSidePanel?Bu.a.menubsp:Bu.a.menu;return p.a.createElement("div",{className:r+" ls-editor"},p.a.createElement(Dt,{store:e}),p.a.createElement(E.a,{store:e},p.a.createElement("div",null,e.hasInterface("panel")&&p.a.createElement(bt,{store:e}),e.showingDescription&&p.a.createElement(Ot,null,p.a.createElement("div",{dangerouslySetInnerHTML:{__html:e.description}})),p.a.createElement("div",{className:o+" ls-common"},null===t.validation?this._renderUI(n,e,t,a):this.renderConfigValidationException(),p.a.createElement("div",{className:i+" ls-menu"},e.hasInterface("completions:menu")&&e.settings.showCompletionsPanel&&p.a.createElement($e,{store:e}),e.hasInterface("predictions:menu")&&e.settings.showPredictionsPanel&&p.a.createElement(St,{store:e}),e.hasInterface("side-column")&&!t.viewingAllCompletions&&!t.viewingAllPredictions&&p.a.createElement(Jn,{store:e}))))),e.hasInterface("debug")&&p.a.createElement(ut,{store:e}))}}]),n}(d.Component),Yu=Object(E.c)(Wu),Xu=x.types.model("TimeSeriesRegionModel",{id:x.types.optional(x.types.identifier,N),pid:x.types.optional(x.types.string,N),type:"timeseriesregion",object:x.types.late((function(){return x.types.reference(jl)})),start:x.types.union(x.types.number,x.types.string),end:x.types.union(x.types.number,x.types.string),instant:!1}).views((function(e){return{get parent(){return e.object},get completion(){return Object(x.getRoot)(e).completionStore.selected},get regionElement(){return e._brushRef}}})).actions((function(e){return{growRight(t){e.end=e.end+t},growLeft(t){e.start=e.start-t},shrinkRight(t){e.end=e.end-t},shrinkLeft(t){e.start=e.start+t},selectRegion(){Pt.addKey("left",(function(){return e.growLeft(1e3)}),"Increase region to the left"),Pt.addKey("right",(function(){return e.growRight(1e3)}),"Increase region to the right"),Pt.addKey("alt+left",(function(){return e.shrinkLeft(1e3)}),"Decrease region on the left"),Pt.addKey("alt+right",(function(){return e.shrinkRight(1e3)}),"Decrease region on the right"),Pt.addKey("shift+left",(function(){return e.growLeft(1e4)})),Pt.addKey("shift+right",(function(){return e.growRight(1e4)})),Pt.addKey("shift+alt+left",(function(){return e.shrinkLeft(1e4)})),Pt.addKey("shift+alt+right",(function(){return e.shrinkRight(1e4)})),e.parent.scrollToRegion(e)},updateAppearenceFromState(){e.labelsState&&e.parent.updateView()},afterUnselectRegion(){["left","right","ctrl+left","ctrl+right","up","shift+up","down","shift+down","ctrl+up","ctrl+shift+up","ctrl+down","ctrl+shift+down"].forEach((function(e){return Pt.removeKey(e)})),e.parent.updateView()},updateRegion(t,n){e.start=t,e.end=n},afterCreate(){"string"===typeof e.start&&(e.start=e.parent.parseTime(e.start),e.end=e.parent.parseTime(e.end))},serialize(t,n){var a=e.parent.timeformat?el.o(e.parent.timeformat):Number;return{value:{start:a(e.start),end:a(e.end),instant:e.instant}}}}})),Gu=x.types.compose("TimeSeriesRegionModel",dr,Ar,Pr,Mr,Xu);C.addTag("timeseriesregion",Gu,(function(){})),C.addRegionType(Gu,"timeseries");var Ku=x.types.union(Dr,xi,Ti,Yr,Gu,ki,ai,ji,Bc,Ui),Ju=x.types.model("Normalization",{node1:x.types.reference(Ku),node2:x.types.reference(Ku)}).actions((function(e){return{toggleHighlight(){e.node1===e.node2?e.node1.toggleHighlight():(e.node1.toggleHighlight(),e.node2.toggleHighlight())}}})),qu=x.types.model("NormalizationStore",{normalizations:x.types.array(Ju)}).actions((function(e){return{findNormalization:(t,n)=>n?e.normalizations.find((function(e){return e.node1.id===t.id&&e.node2.id===n.id})):e.normalizations.find((function(e){return e.node1.id===t.id||e.node2.id===t.id})),addNormalization(t,n){if(!e.findNormalization(t,n)){var a=Ju.create({node1:t,node2:n});return e.normalizations.unshift(a),a}},deleteNormalization(e){Object(x.destroy)(e)},deleteNodeNormalization(t){var n=e.findNormalization(t);n&&e.deleteNormalization(n)}}})),Zu=x.types.model("RegionStore",{sort:x.types.optional(x.types.enumeration(["date","score"]),"date"),sortOrder:x.types.optional(x.types.enumeration(["asc","desc"]),"desc"),group:x.types.optional(x.types.enumeration(["type","label"]),"type"),view:x.types.optional(x.types.enumeration(["regions","labels"]),"regions")}).views((function(e){return{get completion(){return Object(x.getParent)(e)},get regions(){return Array.from(e.completion.areas.values()).filter((function(e){return!e.classification}))},get sortedRegions(){return{date:function(t){return t?e.regions:Object(qn.a)(e.regions).reverse()},score:function(t){return Object(qn.a)(e.regions).sort(t?function(e,t){return t.score-e.score}:function(e,t){return e.score-t.score})}}[e.sort]("desc"===e.sortOrder)},asTree(t){var n=e.sortedRegions,a=[],r={};return n.forEach((function(e,n){r[e.id]=t(e,n),r[e.id].item=e,r[e.id].children=[]})),Object.keys(r).forEach((function(t){var n=r[t],o=n.item.parentID;if(o){var i=r[o];if(i||(i=r["".concat(o,"#").concat(e.completion.id)]),i)return void i.children.push(n)}a.push(n)})),a},asLabelsTree(t){var n={},a={};e.regions.forEach((function(e){var t=e.labeling;if(t){var r=t.selectedLabels;r&&r.forEach((function(t){n[t._value]=t,t._value in a?a[t._value].push(e):a[t._value]=[e]}))}}));var r=0;return Object.keys(n).map((function(e){var o=t(n[e],r,!0);return o.children=a[e].map((function(e){return t(e,r++)})),o}))}}})).actions((function(e){return{addRegion(t){e.regions.push(t),Object(x.getEnv)(e).onEntityCreate(t)},toggleSortOrder(){"asc"===e.sortOrder?e.sortOrder="desc":e.sortOrder="asc"},setView(t){e.view=t},setSort(t){e.sort===t?e.toggleSortOrder():(e.sortOrder="desc",e.sort=t),e.initHotkeys()},setGroup(t){e.group=t},deleteRegion(t){var n=e.regions,a=e.filterByParentID(t.id);a&&a.forEach((function(e){return e.setParentID(t.parentID)}));for(var r=0;r<n.length;r++)n[r]===t&&n.splice(r,1);Object(x.getEnv)(e).onEntityDelete(t),e.initHotkeys()},findRegionID:t=>e.regions.find((function(e){return e.id===t})),findRegion:t=>e.regions.find((function(e){return e.id===t})),filterByParentID:t=>e.regions.filter((function(e){return e.parentID===t})),afterCreate(){Object(x.onPatch)(e,(function(t){"add"!==t.op&&"delete"!==t.op||-1===t.path.indexOf("/regions/")||e.initHotkeys()})),e.view=e.completion.store.settings.displayLabelsByDefault?"labels":"regions"},initHotkeys(){Pt.getKeys().filter((function(e){return-1!==e.indexOf("alt+shift+")})).forEach((function(e){return Pt.removeKey(e)})),e.sortedRegions.forEach((function(t,n){Pt.addKey("alt+shift+"+(n+1),(function(){e.unselectAll(),t.selectRegion()}))})),Pt.addKey("alt+shift+$n",(function(){}),"Select a region")},unselectAll(){e.completion.unselectAll()},unhighlightAll(){e.regions.forEach((function(e){return e.setHighlight(!1)}))},selectNext(){var t=e.regions,n=e.regions.findIndex((function(e){return e.selected}));-1!==n&&t[n].unselectRegion();var a="undefined"!==t[n+1]?t[n+1]:t[0];a&&a.selectRegion()}}})),$u=x.types.compose("ClassificationArea",Pr,x.types.model({object:x.types.late((function(){return x.types.reference(x.types.union.apply(x.types,Object(qn.a)(C.objectTypes())))})),classification:!0}).actions((function(e){return{serialize:function(){return{}}}}))),Qu=x.types.union({dispatcher(e){if(e.$treenode)return e.$treenode.type;if(e.value&&Object.values(e.value).length<=1)return $u;var t=e.object.name||e.object,n=window.Htx.completionStore.names.get(t),a=C.getAvailableAreas(n.type,e);return a.length?x.types.union.apply(x.types,Object(qn.a)(a).concat([$u])):$u}},Dr,Ui,Yr,Gu,ji,ki,Ti,ai,xi,$u),ed=x.types.model("Relation",{id:x.types.optional(x.types.identifier,N),node1:x.types.reference(Qu),node2:x.types.reference(Qu),direction:x.types.optional(x.types.enumeration(["left","right","bi"]),"right"),relations:x.types.maybeNull(cu),showMeta:x.types.optional(x.types.boolean,!1)}).views((function(e){return{get parent(){return Object(x.getParentOfType)(e,td)},get hasRelations(){var t=e.relations;return t&&t.children&&t.children.length>0}}})).actions((function(e){return{afterAttach(){var t=Object(x.getRoot)(e).completionStore.selected,n=null;t.traverseTree((function(e){if("relations"===e.type)return n=e,"skip"})),null!==n&&(e.relations=T(n))},rotateDirection(){var t=["left","right","bi"],n=t.findIndex((function(t){return t===e.direction}));(n+=1)>=t.length&&(n=0),e.direction=t[n]},toggleHighlight(){e.node1===e.node2?e.node1.toggleHighlight():(e.node1.toggleHighlight(),e.node2.toggleHighlight())},toggleMeta(){e.showMeta=!e.showMeta},setSelfHighlight(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?e.parent.setHighlight(e):e.parent.removeHighlight()}}})),td=x.types.model("RelationStore",{_relations:x.types.array(ed),showConnections:x.types.optional(x.types.boolean,!0),highlighted:x.types.maybeNull(x.types.safeReference(ed))}).views((function(e){return{get relations(){return e._relations.filter((function(e){return Object(x.isValidReference)((function(){return e.node1}))&&Object(x.isValidReference)((function(){return e.node2}))}))}}})).actions((function(e){return{findRelations(t,n){var a=t.id||t,r=(null===n||void 0===n?void 0:n.id)||n;return r?e.relations.filter((function(e){return e.node1.id===a&&e.node2.id===r})):e.relations.filter((function(e){return e.node1.id===a||e.node2.id===a}))},nodesRelated:(t,n)=>e.findRelations(t,n).length>0,addRelation(t,n){if(!e.nodesRelated(t,n)){var a=ed.create({node1:t,node2:n});return e._relations.push(a),a}},deleteRelation(e){Object(x.destroy)(e)},deleteNodeRelation(t){var n=e.findRelations(t);n.length&&n.forEach(e.deleteRelation)},serializeCompletion:()=>e.relations.map((function(e){var t={from_id:e.node1.cleanId,to_id:e.node2.cleanId,type:"relation",direction:e.direction};return e.relations&&(t.labels=e.relations.selectedValues()),t})),deserializeRelation(t,n,a,r){var o=e.addRelation(t,n);o.direction=a,o.relations&&r&&r.forEach((function(e){var t=o.relations.findRelation(e);t&&t.setSelected(!0)}))},toggleConnections(){e.showConnections=!e.showConnections},setHighlight(t){e.highlighted=t},removeHighlight(){e.highlighted=null}}})),nd=td,ad=x.types.model("TimeTraveller",{undoIdx:0,targetPath:"",skipNextUndoState:x.types.optional(x.types.boolean,!1),createdIdx:0}).volatile((function(e){return{history:[],isFrozen:!1}})).views((function(e){return{get canUndo(){return e.undoIdx>0},get canRedo(){return e.undoIdx<e.history.length-1}}})).actions((function(e){var t,n,a=new Set;function r(){a.forEach((function(e){return e()}))}return{freeze(){e.isFrozen=!0},unfreeze(){e.isFrozen=!1,e.recordNow()},recordNow(){e.addUndoState(Object(x.getSnapshot)(t))},onUpdate:e=>(a.add(e),function(){a.delete(e)}),addUndoState(t){e.isFrozen||(e.skipNextUndoState?e.skipNextUndoState=!1:(e.history.splice(e.undoIdx+1),e.history.push(t),e.undoIdx=e.history.length-1))},reinit(){e.history=[Object(x.getSnapshot)(t)],e.undoIdx=0,e.createdIdx=0,r()},afterCreate(){var a=this;if(!(t=e.targetPath?Object(x.resolvePath)(e,e.targetPath):Object(x.getEnv)(e).targetStore))throw new Error("Failed to find target store for TimeTraveller. Please provide `targetPath`  property, or a `targetStore` in the environment");n=Object(x.onSnapshot)(t,(function(e){return a.addUndoState(e)})),0===e.history.length&&e.recordNow(),e.createdIdx=e.undoIdx},beforeDestroy(){n()},undo(){e.set(e.undoIdx-1)},redo(){e.set(e.undoIdx+1)},set(n){e.undoIdx=n,e.skipNextUndoState=!0,Object(x.applySnapshot)(t,e.history[n]),r()},reset(){e.set(e.createdIdx)}}})),rd={CONFIG:yl,RESULT:{validate:()=>[]}},od=Object.keys(rd).reduce((function(e,t){return Object(u.a)(Object(u.a)({},e),{},{[t]:t})}),{}),id=x.types.union(x.types.string,x.types.array(x.types.string)),ld=x.types.model({modelName:x.types.string,field:x.types.string,error:x.types.string,value:x.types.maybeNull(x.types.string),validType:x.types.maybeNull(id)}).views((function(e){return{get identifier(){var t;return(t=[e.modelName,e.field,e.error,e.value]).concat.apply(t,[e.validType]).filter((function(e){return null!==e})).join("-")}}})),sd=function(){function e(){Object(h.a)(this,e),this.callbacks=new Set}return Object(f.a)(e,[{key:"addErrorCallback",value:function(e){return!this.callbacks.has(e)&&(this.callbacks.add(e),!0)}},{key:"removeErrorCallback",value:function(e){return!!this.callbacks.has(e)&&(this.callbacks.delete(e),!0)}},{key:"validate",value:function(e,t){var n,a=this,r=rd[e],o=[];r?o=(null!==(n=r.validate(t))&&void 0!==n?n:[]).map((function(e){try{return ld.create(e)}catch(t){throw console.log({compiledError:e}),t}})):console.error("Unknown validator: ".concat(e));setTimeout((function(){if(o.length){var e,t=Object(S.a)(a.callbacks);try{for(t.s();!(e=t.n()).done;){(0,e.value)(o)}}catch(n){t.e(n)}finally{t.f()}}}),0)}}]),e}(),cd=x.types.model("Completion",{id:x.types.identifier,pk:x.types.maybeNull(x.types.string),selected:x.types.optional(x.types.boolean,!1),type:x.types.enumeration(["completion","prediction"]),createdDate:x.types.optional(x.types.string,Xe.UDate.currentISODate()),createdAgo:x.types.maybeNull(x.types.string),createdBy:x.types.optional(x.types.string,"Admin"),loadedDate:x.types.optional(x.types.Date,new Date),leadTime:x.types.maybeNull(x.types.number),draft:!1,draftSaved:x.types.maybe(x.types.string),userGenerate:x.types.optional(x.types.boolean,!0),update:x.types.optional(x.types.boolean,!1),sentUserGenerate:x.types.optional(x.types.boolean,!1),localUpdate:x.types.optional(x.types.boolean,!1),honeypot:x.types.optional(x.types.boolean,!1),skipped:!1,history:x.types.optional(ad,{targetPath:"../areas"}),dragMode:x.types.optional(x.types.boolean,!1),editable:x.types.optional(x.types.boolean,!0),relationMode:x.types.optional(x.types.boolean,!1),relationStore:x.types.optional(nd,{relations:[]}),normalizationMode:x.types.optional(x.types.boolean,!1),normalizationStore:x.types.optional(qu,{normalizations:[]}),areas:x.types.map(Qu),regionStore:x.types.optional(Zu,{regions:[]}),highlightedNode:x.types.maybeNull(x.types.safeReference(Ku))}).preProcessSnapshot((function(e){return e.draft=Boolean(e.draft),e})).views((function(e){return{get store(){return Object(x.getRoot)(e)},get list(){return Object(x.getParent)(e,2)},get root(){return e.list.root},get names(){return e.list.names},get toNames(){return e.list.toNames},get objects(){return Array.from(e.names.values()).filter((function(e){return!e.toname}))},get results(){var t=[];return e.areas.forEach((function(e){return e.results.forEach((function(e){return t.push(e)}))})),t}}})).volatile((function(e){return{versions:{}}})).actions((function(e){return{reinitHistory(){e.history.reinit(),e.autosave&&e.autosave.cancel()},setEdit(t){e.editable=t},setGroundTruth(t){e.honeypot=t,Object(x.getEnv)(e).onGroundTruth(e.store,e,t)},sendUserGenerate(){e.sentUserGenerate=!0},setLocalUpdate(t){e.localUpdate=t},setDragMode(t){e.dragMode=t},updatePersonalKey(t){e.pk=t},setNormalizationMode(t){e.normalizationMode=t},setHighlightedNode(e){},selectArea(t){e.highlightedNode!==t&&(e.unselectAll(),e.highlightedNode=t,t.selectRegion&&t.selectRegion(),t.perRegionTags.forEach((function(e){var t;return null===(t=e.updateFromResult)||void 0===t?void 0:t.call(e,void 0)})),t.results.forEach((function(e){var t,n;return null===(t=(n=e.from_name).updateFromResult)||void 0===t?void 0:t.call(n,e.mainValue)})))},unselectArea(t){e.highlightedNode===t&&e.unselectAll()},unselectAreas(){var t,n=e.highlightedNode;n&&(n.perRegionTags.forEach((function(e){var t;return null===(t=e.submitChanges)||void 0===t?void 0:t.call(e)})),e.highlightedNode=null,null===(t=n.afterUnselectRegion)||void 0===t||t.call(n))},unselectStates(){e.names.forEach((function(e){return e.unselectAll&&e.unselectAll()}))},unselectAll(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&e.store.settings.continuousLabeling;e.unselectAreas(),t||e.unselectStates()},removeArea(e){Object(x.destroy)(e)},startRelationMode(t){e._relationObj=t,e.relationMode=!0,document.body.style.cursor=_r},stopRelationMode(){document.body.style.cursor=Sr,e._relationObj=null,e.relationMode=!1,e.regionStore.unhighlightAll()},deleteAllRegions(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).deleteReadOnly,n=void 0!==t&&t,a=e.regionStore.regions;!1===n&&(a=a.filter((function(e){return!1===e.readonly}))),a.forEach((function(e){return e.deleteRegion()}))},addRegion(t){e.regionStore.unselectAll(!0),e.relationMode&&(e.addRelation(t),e.stopRelationMode())},loadRegionState(t){t.states&&t.states.forEach((function(t){var n=e.names.get(t.name);n.unselectAll&&n.unselectAll(),n.copyState(t)}))},unloadRegionState(t){t.states&&t.states.forEach((function(t){var n=e.names.get(t.name);n.unselectAll&&n.unselectAll(),n.perRegionCleanup&&n.perRegionCleanup()}))},addRelation(t){e.relationStore.addRelation(e._relationObj,t)},addNormalization(t){e.normalizationStore.addNormalization()},validate(){var t=!0;return e.traverseTree((function(e){if(!0===e.required&&!1===(t=e.validate()))return t=!1,"stop"})),t},traverseTree:t=>P.traverseTree(e.root,t),beforeSend(){e.traverseTree((function(e){e&&e.beforeSend&&e.beforeSend()})),e.stopRelationMode(),e.unselectAll()},deleteRegion(t){e.relationStore.deleteNodeRelation(t),"polygonregion"===t.type&&Object(x.detach)(t),Object(x.destroy)(t)},deleteArea(e){Object(x.destroy)(e)},updateObjects(){e.unselectAll(),e.names.forEach((function(e){return e.needsUpdate&&e.needsUpdate()})),e.areas.forEach((function(e){return e.updateAppearenceFromState&&e.updateAppearenceFromState()}))},addVersions(t){e.versions=Object(u.a)(Object(u.a)({},e.versions),t)},toggleDraft(){var t=e.draft;(t||e.versions.draft)&&(e.autosave.flush(),e.pauseAutosave(),t&&(e.versions.draft=e.serializeCompletion()),e.deleteAllRegions({deleteReadOnly:!0}),t?(e.deserializeCompletion(e.versions.result),e.draft=!1):(e.deserializeCompletion(e.versions.draft),e.draft=!0),e.updateObjects(),e.startAutosave())},startAutosave:()=>Object(Qi.a)($i.a.mark((function t(){return $i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Object(x.getEnv)(e).onSubmitDraft){t.next=2;break}return t.abrupt("return");case 2:if("completion"===e.type){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,ne(0);case 6:if(!e.autosave){t.next=10;break}return e.autosave.cancel(),e.autosave.paused=!1,t.abrupt("return");case 10:console.info("autosave initialized"),e.autosave=Ha()((function(t){if(!e.autosave.paused){var n=e.serializeCompletion();(e.pk||n.length)&&(e.setDraft(!0),e.versions.draft=n,e.store.submitDraft(e).then(e.onDraftSaved))}}),5e3,{leading:!1}),Object(x.onSnapshot)(e.areas,e.autosave);case 13:case"end":return t.stop()}}),t)})))(),pauseAutosave(){e.autosave&&(e.autosave.paused=!0,e.autosave.cancel())},beforeDestroy(){e.autosave&&e.autosave.cancel&&e.autosave.cancel()},setDraft(t){e.draft=t},onDraftSaved(){e.draftSaved=Xe.UDate.currentISODate()},dropDraft(){e.autosave&&(e.autosave.cancel(),e.draft=!1,e.draftSaved=void 0,e.versions.draft=void 0)},afterAttach(){e.traverseTree((function(t){if(t.completionAttached&&t.completionAttached(),t&&t.getToolsManager){var n=t.getToolsManager(),a=e.toNames.get(t.name);a&&a.forEach((function(e){return n.addToolsFromControl(e)}))}})),e.history.onUpdate(e.updateObjects),e.startAutosave()},afterCreate(){e.userGenerate&&!e.sentUserGenerate&&(e.loadedDate=new Date)},setupHotKeys(){Pt.unbindAll();var t=0,n=null,a="shift+space",r=a;e.traverseTree((function(e){e&&e.onHotKey&&e.hotkey&&Pt.addKey(e.hotkey,e.onHotKey,void 0,e.hotkeyScope)})),e.traverseTree((function(e){!e||e.hotkey||"audio"!==e.type&&"audioplus"!==e.type||(t>0?r=a+"+"+(t+1):n=e,e.hotkey=r,Pt.addKey(r,e.onHotKey,"Play an audio"),t++)})),e.traverseTree((function(e){if(e&&e.onHotKey&&!e.hotkey){var t=Pt.makeComb();if(!t)return;e.hotkey=t,Pt.addKey(e.hotkey,e.onHotKey)}})),n&&t>1&&(n.hotkey=a+"+1",Pt.addKey(n.hotkey,n.onHotKey),Pt.removeKey(a)),Pt.setScope("__main__")},createResult(t,n,a,r){var o={from_name:a.name,to_name:r,type:a.resultType,value:n},i=e.areas.put(Object(u.a)(Object(u.a)({id:N(),object:r},t),{},{value:t,results:[o]}));return e.store.settings.selectAfterCreate?i.classification||setTimeout((function(){return Object(x.isAlive)(i)&&e.selectArea(i)})):a.type.includes("labels")&&e.unselectAll(!0),i},serializeCompletion:()=>e.results.map((function(e){return e.serialize()})).filter(Boolean).concat(e.relationStore.serializeCompletion()),fixBrokenCompletion:e=>(e.forEach((function(e){"htmllabels"===e.type&&(e.type="hypertextlabels")})),e),deserializeCompletion(t){try{var n=t;"object"!==typeof n&&(n=JSON.parse(n)),n=e.fixBrokenCompletion(n),e._initialCompletionObj=n,n.forEach((function(t){if("relation"!==t.type){var n=t.id,a=t.value,r=t.type,o=Object(hn.a)(t,["id","value","type"]),i="".concat(n||N(),"#").concat(e.id),l="".concat(o.from_name,"@").concat(i),s=e.areas.get(i);s||(s=e.areas.put(Object(u.a)(Object(u.a)(Object(u.a)({id:i,object:o.to_name},o),a),{},{value:a}))),s.addResult(Object(u.a)(Object(u.a)({},o),{},{id:l,type:r,value:a}))}})),e.results.filter((function(e){return e.area.classification})).forEach((function(e){var t,n;return null===(t=(n=e.from_name).updateFromResult)||void 0===t?void 0:t.call(n,e.mainValue)})),n.forEach((function(t){"relation"===t.type&&e.relationStore.deserializeRelation("".concat(t.from_id,"#").concat(e.id),"".concat(t.to_id,"#").concat(e.id),t.direction,t.labels)}))}catch(a){console.error(a),e.list.addErrors([ml.generalError(a)])}}}})),ud=x.types.model("CompletionStore",{selected:x.types.maybeNull(x.types.reference(cd)),root:rl.allModelsTypes(),names:x.types.map(x.types.reference(rl.allModelsTypes())),toNames:x.types.map(x.types.array(x.types.reference(rl.allModelsTypes()))),completions:x.types.array(cd),predictions:x.types.array(cd),viewingAllCompletions:x.types.optional(x.types.boolean,!1),viewingAllPredictions:x.types.optional(x.types.boolean,!1),validation:x.types.maybeNull(x.types.array(ld))}).views((function(e){return{get store(){return Object(x.getRoot)(e)}}})).actions((function(e){function t(){e.viewingAllCompletions||e.viewingAllPredictions?(e.selected&&(e.selected.unselectAll(),e.selected.selected=!1),e.completions.forEach((function(e){e.editable=!1}))):a(e.completions[0].id)}function n(t,n){e.viewingAllCompletions=!1,e.viewingAllPredictions=!1,e.selected&&(e.selected.unselectAll(),e.selected.selected=!1);var a=n.find((function(e){return e.id===t||e.pk===String(t)}))||n[0];return a?(a.selected=!0,e.selected=a,a.updateObjects(),a):null}function a(t){if(!e.completions.length)return null;var a=e.selected,r=n(t,e.completions);return r.editable=!0,r.setupHotKeys(),Object(x.getEnv)(e).onSelectCompletion(r,a),r}function r(t){if(!e.root){var n=P.treeToModel(t),a=C.getModelByTag(n.type),r=C.objectTypes().map((function(e){return e.name.replace("Model","").toLowerCase()})),o=[];e.validate(od.CONFIG,n);try{e.root=a.create(n)}catch(i){return console.error(i),e.addErrors([ml.generalError(i)]),e.root=Nu.create({id:"error"})}return P.traverseTree(e.root,(function(t){(null===t||void 0===t?void 0:t.name)&&(e.names.put(t),r.includes(t.type)&&o.push(t.name))})),P.traverseTree(e.root,(function(t){if(t.name&&!r.includes(t.type)&&!t.toname&&1===o.length&&(t.toname=o[0]),t&&t.toname){var n=e.toNames.get(t.toname);n?n.push(t.name):e.toNames.set(t.toname,[t.name])}e.store.task&&t.updateValue&&t.updateValue(e.store)})),e.root}}function o(t){var n=e.store,a=n.user,o=n.config;e.root||r(o);var i=t.pk||t.id,l=Object(u.a)(Object(u.a)({userGenerate:!1},t),{},{id:N(5),pk:i&&String(i),root:e.root});return a&&!("createdBy"in l)&&(l.createdBy=a.displayName),cd.create(l)}var i=function(t){e.addErrors(t)};return{afterCreate:function(){e._validator=new sd,e._validator.addErrorCallback(i)},beforeDestroy:function(){e._validator.removeErrorCallback(i)},toggleViewingAllCompletions:function(){e.viewingAllCompletions=!e.viewingAllCompletions,e.viewingAllCompletions&&(e.viewingAllPredictions=!1),t()},toggleViewingAllPredictions:function(){e.viewingAllPredictions=!e.viewingAllPredictions,e.viewingAllPredictions&&(e.viewingAllCompletions=!1),t()},initRoot:r,addPrediction:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.editable=!1,t.type="prediction";var n=o(t);return e.predictions.unshift(n),n},addCompletion:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.type="completion";var n=o(t);return n.addVersions({result:t.result,draft:t.draft}),e.completions.unshift(n),n},addCompletionFromPrediction:function(t){var n=t._initialCompletionObj.map((function(e){return Object(u.a)({},e)})),r=e.addCompletion({userGenerate:!0,result:n}),o={};return n.forEach((function(e){if("id"in e){var t=e.id.replace(/#.*$/,"#".concat(r.id));o[e.id]=t,e.id=t}})),n.forEach((function(e){e.parent_id&&(o[e.parent_id]?e.parent_id=o[e.parent_id]:e.parent_id=null)})),a(r.id),r.deserializeCompletion(n),r},addErrors:function(t){var n,a=[],r=[].concat(Object(qn.a)(null!==(n=e.validation)&&void 0!==n?n:[]),Object(qn.a)(t)).reduce((function(e,t){var n=t.identifier;return a.indexOf(n)<0&&(a.push(n),e.push(t)),e}),[]);e.validation=r},validate:function(t,n){e._validator.validate(t,n)},selectCompletion:a,selectPrediction:function(t){return n(t,e.predictions)},deleteCompletion:function(t){Object(x.getEnv)(e).onDeleteCompletion(e.store,t),Object(x.destroy)(t),e.selected=null,e.completions.length>0&&e.selectCompletion(e.completions[0].id)}}})),dd=x.types.model("Project",{id:x.types.identifierNumber}).views((function(e){return{get app(){return Object(x.getParent)(e)}}})),pd=x.types.model("SettingsModel",{enableHotkeys:x.types.optional(x.types.boolean,!0),enablePanelHotkeys:x.types.optional(x.types.boolean,!0),enableTooltips:x.types.optional(x.types.boolean,!1),enableLabelTooltips:x.types.optional(x.types.boolean,!0),continuousLabeling:!1,selectAfterCreate:!1,fullscreen:x.types.optional(x.types.boolean,!1),bottomSidePanel:x.types.optional(x.types.boolean,!1),sidePanelMode:x.types.optional(x.types.enumeration(["SIDEPANEL_MODE_REGIONS","SIDEPANEL_MODE_LABELS"]),"SIDEPANEL_MODE_REGIONS"),imageFullSize:x.types.optional(x.types.boolean,!1),enableAutoSave:x.types.optional(x.types.boolean,!1),showLabels:x.types.optional(x.types.boolean,!1),showLineNumbers:!1,showCompletionsPanel:x.types.optional(x.types.boolean,!0),showPredictionsPanel:x.types.optional(x.types.boolean,!0)}).views((function(e){return{get completion(){return Object(x.getRoot)(e).completionStore.selected},get displayLabelsByDefault(){return"SIDEPANEL_MODE_LABELS"===e.sidePanelMode}}})).actions((function(e){return{afterCreate(){try{if(!window.localStorage)return}catch(r){return}var t="labelStudio:settings",n=localStorage.getItem(t);if(n){var a=JSON.parse(n);"object"===typeof a&&null!==a&&Object.keys(a).forEach((function(t){t in e&&(e[t]=a[t])}))}Object(x.onSnapshot)(e,(function(e){localStorage.setItem(t,JSON.stringify(e))}))},toggleShowLabels(){e.showLabels=!e.showLabels,Xe.HTML.toggleLabelsAndScores(e.showLabels)},toggleShowLineNumbers(){e.showLineNumbers=!e.showLineNumbers,document.querySelectorAll(".htx-text").forEach((function(e){return e.classList.toggle("htx-line-numbers")}))},toggleContinuousLabeling(){e.continuousLabeling=!e.continuousLabeling},toggleSelectAfterCreate(){e.selectAfterCreate=!e.selectAfterCreate},toggleSidepanelModel(){e.sidePanelMode="SIDEPANEL_MODE_LABELS"===e.sidePanelMode?"SIDEPANEL_MODE_REGIONS":"SIDEPANEL_MODE_LABELS",e.completion.regionStore.setView(e.displayLabelsByDefault?"labels":"regions")},toggleAutoSave(){e.enableAutoSave=!e.enableAutoSave},toggleHotkeys(){e.enableHotkeys=!e.enableHotkeys,e.enableHotkeys?Pt.setScope("__main__"):Pt.setScope("__none__")},togglePanelHotkeys(){e.enablePanelHotkeys=!e.enablePanelHotkeys},toggleTooltips(){e.enableTooltips=!e.enableTooltips},toggleFullscreen(){e.fullscreen=!e.fullscreen},toggleBottomSP(){e.bottomSidePanel=!e.bottomSidePanel},toggleImageFS(){e.imageFullSize=!e.imageFullSize},toggleLabelTooltips(){e.enableLabelTooltips=!e.enableLabelTooltips},toggleCompletionsPanel(){e.showCompletionsPanel=!e.showCompletionsPanel},togglePredictionsPanel(){e.showPredictionsPanel=!e.showPredictionsPanel}}})),md=x.types.model({enable:x.types.optional(x.types.boolean,!1),username:x.types.string,password:x.types.string,to:x.types.string}),gd=x.types.model("Task",{id:x.types.maybeNull(x.types.number),load:x.types.optional(x.types.boolean,!1),auth:x.types.maybeNull(md),data:x.types.maybeNull(x.types.string)}).views((function(e){return{get app(){return Object(x.getParent)(e)},get dataObj(){return Xe.Checkers.isStringJSON(e.data)?JSON.parse(e.data):"object"===typeof e.data?e.data:null}}})),hd=x.types.model("UserStore",{pk:x.types.maybeNull(x.types.integer),firstName:x.types.maybeNull(x.types.string),lastName:x.types.maybeNull(x.types.string)}).views((function(e){return{get displayName(){return e.firstName||e.lastName?"".concat(e.firstName," ").concat(e.lastName):""}}})),fd=x.types.model("AppStore",{config:x.types.string,task:x.types.maybeNull(gd),project:x.types.maybeNull(dd),interfaces:x.types.array(x.types.string),explore:x.types.optional(x.types.boolean,!1),completionStore:x.types.optional(ud,{completions:[],predictions:[]}),user:x.types.maybeNull(hd),debug:x.types.optional(x.types.boolean,!0),settings:x.types.optional(pd,{}),description:x.types.maybeNull(x.types.string),showingSettings:x.types.optional(x.types.boolean,!1),showingDescription:x.types.optional(x.types.boolean,!1),isLoading:x.types.optional(x.types.boolean,!1),isSubmitting:!1,noTask:x.types.optional(x.types.boolean,!1),noAccess:x.types.optional(x.types.boolean,!1),labeledSuccess:x.types.optional(x.types.boolean,!1)}).views((function(e){return{get alert(){return Object(x.getEnv)(e).alert}}})).actions((function(e){function t(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"warning";Ra[t](e)}function n(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Error during submit";e.setFlags({isSubmitting:!0});var r=n();Promise.race([Promise.all([r,ne(500)]),ne(5e3)]).catch((function(e){return t((null===e||void 0===e?void 0:e.message)||e||a)})).then((function(){return e.setFlags({isSubmitting:!1})}))}return{setFlags:function(t){for(var n=0,a=["showingSettings","showingDescription","isLoading","isSubmitting","noTask","noAccess","labeledSuccess"];n<a.length;n++){var r=a[n];r in t&&(e[r]=t[r])}},addInterface:function(t){return e.interfaces.push(t)},hasInterface:function(t){return void 0!==e.interfaces.find((function(e){return t===e}))},afterCreate:function(){window.Htx=e,Pt.addKey("ctrl+enter",e.submitCompletion,"Submit a task"),e.hasInterface("skip")&&Pt.addKey("ctrl+space",e.skipTask,"Skip a task"),e.hasInterface("update")&&Pt.addKey("alt+enter",e.updateCompletion,"Update a task"),Pt.addKey("ctrl+backspace",(function(){e.completionStore.selected.deleteAllRegions()}),"Delete all regions"),Pt.addKey("r",(function(){var t=e.completionStore.selected;t&&t.highlightedNode&&!t.relationMode&&t.startRelationMode(t.highlightedNode)}),"Create relation when region is selected"),Pt.addKey("u",(function(){var t=e.completionStore.selected;t&&!t.relationMode&&t.unselectAll()})),Pt.addKey("h",(function(){var t=e.completionStore.selected;t&&t.highlightedNode&&!t.relationMode&&t.highlightedNode.toggleHidden()})),Pt.addKey("ctrl+z",(function(){var t=e.completionStore.selected.history;t&&t.canUndo&&t.undo()})),Pt.addKey("ctrl+shift+z",(function(){var t=e.completionStore.selected.history;t&&t.canRedo&&t.redo()})),Pt.addKey("escape",(function(){var t=e.completionStore.selected;t&&t.relationMode?t.stopRelationMode():t&&t.highlightedNode&&t.regionStore.unselectAll()}),"Unselect region, exit relation mode"),Pt.addKey("backspace",(function(){var t=e.completionStore.selected;t&&t.highlightedNode&&t.highlightedNode.deleteRegion()}),"Delete selected region"),Pt.addKey("alt+tab",(function(){var t=e.completionStore.selected;t&&t.regionStore.selectNext()}),"Circle through entities"),Object(x.getEnv)(e).onLabelStudioLoad(e)},assignTask:function(t){t&&!Xe.Checkers.isString(t.data)&&(t=Object(u.a)(Object(u.a)({},t),{},{data:JSON.stringify(t.data)})),e.task=gd.create(t)},assignConfig:function(t){var n=e.completionStore;e.config=t,n.initRoot(e.config)},resetState:function(){e.completionStore=ud.create({completions:[]})},initializeStore:function(t){var n=t.completions,a=t.predictions,r=e.completionStore;r.initRoot(e.config),null===a||void 0===a||a.forEach((function(e){var t=r.addPrediction(e);r.selectCompletion(t.id),t.deserializeCompletion(e.result)})),null===n||void 0===n||n.forEach((function(e,t){var n=r.addCompletion(e);r.selectCompletion(n.id),n.deserializeCompletion(e.draft||e.result),n.reinitHistory()}))},skipTask:function(){n((function(){return Object(x.getEnv)(e).onSkipTask(e)}),"Error during skip, try again")},submitDraft:function(t){return new Promise((function(n){var a=Object(x.getEnv)(e).onSubmitDraft;if(!a)return n();var r=a(e,t);r&&r.then?r.then(n):n(r)}))},submitCompletion:function(){console.log("hello submit");var t=e.completionStore.selected;t.beforeSend(),t.validate()&&(t.sendUserGenerate(),t.dropDraft(),n((function(){return Object(x.getEnv)(e).onSubmitCompletion(e,t)})))},updateCompletion:function(){console.log("hello update");var t=e.completionStore.selected;t.beforeSend(),t.validate()&&(t.dropDraft(),Object(x.getEnv)(e).onUpdateCompletion(e,t),!t.sentUserGenerate&&t.sendUserGenerate())},showModal:t,toggleSettings:function(){e.showingSettings=!e.showingSettings},toggleDescription:function(){e.showingDescription=!e.showingDescription}}}));var yd={onDeleteCompletion:function(){},onEntityCreate:function(){},onEntityDelete:function(){},onGroundTruth:function(){},onLabelStudioLoad:function(){},onSkipTask:function(){},onSubmitCompletion:function(){},onTaskLoad:function(){},onUpdateCompletion:function(){},onSelectCompletion:function(e,t){}};var vd,bd={getData:function(e){return e&&e.data?Object(u.a)(Object(u.a)({},e),{},{data:JSON.stringify(e.data)}):e},getState:function(e){return{completions:e&&e.completions?e.completions:null,predictions:e&&e.predictions?e.predictions:null}},rootElement:function(e){var t=document.createElement("div"),n=document.getElementById(e);return n.innerHTML="",n.appendChild(t),t},configureApplication:function(e){var t=e.submitCompletion||e.onSubmitCompletion,n=e.updateCompletion||e.onUpdateCompletion,a=e.deleteCompletion||e.onDeleteCompletion;return{alert:function(e){return console.log(e)},messages:Object(u.a)(Object(u.a)({},tr),e.messages),onSubmitCompletion:e.onSubmitCompletion?t:yd.onSubmitCompletion,onUpdateCompletion:e.onUpdateCompletion?n:yd.onUpdateCompletion,onDeleteCompletion:e.onDeleteCompletion?a:yd.onDeleteCompletion,onSkipTask:e.onSkipTask?e.onSkipTask:yd.onSkipTask,onSubmitDraft:e.onSubmitDraft||yd.onSubmitDraft,onTaskLoad:e.onTaskLoad||yd.onTaskLoad,onLabelStudioLoad:e.onLabelStudioLoad||yd.onLabelStudioLoad,onEntityCreate:e.onEntityCreate||yd.onEntityCreate,onEntityDelete:e.onEntityDelete||yd.onEntityDelete,onGroundTruth:e.onGroundTruth||yd.onGroundTruth,onSelectCompletion:e.onSelectCompletion||yd.onSelectCompletion}}};vd=function(e,t){var n=t;n.options&&n.options.secureMode&&(window.LS_SECURE_MODE=!0),n&&n.task&&(n.task=bd.getData(n.task));var a=fd.create(n,bd.configureApplication(n));return a.initializeStore(bd.getState(n.task)),g.a.render(p.a.createElement(Yu,{store:a}),bd.rootElement(e)),window.Htx=a,a},window.LabelStudio=vd;t.default=vd},84:function(e,t,n){e.exports={block:"Entity_block__3XG93",button:"Entity_button__3c64R",labels:"Entity_labels__1voVE",tag:"Entity_tag__1B3eN",statesblk:"Entity_statesblk__2jpJN",row:"Entity_row__3Ii1C",long:"Entity_long__1o1P3"}},91:function(e,t,n){e.exports={treelabels:"Entities_treelabels__1eXl8",item:"Entities_item__3UOdP",lstitem:"Entities_lstitem__2fIoQ",node:"Entities_node__3lZB0",flat:"Entities_flat__1BGpb",hidden:"Entities_hidden__2BWhO",visible:"Entities_visible__1hiJ7",selected:"Entities_selected__2iSLh",list:"Entities_list__1PQ5b","ant-tree-switcher":"Entities_ant-tree-switcher__37tkR"}},92:function(e,t,n){e.exports={list:"Relations_list__1qJFP",item:"Relations_item__2qMzb",selected:"Relations_selected__352to",block:"Relations_block__1iBxL",relationbtn:"Relations_relationbtn__1DE91",header:"Relations_header__2735N",section:"Relations_section__LTPqm",section__blocks:"Relations_section__blocks__3TOMg",uihidden:"Relations_uihidden__1vAUT",uivisible:"Relations_uivisible__HDy6L"}}},[[403,1,2]]]);
//# sourceMappingURL=main.a19c73ea.chunk.js.map